<div class="modal modalBox">
	<div class="modal-dialog modal-xl" role="dialog" aria-hidden="true">
		<div class="modal-content modalContent">

            <div class="gridOverall">
                <button type="button" class="closeButton" (click)="clickClose()">
                    <b>X</b>
                </button>



                <!-- TOP FORM TITLE -->
                <div class="gridTitle">
                    <b>Widget Editor</b>
                    <clr-signpost>
                        <clr-icon shape="info-circle"
                            clrSignpostTrigger>
                        </clr-icon>
                        <clr-signpost-content *clrIfOpen
                            [clrPosition]="'bottom-middle'">
                            <h5 style="margin-top: 0; color:gray;">
                                Help
                            </h5>
                            <p style="margin-top: 0; color:gray;">
                                <b>For new Widgets:</b> select a datasource, and click Continue
                                to the Widget Editor.
                                <b>Widget Editor:</b> drag a Field onto the X and Y coloured blocks.
                                Select a graph type.  Properties can be changed by clicking the dropdown
                                icons.  Click Save to show the Widget on the Dashboard, or click Cancel
                                to return to the Dashboard.
                                Click the X or press Escape to close this form.
                            </p>
                        </clr-signpost-content>
                    </clr-signpost>
                </div>



                <!-- DATASOURCES -->
                <div class="datasourceMain" *ngIf="showDatasourceMain">

                    <div class="datasourceMainHelp">
                        Select a <b>Datasources</b> on which a Widget must be created.  Details
                        about the datasource is shown on the right:
                    </div>

                    <div class="datasourceMainDescriptionTitle">
                        <b>Description:</b>
                    </div>
                    <div class="datasourceMainDescription">
                        {{ selectedDescription }}
                    </div>

                    <div class="datasourceMainError">
                        {{ errorMessage }}
                    </div>

                    <div class="datasourceMainListTitle">
                        <b>Datasources:</b>
                    </div>
                    <div class="datasourceMainList">
                        <clr-datagrid class="datagrid-compact" id="my-datagrid">
                            <clr-dg-column clrDgField="name"
                                [(clrDgSortOrder)]="sortOrder"
                                (click)="sortOrder=sortOrder * -1"
                                [style.color]="'orange'"
                                [style.width.px]="40"
                                >
                                Name
                            </clr-dg-column>

                            <clr-dg-row *clrDgItems="let row of localDatasources; let i = index"
                                [clrDgItem]="row"
                                [style.font-size.px]="12"
                                [style.color]="'red'"


                                [style.background-color]="(i == selectedRowIndex)? '#123456' : 'white'"
                                [style.color]="(i == selectedRowIndex)? 'white' : 'gray'"
                                (click)="clickDSrow(i, row.id)"
                                >
                                <clr-dg-cell>
                                    {{ row.id }} {{ row.name }}
                                    <span *ngIf="row.nrWidgets > 0"
                                        class="badge badge-5">{{row.nrWidgets}}
                                    </span>
                                </clr-dg-cell>
                            </clr-dg-row>

                        </clr-datagrid>
                    </div>

                    <div class="datasourceMainPreviewTitle">
                        <b>Preview:</b>
                    </div>
                    <div class="datasourceMainPreview">
                        <clr-datagrid class="datagrid-compact">

                            <clr-dg-placeholder>Select a datasource to preview here</clr-dg-placeholder>

                            <clr-dg-column *ngFor="let row of dataFieldNames; let i = index;">
                                {{row}}
                            <clr-icon shape="times" *ngIf="i==1"
                                (click)="clickClearRowField(i)">
                            </clr-icon>
                            </clr-dg-column>
                            <clr-dg-row *ngFor="let row of currentData">

                                <clr-dg-cell *ngFor="let col of dataFieldNames;
                                    let i = index"
                                    >
                                    {{ row[col] }}
                                </clr-dg-cell>
                            </clr-dg-row>

                        </clr-datagrid>
                    </div>

                    <div class="datasourceMainButton">
                        <button *ngIf="showPreview"
                            class="btn btn-sm btn-secondary datasourceButton"
                            (click)="clickContinue()">
                            Continue
                        </button>
                    </div>
                </div>




                <!-- Widget Editor -->
                <div class="editorMain" *ngIf="!showDatasourceMain">

                     <!-- TODO - TRY this code !!! https://next.plnkr.co/edit/Hhms3CxLmzKHark5HVsd?p=preview&preview
                        <clr-dg-column *ngFor="let column of myColumns" [clrDgField]="column.name" [clrDgSorted]="column.name === 'first_name'">
                            <ng-container *ngIf="column.isMandatory; else hideableBlock">
                                {{column.displayName}}
                            </ng-container>
                            <ng-template #hideableBlock>
                                <ng-container *clrDgHideableColumn="{hidden: (column.name !== 'email') && !column.isscore}">
                                {{column.displayName}}
                                </ng-container>
                            </ng-template>

                            <clr-dg-string-filter *ngIf="column.name === 'email'" id="emailFilter" [clrDgStringFilter]="emailFilter"  [clrFilterValue]="(column.email)"></clr-dg-string-filter>
                        </clr-dg-column> -->


                    <!-- COMPOSITION -->
                    <div class="editorComposition">
                        <div class="editorCompositionTypeTitle">
                            <b>
                                Composition:
                            </b>
                        </div>
                        <div class="select editorCompositionType">
                            <select id="selects_3"
                                [(ngModel)]="currentGraphComposition"
                                (change)="changeComposition()"
                                >
                                <option>Single</option>
                                <option>Layered</option>
                                <option>Vconcat</option>
                                <option>Hconcat</option>
                                <option>Repeat</option>
                            </select>
                        </div>
                        <div class="editorCompositionLayerTitle">
                            <b>
                                Layer:
                            </b>
                        </div>
                        <div class="select editorCompositionLayer">
                            <select id="currentGraphLayer"
                                [(ngModel)]="currentGraphLayer"
                                >
                                <option *ngFor="let row of graphLayers; let i = index">
                                    {{ row }}
                                </option>
                            </select>
                        </div>
                    </div>


                    <!-- FIELDS -->
                    <div class="editorFieldsTitle">
                        <b>Fields</b>
                    </div>
                    <div class="editorFields">
                        <nav
                            >
                            <clr-datagrid class="datagrid-compact">
                                <clr-dg-column clrDgField="name"
                                    [(clrDgSortOrder)]="sortOrder"
                                    (click)="sortOrder=sortOrder * -1"
                                    >
                                    Name
                                </clr-dg-column>

                                <clr-dg-row *clrDgItems="let row of dataSchema; let i = index"
                                    [clrDgItem]="row"
                                    >
                                    <clr-dg-cell style="margin-left: 2px; padding: 0;"
                                        id="fld"
                                        draggable="true"
                                        (dragstart)="dragstartField($event)"
                                        >
                                        <clr-icon *ngIf="row.type=='string'"
                                            shape="text"
                                            size="14"
                                            [style.background-color]="'rgb(241, 239, 239)'"
                                            [style.color]="'black'"
                                            >
                                        </clr-icon>
                                        <clr-icon *ngIf="row.type=='number'"
                                            shape="italic"
                                            size="14"
                                            [style.background-color]="'rgb(188, 241, 188)'"
                                            [style.color]="'black'"
                                            >
                                        </clr-icon>
                                        <clr-icon *ngIf="row.type=='date'"
                                            shape="calendar"
                                            size="14"
                                            [style.border]="'white'"
                                            [style.background-color]="'white'"
                                            [style.color]="'black'"
                                            >
                                        </clr-icon>
                                        <clr-icon *ngIf="row.type=='boolean'"
                                            shape="minus"
                                            size="14"
                                            [style.border]="'white'"
                                            [style.background-color]="'rgb(206, 199, 245)'"
                                            [style.color]="'black'"
                                            >
                                        </clr-icon>

                                        {{ row.name }}
                                        <!-- <span class="badge badge-light-gray">
                                            {{row.length}}
                                        </span> -->
                                    </clr-dg-cell>
                                </clr-dg-row>

                            </clr-datagrid>
                        </nav>
                    </div>


                    <!-- PROPERTIES -->
                    <div class="editorPropertiesTitle">
                        <b>
                            Properties
                        </b>
                    </div>
                    <div class="editorProperties">

                        <!-- TOP 3 - 1. X field -->
                        <div class="editorLineContainer">
                            <div class="editorColFieldTitle">
                                X axis:
                                <clr-icon shape="switch right"
                                    size="10"
                                    (click)="switchXandY()"
                                    >
                                </clr-icon>
                            </div>
                            <div class="editorColField"
                                id="target"
                                (drop)="dropColumn($event);"
                                (dragover)="dragoverColumn($event);"
                                (dragenter)="dragenterColumn($event);"
                                (dragleave)="dragleaveColumn($event);"
                                [style.background-color]="dragoverCol? 'lightgray' : 'transparent'"
                                [style.font-style]="colField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                >
                                <clr-icon shape="times" *ngIf="showColumnDeleteIcon"
                                    (click)="clickClearColumnField()">
                                </clr-icon>
                                {{ colField }}
                            </div>
                        </div>

                        <!-- TOP 3 - 2. Y field -->
                        <div class="editorLineContainer">
                            <div class="editorRowFieldTitle">
                                Y axis:
                                <clr-icon shape="switch right"
                                    size="10"
                                    (click)="switchXandY()"
                                    >
                                </clr-icon>
                            </div>
                            <div class="editorRowField"
                                id="target"
                                (drop)="dropRow($event);"
                                (dragenter)="dragenterRow($event);"
                                (dragleave)="dragleaveRow($event);"
                                (dragover)="dragoverRows($event);"
                                [style.background-color]="dragoverRow? 'lightgray' : 'transparent'"
                                [style.font-style]="rowField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                >
                                <clr-icon shape="times" *ngIf="showRowDeleteIcon"
                                    (click)="clickClearRowField()">
                                </clr-icon>
                                {{ rowField }}
                            </div>
                        </div>

                        <!-- TOP 3 - 3. Color field -->
                        <div class="editorLineContainer">
                            <div class="editorColourFieldTitle">
                                Colour:
                            </div>
                            <div class="editorColourField"
                                id="target"
                                (drop)="dropColour($event);"
                                (dragenter)="dragenterColour($event);"
                                (dragleave)="dragleaveColour($event);"
                                (dragover)="dragoverColour($event);"
                                [style.background-color]="dragoverColours? 'lightgray' : 'transparent'"
                                [style.font-style]="graphColorField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                >
                                <clr-icon shape="times" *ngIf="showColourDeleteIcon"
                                    (click)="clickClearColourField()"
                                    >
                                </clr-icon>
                                {{ graphColorField }}
                            </div>
                        </div>


                        <!-- TITLE -->
                        <!-- Title Header -->
                        <div class="editorTitleTitle"
                            (click)="clickShowTitleProperties()"
                            >
                            <b>
                                Title
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldTitleProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldTitleProperties"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Title Text -->
                        <div class="editorLineContainer">
                            <div class="editorTitleTextTitle" *ngIf="showFieldTitleProperties">
                                Text:
                            </div>
                            <div class="editorTitleText" *ngIf="showFieldTitleProperties">
                                <input type="text"
                                    placeholder="Text of title"
                                    [(ngModel)]="localWidget.graphTitleText"
                                    name="graphTitleText"
                                    style="border-radius: 5px; width: 100%;"
                                    >
                            </div>
                        </div>

                        <!-- Title Anchor -->
                        <div class="editorLineContainer">
                            <div class="editorTitleAnchorTitle" *ngIf="showFieldTitleProperties">
                                Anchor:
                            </div>
                            <div class="select editorTitleAnchor" *ngIf="showFieldTitleProperties">
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphTitleAnchor"
                                    >
                                    <option>Start</option>
                                    <option>Middle</option>
                                    <option>End</option>
                                </select>
                            </div>
                        </div>

                        <!-- Title Angle in degrees -->
                        <div class="editorLineContainer">
                            <div class="editorTitleAngleTitle" *ngIf="showFieldTitleProperties">
                                Angle:
                            </div>
                            <div class="editorTitleAngle" *ngIf="showFieldTitleProperties">
                                <input type="number"
                                    placeholder="Angle of title"
                                    [(ngModel)]="localWidget.graphTitleAngle"
                                    name="titleAngle"
                                    >
                            </div>
                        </div>

                        <!-- Title Vertical text baseline for title text. -->
                        <div class="editorLineContainer">
                            <div class="editorTitleBaselineTitle" *ngIf="showFieldTitleProperties">
                            Baseline:
                            </div>
                            <div class="select editorTitleBaseline" *ngIf="showFieldTitleProperties">
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphTitleBaseline"
                                    >
                                    <option>Top</option>
                                    <option>Middle</option>
                                    <option>Bottom</option>
                                </select>
                            </div>
                        </div>

                        <!-- Title Text color for title text.  -->
                        <div class="editorLineContainer">
                            <div class="editorTitleColourTitle" *ngIf="showFieldTitleProperties">
                            Color:
                            </div>
                            <div class="select editorTitleColour" *ngIf="showFieldTitleProperties">
                                <select [(ngModel)]="localWidget.graphTitleColorName"
                                    name="graphTitleColorName"
                                    (change)="clickSelectTitleColor($event)"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Title Font name for title text. -->
                        <div class="editorLineContainer">
                            <div class="editorTitleFontTitle" *ngIf="showFieldTitleProperties">
                            Font:
                            </div>
                            <div class="editorTitleFont" *ngIf="showFieldTitleProperties">
                                <input type="text"
                                    placeholder="Font name"
                                    [(ngModel)]="localWidget.graphTitleFont"
                                    name="graphTitleFont"
                                    >
                            </div>
                        </div>

                        <!-- Title Font size in pixels for title text. Default value: 10. -->
                        <div class="editorLineContainer">
                            <div class="editorTitleFontSizeTitle" *ngIf="showFieldTitleProperties">
                            Font Size:
                            </div>
                            <div class="editorTitleFontSize" *ngIf="showFieldTitleProperties">
                                <input type="number"
                                    placeholder="Font Size"
                                    [(ngModel)]="localWidget.graphTitleFontSize"
                                    name="graphTitleFontSize"
                                    >
                            </div>
                        </div>

                        <!-- Title Font Weight in pixels for title text. Default value: 10. -->
                        <div class="editorLineContainer">
                            <div class="editorTitleFontWeightTitle" *ngIf="showFieldTitleProperties">
                            Font Weight:
                            </div>
                            <div class="editorTitleFontWeight" *ngIf="showFieldTitleProperties">
                                <input type="number"
                                    placeholder="Font Weight (100, 200..900)"
                                    [(ngModel)]="localWidget.graphTitleFontWeight"
                                    name="graphTitleFontWeight"
                                    >
                            </div>
                        </div>

                        <!-- lTitle imit: The maximum allowed length in pixels of legend labels.-->
                        <div class="editorLineContainer">
                            <div class="editorTitleLengthTitle" *ngIf="showFieldTitleProperties">
                            Length:
                            </div>
                            <div class="editorTitleLength" *ngIf="showFieldTitleProperties">
                                <input type="number"
                                    placeholder="Max length in px"
                                    [(ngModel)]="titleLength"
                                    name="titleLength"
                                    >
                            </div>
                        </div>

                        <!-- Title orient: Default title orientation ("top", "bottom", "left", or "right") -->
                        <div class="editorLineContainer">
                            <div class="editorTitleOrientationTitle" *ngIf="showFieldTitleProperties">
                            Orientation:
                            </div>
                            <div class="select editorTitleOrientation" *ngIf="showFieldTitleProperties">
                                <select id="selects_3"
                                    [(ngModel)]="titleOrientation"
                                    >
                                    <option>Top</option>
                                    <option>Bottom</option>
                                    <option>Left</option>
                                    <option>Right</option>
                                </select>
                            </div>
                        </div>


                        <!-- X Properties -->
                        <div class="editorXPropertiesTitle" *ngIf="showFieldXPropertiesTitle"
                            (click)="clickShowXProperties()"
                            >
                            <b>
                                X Properties
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldXProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldXProperties"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- X Properties Aggregate -->
                        <div class="editorLineContainer">
                            <div class="editorXPropertiesAggregateTitle" *ngIf="showFieldXProperties">
                                Aggregate:
                            </div>
                            <div class="select editorXPropertiesAggregate" *ngIf="showFieldXProperties">
                                <select id="selects_3"
                                    [(ngModel)]="xPropertiesAggregate"
                                    name="xPropertiesAggregate"
                                    >
                                    <option *ngFor="let row of aggregations; let i = index">
                                        {{ row.displayName }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- X Properties bin -->
                        <div class="editorLineContainer">
                            <div class="editorXPropertiesBinTitle" *ngIf="showFieldXProperties">
                                Bin:
                            </div>
                            <div class="select editorXPropertiesBin" *ngIf="showFieldXProperties">
                                <select id="selects_3"
                                    [(ngModel)]="xPropertiesBin"
                                    name="xPropertiesBin"
                                    >
                                    <option>False</option>
                                    <option>True</option>
                                </select>
                            </div>
                        </div>

                        <!-- X Properties Format -->
                        <div class="editorLineContainer">
                            <div class="editorXPropertiesFormatTitle" *ngIf="showFieldXProperties">
                            Format:
                            </div>
                            <div class="editorXPropertiesFormat" *ngIf="showFieldXProperties">
                                <input type="text"
                                    placeholder="ie .2s +$,.2f"
                                    [(ngModel)]="xPropertiesFormat"
                                    name="xPropertiesFormat"
                                    >
                            </div>
                        </div>

                        <!-- X Properties Impute -->
                        <div class="editorLineContainer">
                            <div class="editorXPropertiesImputeTitle" *ngIf="showFieldXProperties">
                                Impute:
                            </div>
                            <div class="select editorXPropertiesImpute" *ngIf="showFieldXProperties">
                                <select id="selects_3"
                                    [(ngModel)]="xPropertiesImpute"
                                    name="xPropertiesImpute"
                                    >
                                    <option></option>
                                    <option>Max</option>
                                    <option>Mean</option>
                                    <option>Medium</option>
                                    <option>Min</option>
                                    <option>Value</option>
                                </select>
                            </div>
                            <div class="editorXPropertiesImputeValue"
                                *ngIf="showFieldXProperties"
                                size="5"
                                >
                                <input type="number"
                                    placeholder="Value"
                                    [(ngModel)]="xPropertiesImputeValue"
                                    name="xPropertiesImputeValue"
                                    [disabled]="!(xPropertiesImpute=='Value')"
                                    size="5"
                                    >
                            </div>
                        </div>

                        <!-- X Properties stack -->
                        <div class="editorLineContainer">
                            <div class="editorXPropertiesStackTitle" *ngIf="showFieldXProperties">
                                Stack:
                            </div>
                            <div class="select editorXPropertiesStack" *ngIf="showFieldXProperties">
                                <select id="selects_3"
                                    [(ngModel)]="xPropertiesStack"
                                    name="xPropertiesStack"
                                    >
                                    <option>Zero</option>
                                    <option>Normalise</option>
                                    <option>Center</option>
                                    <option>Null</option>
                                </select>
                            </div>
                        </div>

                        <!-- X Properties Sort -->
                        <div class="editorLineContainer">
                            <div class="editorXPropertiesSortTitle" *ngIf="showFieldXProperties">
                                Sort:
                            </div>
                            <div class="select editorXPropertiesSort" *ngIf="showFieldXProperties">
                                <select id="selects_3"
                                    [(ngModel)]="xPropertiesSort"
                                    name="xPropertiesSort"
                                    >
                                    <option>None</option>
                                    <option>Ascending</option>
                                    <option>Descending</option>
                                </select>
                            </div>
                        </div>

                        <!-- X Properties type -->
                        <div class="editorLineContainer">
                            <div class="editorXPropertiesTypeTitle" *ngIf="showFieldXProperties">
                                Type:
                            </div>
                            <div class="select editorXPropertiesType" *ngIf="showFieldXProperties">
                                <select id="selects_3"
                                    [(ngModel)]="xPropertiesType"
                                    name="xPropertiesType"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>

                        <!-- X Properties timeUnit -->
                        <div class="editorLineContainer">
                            <div class="editorXPropertiesTimeUnitTitle" *ngIf="showFieldXProperties">
                                TimeUnit:
                            </div>
                            <div class="select editorXPropertiesTimeUnit"
                                *ngIf="showFieldXProperties"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="xPropertiesTimeUnit"
                                    >
                                    <option *ngFor="let row of timeUnits; let i = index">
                                        {{ row }}
                                    </option>
                                </select>
                            </div>
                        </div>



                        <!-- Y Properties -->
                        <div class="editorYPropertiesTitle" *ngIf="showFieldYPropertiesTitle"
                            (click)="clickShowYProperties()"
                            >
                            <b>
                                Y Properties
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldYProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldYProperties"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Y Properties aggregate -->
                        <div class="editorLineContainer">
                            <div class="editorYPropertiesAggregateTitle" *ngIf="showFieldYProperties">
                                Aggregate:
                            </div>
                            <div class="select editorYPropertiesAggregate" *ngIf="showFieldYProperties">
                                <select id="selects_3"
                                    [(ngModel)]="yPropertiesAggregate"
                                    >
                                    <option *ngFor="let row of aggregations; let i = index">
                                        {{ row.displayName }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Properties bin -->
                        <div class="editorLineContainer">
                            <div class="editorYPropertiesBinTitle" *ngIf="showFieldYProperties">
                                Bin:
                            </div>
                            <div class="select editorYPropertiesBin" *ngIf="showFieldYProperties">
                                <select id="selects_3"
                                    [(ngModel)]="yPropertiesBin"
                                    name="yPropertiesBin"
                                    >
                                    <option>False</option>
                                    <option>True</option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Properties Format -->
                        <div class="editorLineContainer">
                            <div class="editorYPropertiesFormatTitle" *ngIf="showFieldYProperties">
                                Format:
                            </div>
                            <div class="editorYPropertiesFormat" *ngIf="showFieldYProperties">
                                <input type="text"
                                    placeholder="ie .2s +$,.2f"
                                    [(ngModel)]="yPropertiesFormat"
                                    name="yPropertiesFormat"
                                    >
                            </div>
                        </div>

                        <!-- Y Properties Impute -->
                        <div class="editorLineContainer">
                            <div class="editorYPropertiesImputeTitle" *ngIf="showFieldYProperties">
                                Impute:
                            </div>
                            <div class="select editorYPropertiesImpute" *ngIf="showFieldYProperties">
                                <select id="selects_3"
                                    [(ngModel)]="yPropertiesImpute"
                                    name="yPropertiesImpute"
                                    >
                                    <option></option>
                                    <option>Max</option>
                                    <option>Mean</option>
                                    <option>Medium</option>
                                    <option>Min</option>
                                    <option>Value</option>
                                </select>
                            </div>
                            <div class="editorYPropertiesImputeValue"
                                *ngIf="showFieldYProperties"
                                size="5"
                                >
                                <input type="number"
                                    placeholder="Value"
                                    [(ngModel)]="yPropertiesImputeValue"
                                    name="yPropertiesImputeValue"
                                    [disabled]="!(yPropertiesImpute=='Value')"
                                    size="5"
                                    >
                            </div>
                        </div>

                        <!-- Y Properties stack -->
                        <div class="editorLineContainer">
                            <div class="editorYPropertiesStackTitle" *ngIf="showFieldYProperties">
                                Stack:
                            </div>
                            <div class="select editorYPropertiesStack" *ngIf="showFieldYProperties">
                                <select id="selects_3"
                                    [(ngModel)]="yPropertiesStack"
                                    name="yPropertiesStack"
                                    >
                                    <option>Zero</option>
                                    <option>Normalise</option>
                                    <option>Center</option>
                                    <option>Null</option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Properties Sort -->
                        <div class="editorLineContainer">
                            <div class="editorYPropertiesSortTitle" *ngIf="showFieldYProperties">
                                Sort:
                            </div>
                            <div class="select editorYPropertiesSort" *ngIf="showFieldYProperties">
                                <select id="selects_3"
                                    [(ngModel)]="yPropertiesSort"
                                    name="yPropertiesSort"
                                    >
                                    <option>None</option>
                                    <option>Ascending</option>
                                    <option>Descending</option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Properties type -->
                        <div class="editorLineContainer">
                            <div class="editorYPropertiesTypeTitle" *ngIf="showFieldYProperties">
                                Type:
                            </div>
                            <div class="select editorYPropertiesType" *ngIf="showFieldYProperties">
                                <select id="selects_3"
                                    [(ngModel)]="yPropertiesType"
                                    name="yPropertiesType"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Properties timeUnit -->
                        <div class="editorLineContainer">
                            <div class="editorYPropertiesTimeUnitTitle" *ngIf="showFieldYProperties">
                                TimeUnit:
                            </div>
                            <div class="select editorYPropertiesTimeUnit"
                                *ngIf="showFieldYProperties"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="yPropertiesTimeUnit"
                                    >
                                    <option *ngFor="let row of timeUnits; let i = index">
                                        {{ row }}
                                    </option>
                                </select>
                            </div>
                        </div>


                        <!-- Color Properties -->
                        <div class="editorColorPropertiesTitle" *ngIf="showFieldColorPropertiesTitle"
                            (click)="clickShowColorProperties()"
                            >
                            <b>
                                Color Properties
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldColorProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldColorProperties"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Color Properties Aggregate -->
                        <div class="editorLineContainer">
                            <div class="editorColorPropertiesAggregateTitle" *ngIf="showFieldColorProperties">
                                Aggregate:
                            </div>
                            <div class="select editorColorPropertiesAggregate" *ngIf="showFieldColorProperties">
                                <select id="selects_3"
                                    [(ngModel)]="colorPropertiesAggregate"
                                    name="colorPropertiesAggregate"
                                    >
                                    <option *ngFor="let row of aggregations; let i = index">
                                        {{ row.displayName }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Color Properties bin -->
                        <div class="editorLineContainer">
                            <div class="editorColorPropertiesBinTitle" *ngIf="showFieldColorProperties">
                                Bin:
                            </div>
                            <div class="select editorColorPropertiesBin" *ngIf="showFieldColorProperties">
                                <select id="selects_3"
                                    [(ngModel)]="colorPropertiesBin"
                                    name="colorPropertiesBin"
                                    >
                                    <option>False</option>
                                    <option>True</option>
                                </select>
                            </div>
                        </div>

                        <!-- Color Properties Format -->
                        <div class="editorLineContainer">
                            <div class="editorColorPropertiesFormatTitle" *ngIf="showFieldColorProperties">
                                Format:
                            </div>
                            <div class="editorColorPropertiesFormat" *ngIf="showFieldColorProperties">
                                <input type="text"
                                    placeholder="ie .2s +$,.2f"
                                    [(ngModel)]="colorPropertiesFormat"
                                    name="colorPropertiesFormat"
                                    >
                            </div>
                        </div>

                        <!-- Color Properties Impute -->
                        <div class="editorLineContainer">
                            <div class="editorColorPropertiesImputeTitle" *ngIf="showFieldColorProperties">
                                Impute:
                            </div>
                            <div class="select editorColorPropertiesImpute" *ngIf="showFieldColorProperties">
                                <select id="selects_3"
                                    [(ngModel)]="colorPropertiesImpute"
                                    name="colorPropertiesImpute"
                                    >
                                    <option></option>
                                    <option>Max</option>
                                    <option>Mean</option>
                                    <option>Medium</option>
                                    <option>Min</option>
                                    <option>Value</option>
                                </select>
                            </div>
                            <div class="editorColorPropertiesImputeValue"
                                *ngIf="showFieldColorProperties"
                                size="5"
                                >
                                <input type="number"
                                    placeholder="Value"
                                    [(ngModel)]="colorPropertiesImputeValue"
                                    name="colorPropertiesImputeValue"
                                    [disabled]="!(colorPropertiesImpute=='Value')"
                                    size="5"
                                    >
                            </div>
                        </div>

                        <!-- Color Properties Scheme -->
                        <div class="editorLineContainer">
                            <div class="editorColorPropertiesSchemeTitle" *ngIf="showFieldColorProperties">
                                Scheme:
                            </div>
                            <div class="select editorColorPropertiesScheme" *ngIf="showFieldColorProperties">
                                <select id="selects_3"
                                    [(ngModel)]="colorPropertiesScheme"
                                    name="colorPropertiesScheme"
                                    >
                                    <option *ngFor="let row of vegaColorSchemes; let i = index">
                                        {{ row }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Color Properties Sort -->
                        <div class="editorLineContainer">
                            <div class="editorColorPropertiesSortTitle" *ngIf="showFieldColorProperties">
                                Sort:
                            </div>
                            <div class="select editorColorPropertiesSort" *ngIf="showFieldColorProperties">
                                <select id="selects_3"
                                    [(ngModel)]="colorPropertiesSort"
                                    name="colorPropertiesSort"
                                    >
                                    <option>None</option>
                                    <option>Ascending</option>
                                    <option>Descending</option>
                                </select>
                            </div>
                        </div>

                        <!-- Color Properties stack -->
                        <div class="editorLineContainer">
                            <div class="editorColorPropertiesStackTitle" *ngIf="showFieldColorProperties">
                                Stack:
                            </div>
                            <div class="select editorColorPropertiesStack" *ngIf="showFieldColorProperties">
                                <select id="selects_3"
                                    [(ngModel)]="colorPropertiesStack"
                                    name="colorPropertiesStack"
                                    >
                                    <option>Zero</option>
                                    <option>Normalise</option>
                                    <option>Center</option>
                                    <option>Null</option>
                                </select>
                            </div>
                        </div>

                        <!-- Color Properties type -->
                        <div class="editorLineContainer">
                            <div class="editorColorPropertiesTypeTitle" *ngIf="showFieldColorProperties">
                                Type:
                            </div>
                            <div class="select editorColorPropertiesType" *ngIf="showFieldColorProperties">
                                <select id="selects_3"
                                    [(ngModel)]="colorPropertiesType"
                                    name="colorPropertiesType"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>

                        <!-- Color Properties timeUnit -->
                        <div class="editorLineContainer">
                            <div class="editorColorPropertiesTimeUnitTitle" *ngIf="showFieldColorProperties">
                                TimeUnit:
                            </div>
                            <div class="select editorColorPropertiesTimeUnit"
                                *ngIf="showFieldColorProperties"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="colorPropertiesTimeUnit"
                                    >
                                    <option *ngFor="let row of timeUnits; let i = index">
                                        {{ row }}
                                    </option>
                                </select>
                            </div>
                        </div>


                        <!-- Filter -->
                        <div class="editorFilterTitle"
                            (click)="clickShowFilter()"
                            >
                            <b>
                                Filter
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldFilter"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldFilter"
                                size="12"
                                >
                            </clr-icon>
                        </div>


                        <!-- Selection -->
                        <div class="editorSelectionTitle"
                            (click)="clickShowSelection()"
                            >
                            <b>
                                Selection
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldSelection"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldSelection"
                                size="12"
                                >
                            </clr-icon>
                        </div>


                        <!-- X-Axis -->
                        <div class="editorXAxisContainerTitle" *ngIf="showFieldXPropertiesTitle"
                            (click)="clickShowXAxis()"
                            >
                            <b>
                                X Axis
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldXAxis"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldXAxis"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- X-Axis Title -->
                        <div class="editorLineContainer">
                            <div class="editorXAxisTitleTitle" *ngIf="showFieldXAxis">
                                Title:
                            </div>
                            <div class="editorXAxisTitleCheckbox" *ngIf="showFieldXAxis">
                                <input [(ngModel)]="xAxisTitleCheckbox"
                                    type="checkbox"
                                    name="xAxisTitleCheckbox"
                                    title="Show the Axis Title (T/F)"
                                    >
                            </div>
                            <div class="editorXAxisTitle" *ngIf="showFieldXAxis"
                                >
                                <input type="text"
                                    placeholder="Blank = field name"
                                    [(ngModel)]="xAxisTitle"
                                    name="xAxisTitle"
                                    >
                            </div>
                        </div>

                        <!-- X-Axis Grid -->
                        <div class="editorLineContainer">
                            <div class="editorXAxisGridTitle" *ngIf="showFieldXAxis">
                                Grid:
                            </div>
                            <div class="editorXAxisGrid" *ngIf="showFieldXAxis">
                                <input type="checkbox"
                                    [(ngModel)]="xAxisGrid"
                                    name="xAxisGrid"
                                    title="Show Grid lines (T/F)"
                                    >
                            </div>
                        </div>

                        <!-- X Axis Format -->
                        <div class="editorLineContainer">
                            <div class="editorXAxisFormatTitle" *ngIf="showFieldXAxis">
                            Format:
                            </div>
                            <div class="editorXAxisFormat" *ngIf="showFieldXAxis">
                                <input type="text"
                                    [(ngModel)]="xAxisFormat"
                                    name="xAxisFormat"
                                    placeholder="ie .2s +$,.2f"
                                    >
                            </div>
                        </div>

                        <!-- X Axis Labels -->
                        <div class="editorLineContainer">
                            <div class="editorXAxisLabelsTitle" *ngIf="showFieldXAxis">
                            Labels:
                            </div>
                            <div class="editorXAxisLabels" *ngIf="showFieldXAxis">
                                <input type="checkbox"
                                    [(ngModel)]="xAxisLabels"
                                    name="xAxisLabels"
                                    title="Show labels (T/F)"
                                    >
                            </div>
                        </div>

                        <!-- X Axis LabelAngle -->
                        <div class="editorLineContainer">
                            <div class="editorXAxisLabelAngleTitle" *ngIf="showFieldXAxis">
                            Angle:
                            </div>
                            <div class="editorXAxisLabelAngle" *ngIf="showFieldXAxis">
                                <input type="number"
                                    [(ngModel)]="xAxisLabelAngle"
                                    name="xAxisLabelAngle"
                                    placeholder="Label Angle"
                                    >
                            </div>
                        </div>


                        <!-- Y-Axis -->
                        <div class="editorYAxisContainerTitle" *ngIf="showFieldYPropertiesTitle"
                            (click)="clickShowYAxis()"
                            >
                            <b>
                                Y Axis
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldYAxis"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldYAxis"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Y-Axis Scale Type -->
                        <div class="editorLineContainer">
                            <div class="editorYAxisScaleTypeTitle" *ngIf="showFieldYAxis">
                                Type:
                            </div>
                            <div class="select editorYAxisScaleType"
                                *ngIf="showFieldYAxis"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="yAxisScaleType"
                                    >
                                    <option>Default</option>
                                    <option>Linear</option>
                                    <option>Log</option>
                                    <option>Quantile</option>
                                </select>
                            </div>
                        </div>

                        <!-- Y-Axis Title -->
                        <div class="editorLineContainer">
                            <div class="editorYAxisTitleTitle" *ngIf="showFieldYAxis">
                                Title:
                            </div>
                            <div class="editorYAxisTitleCheckbox" *ngIf="showFieldYAxis">
                                <input [(ngModel)]="yAxisTitleCheckbox"
                                    type="checkbox"
                                    name="yAxisTitleCheckbox"
                                    title="Show the Axis Title (T/F)"
                                    >
                            </div>
                            <div class="editorYAxisTitle" *ngIf="showFieldYAxis"
                                >
                                <input type="text"
                                    placeholder="Blank = field name"
                                    [(ngModel)]="yAxisTitle"
                                    name="yAxisTitle"
                                    >
                            </div>
                        </div>

                        <!-- Y-Axis Grid -->
                        <div class="editorLineContainer">
                            <div class="editorYAxisGridTitle" *ngIf="showFieldYAxis">
                                Grid:
                            </div>
                            <div class="editorYAxisGrid" *ngIf="showFieldYAxis">
                                <input type="checkbox"
                                    [(ngModel)]="yAxisGrid"
                                    name="yAxisGrid"
                                    title="Show Grid lines (T/F)"
                                    >
                            </div>
                        </div>

                        <!-- Y Axis Format -->
                        <div class="editorLineContainer">
                            <div class="editorYAxisFormatTitle" *ngIf="showFieldYAxis">
                            Format:
                            </div>
                            <div class="editorYAxisFormat" *ngIf="showFieldYAxis">
                                <input type="text"
                                    [(ngModel)]="yAxisFormat"
                                    name="yAxisFormat"
                                    placeholder="ie .2s +$,.2f"
                                    >
                            </div>
                        </div>

                        <!-- Y Axis Labels -->
                        <div class="editorLineContainer">
                            <div class="editorYAxisLabelsTitle" *ngIf="showFieldYAxis">
                            Labels:
                            </div>
                            <div class="editorYAxisLabels" *ngIf="showFieldYAxis">
                                <input type="checkbox"
                                    [(ngModel)]="yAxisLabels"
                                    name="yAxisLabels"
                                    title="Show labels (T/F)"
                                    >
                            </div>
                        </div>

                        <!-- Y Axis LabelAngle -->
                        <div class="editorLineContainer">
                            <div class="editorYAxisLabelAngleTitle" *ngIf="showFieldYAxis">
                            Angle:
                            </div>
                            <div class="editorYAxisLabelAngle" *ngIf="showFieldYAxis">
                                <input type="number"
                                    [(ngModel)]="yAxisLabelAngle"
                                    name="yAxisLabelAngle"
                                    placeholder="Label Angle"
                                    >
                            </div>
                        </div>


                        <!-- Legend-Axis -->
                        <div class="editorLegendContainerTitle" *ngIf="showFieldColorPropertiesTitle"
                            (click)="clickShowLegend()"
                            >
                            <b>
                                Legend
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldLegend"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldLegend"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Legend Title -->
                        <div class="editorLineContainer">
                            <div class="editorLegendTitleTitle" *ngIf="showFieldLegend">
                                Title:
                            </div>
                            <div class="editorLegendTitleCheckbox" *ngIf="showFieldLegend">
                                <input [(ngModel)]="legendTitleCheckbox"
                                    type="checkbox"
                                    name="legendTitleCheckbox"
                                    title="Show the Axis Title (T/F)"
                                    >
                            </div>
                            <div class="editorLegendTitle" *ngIf="showFieldLegend"
                                >
                                <input type="text"
                                    placeholder="Blank = field name"
                                    [(ngModel)]="legendTitle"
                                    name="legendTitle"
                                    >
                            </div>
                        </div>

                        <!-- Legend Format -->
                        <div class="editorLineContainer">
                            <div class="editorLegendFormatTitle" *ngIf="showFieldLegend">
                            Format:
                            </div>
                            <div class="editorLegendFormat" *ngIf="showFieldLegend">
                                <input type="text"
                                    [(ngModel)]="legendFormat"
                                    name="legendFormat"
                                    placeholder="ie .2s +$,.2f"
                                    >
                            </div>
                        </div>


                        <!-- Size Channel -->
                        <div class="editorSizeContainerTitle"
                            (click)="clickShowSize()"
                            >
                            <b>
                                Size
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldSize"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldSize"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <div class="editorLineContainer">
                            <div class="editorSizeFieldTitle" *ngIf="showFieldSize">
                                Size:
                            </div>
                            <div class="editorSizeField" *ngIf="showFieldSize"
                                id="target"
                                (drop)="dropSize($event);"
                                (dragenter)="dragenterSize($event);"
                                (dragleave)="dragleaveSize($event);"
                                (dragover)="dragoverSize($event);"
                                [style.background-color]="dragoverSizes? 'lightgray' : 'transparent'"
                                [style.font-style]="graphSizeField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                >
                                
                                <clr-icon shape="times" *ngIf="showSizeDeleteIcon"
                                    (click)="clickClearSizeField()"
                                    >
                                </clr-icon>
                                {{ graphSizeField }}
                            </div>
                        </div>

                        <!-- Size type -->
                        <div class="editorLineContainer">
                            <div class="editorSizeTypeTitle" *ngIf="showFieldSize">
                                Type:
                            </div>
                            <div class="select editorSizeType" *ngIf="showFieldSize">
                                <select id="selects_3"
                                    [(ngModel)]="sizeType"
                                    name="sizeType"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>

                        <!-- Size aggregate -->
                        <div class="editorLineContainer">
                            <div class="editorSizeAggregateTitle" *ngIf="showFieldSize">
                                Aggregate:
                            </div>
                            <div class="select editorSizeAggregate" *ngIf="showFieldSize">
                                <select id="selects_3"
                                    [(ngModel)]="sizeAggregate"
                                    >
                                    <option *ngFor="let row of aggregations; let i = index">
                                        {{ row.displayName }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Size bin -->
                        <div class="editorLineContainer">
                            <div class="editorSizeBinTitle" *ngIf="showFieldSize">
                                Bin:
                            </div>
                            <div class="select editorSizeBin" *ngIf="showFieldSize">
                                <select id="selects_3"
                                    [(ngModel)]="sizeBin"
                                    name="sizeBin"
                                    >
                                    <option>False</option>
                                    <option>True</option>
                                </select>
                            </div>
                        </div>






                    </div>


                    <!-- GRAPH TYPES -->
                    <div class="editorTypesTitle">
                        <b>
                            Types
                        </b>
                    </div>
                    <div class="editorTypes">
                        <div class="editorTypeImages" *ngFor="let row of widgetGraphs">
                            <span
                                (click)="showGraph(row.id)"
                                >
                                <i>
                                    {{ row.shortName }}:
                                </i>
                            </span>
                            <img
                                [style.height.px]="85"
                                [src]="row.imageUrl"
                                (click)="showGraph(row.id)"
                            >
                        </div>
                    </div>



                    <!-- GRAPH Area -->
                    <div class="editorAreaTitle">
                        <b>Graph</b>
                    </div>
                    <div class="editorArea" #dragWidget>
                    </div>


                    <!-- BUTTONS -->
                    <div class="editorButtonShowData">
                        <button
                            class="btn btn-sm btn-secondary"
                            (click)="clickShowDatasources()"
                            >
                            <clr-icon (click)="clickShowDatasources()"
                                shape="angle left"
                                size="18"
                                >
                            </clr-icon>
                            Show Data
                        </button>
                    </div>
                    <div class="editorButtonCancel">
                        <button *ngIf="showPreview"
                            class="btn btn-sm btn-secondary"
                            (click)="clickClose()"
                            >
                            Cancel
                        </button>
                    </div>
                    <div class="editorButtonSave">
                        <button *ngIf="showPreview"
                            class="btn btn-sm btn-primary"
                            (click)="clickSave()"
                            >
                            Save
                        </button>
                    </div>

                </div>

            </div>

        </div>
    </div>
</div>