<div class="modal modalBox">
    <div class="modal-dialog modal-xl" role="dialog" aria-hidden="true"
        style="width: 53rem; max-width: 53rem;">
		<div class="modal-content modalContent">

            <div class="gridOverall">
                <button type="button" class="closeButton" (click)="clickClose()">
                    <b>X</b>
                </button>

                <!-- TOP FORM TITLE -->
                <div class="gridTitle">
                    <b>Widget Editor</b>
                    <clr-signpost>
                        <clr-icon shape="info-circle"
                            clrSignpostTrigger>
                        </clr-icon>
                        <clr-signpost-content *clrIfOpen
                            [clrPosition]="'bottom-middle'">
                            <h5 style="margin-top: 0; color:gray;">
                                Help
                            </h5>
                            <p style="margin-top: 0; color:gray;">
                                <b>For new Widgets:</b> select a datasource, and click Continue
                                to the Widget Editor.
                                <b>Widget Editor:</b> drag a Field onto the X and Y coloured blocks.
                                Select a graph type.  Properties can be changed by clicking the dropdown
                                icons.  Click Save to show the Widget on the Dashboard, or click Cancel
                                to return to the Dashboard.
                                Click the X or press Escape to close this form.
                            </p>
                        </clr-signpost-content>
                    </clr-signpost>
                </div>



                <!-- DATASOURCES -->
                <div class="datasourceMain" *ngIf="showDatasourceMain">

                    <div class="datasourceMainHelp">
                        Select a <b>Datasources</b> on which a Widget must be created.  Details
                        about the datasource is shown on the right:
                    </div>

                    <div class="datasourceMainDescriptionTitle">
                        <b>Description:</b>
                    </div>
                    <div class="datasourceMainDescription">
                        {{ selectedDescription }}
                    </div>

                    <div class="datasourceMainError">
                        {{ errorMessage }}
                    </div>

                    <div class="datasourceMainListTitle">
                        <b>Datasources:</b>
                    </div>
                    <div class="datasourceMainList">
                        <clr-datagrid class="datagrid-compact" id="my-datagrid">
                            <clr-dg-column clrDgField="name"
                                [(clrDgSortOrder)]="sortOrder"
                                (click)="sortOrder=sortOrder * -1"
                                [style.color]="'orange'"
                                [style.width.px]="40"
                                >
                                Name
                            </clr-dg-column>

                            <clr-dg-row *clrDgItems="let row of localDatasources; let i = index"
                                [clrDgItem]="row"
                                [style.font-size.px]="12"
                                [style.color]="'red'"
                                [style.background-color]="(i == selectedRowIndex)? '#123456' : 'white'"
                                [style.color]="(i == selectedRowIndex)? 'white' : 'gray'"
                                (click)="clickDSrow(i, row.id)"
                                (dblclick)="clickContinue()"
                                >
                                <clr-dg-cell>
                                    {{ row.name }}
                                    <span *ngIf="row.nrWidgets > 0"
                                        class="badge badge-5">{{row.nrWidgets}}
                                    </span>
                                </clr-dg-cell>
                            </clr-dg-row>

                        </clr-datagrid>
                    </div>

                    <div class="datasourceMainPreviewTitle">
                        <b>Preview:</b>
                    </div>
                    <div class="datasourceMainPreview">
                        <clr-datagrid class="datagrid-compact">

                            <clr-dg-placeholder>Select a datasource to preview here</clr-dg-placeholder>

                            <clr-dg-column *ngFor="let col of dataSchema; let i = index;">
                                {{ col.name }}
                                <clr-signpost>
                                    <clr-icon shape="info-circle"
                                              size="12"
                                              class="is-solid has-badge-info"
                                              clrSignpostTrigger
                                              >
                                    </clr-icon>
                                    <clr-signpost-content [clrPosition]="'bottom-middle'" *clrIfOpen>
                                        <b>Help for {{ col.name }}: </b>
                                        <div>
                                            Type: {{ col.typeName}}
                                        </div>
                                        <div>
                                            Length: {{ col.length }}
                                        </div>
                                        <div>
                                            Is Calculated: {{ col.isCalculated }}
                                        </div>
                                        <div *ngIf="col.isCalculated">
                                            Calculation: {{ col.calculatedExpression }}
                                        </div>
                                    </clr-signpost-content>
                                </clr-signpost>
                            </clr-dg-column>
                            <clr-dg-row *ngFor="let row of currentData">

                                <clr-dg-cell *ngFor="let col of dataSchema;
                                    let i = index"
                                    >
                                    {{ row[col.name] }}
                                </clr-dg-cell>
                            </clr-dg-row>

                        </clr-datagrid>
                    </div>

                    <!-- Row Nr -->
                    <div class="editorNrRowsTitle">
                        Rows:
                    </div>
                    <div class="editorNrRows"
                        title="Maximum number of rows to use in the Graph"
                        >
                        {{ nrRows }}
                    </div>

                    <!-- Optional Sampling -->
                    <div class="editorSamplingTitle">
                        Random Sample (Number rows):
                    </div>
                    <div class="editorSampling">
                        <input type="number"
                            [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].sampleNumberRows"
                            name="sampleNumberRows"
                            size="5"
                            style="border-radius: 5px; width: 100%;"
                            title="A random sample will be selected EACH time a Graph is drawn (0 = All)"
                            >
                    </div>


                    <div class="datasourceMainButtonCancel">
                        <button *ngIf="showPreview"
                            class="btn btn-sm btn-secondary"
                            (click)="clickClose()">
                            Cancel
                        </button>
                    </div>
                    <div class="datasourceMainButtonContinue">
                        <button *ngIf="showPreview"
                            class="btn btn-sm btn-primary"
                            (click)="clickContinue()">
                            Continue
                        </button>
                    </div>
                </div>




                <!-- Widget Editor -->
                <div class="editorMain" *ngIf="!showDatasourceMain">

                     <!-- TODO - TRY this code !!! https://next.plnkr.co/edit/Hhms3CxLmzKHark5HVsd?p=preview&preview
                        <clr-dg-column *ngFor="let column of myColumns" [clrDgField]="column.name" [clrDgSorted]="column.name === 'first_name'">
                            <ng-container *ngIf="column.isMandatory; else hideableBlock">
                                {{column.displayName}}
                            </ng-container>
                            <ng-template #hideableBlock>
                                <ng-container *clrDgHideableColumn="{hidden: (column.name !== 'email') && !column.isscore}">
                                {{column.displayName}}
                                </ng-container>
                            </ng-template>

                            <clr-dg-string-filter *ngIf="column.name === 'email'" id="emailFilter" [clrDgStringFilter]="emailFilter"  [clrFilterValue]="(column.email)"></clr-dg-string-filter>
                        </clr-dg-column> -->


                    <!-- COMPOSITION -->
                    <div class="editorComposition" *ngIf="!showWidgetEditorLite">
                        <div class="editorCompositionTypeTitle">
                            <b>
                                Facet:
                            </b>
                        </div>
                        <div class="select editorCompositionType">
                            <select id="selects_3"
                                [(ngModel)]="localWidget.graphLayerFacet"
                                (change)="changeFacet()"
                                >
                                <option>Single</option>
                                <option>Layer</option>
                                <option>Vconcat</option>
                                <option>Hconcat</option>
                                <option>Repeat</option>
                            </select>
                        </div>
                        <!-- <div class="editorCompositionLayerTitle" *ngIf="!showWidgetEditorLite">
                            <b>
                                Nr:
                            </b>
                        </div> -->
                        <div class="select editorCompositionLayer" *ngIf="localWidget.graphLayerFacet != 'Single'">
                            <select id="currentGraphLayer"
                                style="width: 15px; min-width: 1.5rem;"
                                (click)="clickCompositionLayerSelect($event)"
                                [(ngModel)]="currentGraphLayer"
                                >
                                <option *ngFor="let row of graphLayers; let i = index"
                                    style="width: 15px; min-width: 1.5rem;"
                                    >
                                    {{ row }}
                                </option>
                            </select>
                        </div>
                        <div class="editorCompositionLayerCheckBox" *ngIf="localWidget.graphLayerFacet != 'Single'">
                            <input [(ngModel)]="showSpecificGraphLayer"
                                type="checkbox"
                                name="showSpecificGraphLayer"
                                title="Show all the Layers of the graph (T/F)"
                                >

                        </div>
                        <span class="editorCompositionLayerButton" *ngIf="localWidget.graphLayerFacet != 'Single'">
                            <button class="btn btn-link" style="padding: 0 !important; width: 40px !important;"
                                (click)="clickCompositionLayerAdd()"
                                >
                                Add
                            </button>
                        </span>
                        <span class="editorCompositionLayerButton" *ngIf="localWidget.graphLayerFacet != 'Single'">
                            <button class="btn btn-link" style="padding: 0 !important;"
                                (click)="clickCompositionLayerDelete()"
                                >
                                Delete
                            </button>
                        </span>

                    </div>

                    <div class="editorCalculatedArea" *ngIf="showCalculatedAreaProperties">
                        <div class="editorCalculatedHeader">
                            <b>Calculated</b>
                            <clr-icon style="margin-left: 6px; padding: 0;"
                                shape="info-circle"
                                (click)="showCalculatedHelp=true"
                                >
                            </clr-icon>

                        </div>
                        <div style="padding: 8px;">
                            <i>
                                Enter the expression for the Calculation (using datum.field) for
                                existing data fields, and a new Field name.  The data type will
                                determine how it is treated in the graph.
                                For example: 2*datum.Cylinders, and CylindersDoubled
                            </i>
                        </div>

                        <div>
                            <div class="editorCalculatedExpressionTitle">
                                Expression:
                            </div>
                            <div class="editorCalculatedExpression">
                                <input type="text"
                                    [(ngModel)]="calculatedExpression"
                                    name="calculatedExpression"
                                    size="62"
                                    placeholder="12 Japan  1,5  a,b,c  true"
                                    >
                            </div>
                        </div>
                        <div>
                            <div class="editorCalculatedAsTitle">
                                As:
                            </div>
                            <div class="editorCalculatedAs">
                                <input type="text"
                                    [(ngModel)]="calculatedAs"
                                    name="calculatedAs"
                                    size="24"
                                    placeholder="New Field Name"
                                    >
                            </div>

                            <div class="editorCalculatedTypeTitle">
                                Type:
                            </div>
                            <div class="select editorCalculatedType"
                                title="Type of the Calculated field"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="calculatedDataTypeName"
                                    (change)="calculatedFieldTypeSelected($event)"
                                    name="calculatedDataTypeName"
                                    >
                                    <option>Boolean</option>
                                    <option>Number</option>
                                    <option>String</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <div class="btn-group btn-link" *ngIf="!showWidgetEditorLite">
                                <button class="btn" (click)="clickCalculatedClear()">
                                    Clear
                                </button>
                                <button class="btn" (click)="clickCalculatedApply()">
                                    <span *ngIf="calculatedID==-1">
                                        Add
                                    </span>
                                    <span *ngIf="calculatedID!=-1">
                                        Save
                                    </span>
                                </button>
                            </div>
                            <button class="btn btn-secondary calculatedCloseButton"
                                (click)="clickCalculatedClose()"
                                >
                                Close
                            </button>
                            <span class="calculatedErrorMessage">
                                {{ calculatedErrorMessage }}
                            </span>
                        </div>

                        <div class="editorCalculatedGrid">
                            <clr-datagrid class="datagrid-compact"
                                style="height: 160px !important;"
                                >
                                <clr-dg-column>Expression</clr-dg-column>
                                <clr-dg-column>New Name</clr-dg-column>
                                <clr-dg-column>DataType</clr-dg-column>
                                <clr-dg-column>Delete?</clr-dg-column>

                                <clr-dg-row *clrDgItems="let row of localWidget.graphCalculations; let i = index"
                                    [style.background-color]="(i == selectedGraphCalculatedRowIndex)? '#123456' : 'white'"
                                    [style.color]="(i == selectedGraphCalculatedRowIndex)? 'white' : 'gray'"
                                    (click)="clickGraphCalculatedRowSelect(i, row.id)"
                                    >
                                    <clr-dg-cell>{{ row.calculatedExpression }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.calculatedAs }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.calculatedDataType }}</clr-dg-cell>
                                    <clr-dg-cell style="text-align: center !important;">
                                        <span>
                                            <clr-icon
                                                shape="trash"
                                                size="12"
                                                (dblclick)="dblClickCalculatedDelete(row.id)"
                                                >
                                            </clr-icon>
                                        </span>
                                    </clr-dg-cell>
                                </clr-dg-row>

                            </clr-datagrid>
                        </div>

                    </div>

                    <div class="editorCalculatedHelpArea" *ngIf="showCalculatedHelp">
                        <div class="editorCalculatedHelpHeader">
                            <button type="button" class="btn btn-link editorCalculatedHelpButton"
                                (click)="showCalculatedHelp=false">
                                <b>X</b>
                            </button>
                            <b>Calculation Formulae</b>
                        </div>


                        <div class="editorCalculatedHelpTitle">
                            <b>Control Flow Functions:</b>
                        </div>
                        <div class="editorCalculatedHelpBody">
                            <b class="calculateHelpText" (click)="calculatedExpression='if(test, thenValue, elseValue)'">if</b>(<i>test, thenValue, elseValue</i>)
                            If test is truthy, returns thenValue. Otherwise, returns elseValue. The <b>if</b> function is equivalent to the ternary operator a ? b : c
                        </div>


                        <div class="editorCalculatedHelpTitle">
                            <b>Constants:</b>
                        </div>
                        <div class="editorCalculatedHelpBody">
                            <b class="calculateHelpText" (click)="calculatedExpression='NaN'">NaN</b>
                            Not a number. Same as the JavaScript literal <u>NaN</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='E'">E</b>
                            The transcendental number e. Same as JavaScript’s <u>Math.E</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='LN2'">LN2</b>
                            The natural log of 2. Same as JavaScript’s <u>Math.LN2</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='LN10'">LN10</b>
                            The natural log of 10. Same as JavaScript’s <u>Math.LN10</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='LOG2E'">LOG2E</b>
                            The base 2 logarithm of e. Same as JavaScript’s <u>Math.LOG2E</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='LOG10E'">LOG10E</b>
                            The base 10 logarithm e. Same as JavaScript’s <u>Math.LOG10E</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='MAX_VALUE'">MAX_VALUE</b>
                            The largest positive numeric value. Same as JavaScript’s <u>Number.MAX_VALUE</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='MIN_VALUE'">MIN_VALUE</b>
                            The smallest positive numeric value. Same as JavaScript’s <u>Number.MIN_VALUE</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='PI'">PI</b>
                            The transcendental number π. Same as JavaScript’s <u>Math.PI</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='SQRT1_2'">SQRT1_2</b>
                            The square root of 0.5. Same as JavaScript’s <u>Math.SQRT1_2</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='SQRT2'">SQRT2</b>
                            The square root of 2. Same as JavaScript’s <u>Math.SQRT2</u>
                            <br>
                        </div>


                        <div class="editorCalculatedHelpTitle">
                            <b>Constants:</b>
                        </div>
                        <div class="editorCalculatedHelpBody">
                            <b class="calculateHelpText" (click)="calculatedExpression='Cumulate(datum.YOURFIELD)'">Cumulate</b>
                            Cumulate the count of a field (for Cumulative Frequency Distribution).
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='Rank(datum.YOURFIELD, GroupbyField)'">Rank</b>
                            Rank on a field, grouped by another field (which becomes the window).
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='Sum(datum.YOURFIELD)'">Sum</b>
                            Sum a field; useful to calculate % of total.
                            <br>
                        </div>


                        <div class="editorCalculatedHelpTitle">
                            <b>Date/Time Functions:</b>
                        </div>
                        <div class="editorCalculatedHelpBody">
                            <b class="calculateHelpText" (click)="calculatedExpression='now()'">now</b>
                            ()Returns the timestamp for the current time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='datetime(year, month ...)'">datetime</b>
                            (<i>year, month[, day, hour, min, sec, millisec]</i>)
                            Returns a new Date instance. The month is 0-based, such that 1 represents February.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='date(datum.YOURFIELD)'">date</b>
                            (<i>datetime</i>)
                            Returns the day of the month for the given datetime value, in local time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='day(datum.YOURFIELD)'">day</b>
                            (<i>datetime</i>)
                            Returns the day of the week for the given datetime value, in local time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='year(datum.YOURFIELD)'">year</b>
                            (<i>datetime</i>)
                            Returns the year for the given datetime value, in local time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='quarter(datum.YOURFIELD)'">quarter</b>
                            (<i>datetime</i>)
                            Returns the quarter of the year (0-3) for the given datetime value, in local time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='month(datum.YOURFIELD)'">month</b>
                            (<i>datetime</i>)
                            Returns the (zero-based) month for the given datetime value, in local time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='hours(datum.YOURFIELD)'">hours</b>
                            (<i>datetime</i>)
                            Returns the hours component for the given datetime value, in local time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='minutes(datum.YOURFIELD)'">minutes</b>
                            (<i>datetime</i>)
                            Returns the minutes component for the given datetime value, in local time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='seconds(datum.YOURFIELD)'">seconds</b>
                            (<i>datetime</i>)
                            Returns the seconds component for the given datetime value, in local time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='milliseconds(datum.YOURFIELD)'">milliseconds</b>(<i>datetime</i>)
                            Returns the milliseconds component for the given datetime value, in local time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='time(datum.YOURFIELD)'">time</b>(<i>datetime</i>)
                            Returns the epoch-based timestamp for the given datetime value.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='timezoneoffset(datum.YOURFIELD)'">timezoneoffset</b>(<i>datetime</i>)
                            Returns the timezone offset from the local timezone to UTC for the given datetime value.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='utc(year, month ...)'">utc</b>(<i>year, month[, day, hour, min, sec, millisec]</i>)
                            Returns a timestamp for the given UTC date. The month is 0-based, such that 1 represents February.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='utcdate(datum.YOURFIELD)'">utcdate</b>(<i>datetime</i>)
                            Returns the day of the month for the given datetime value, in UTC time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='utcday(datum.YOURFIELD)'">utcday</b>(<i>datetime</i>)
                            Returns the day of the week for the given datetime value, in UTC time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='utcyear(datum.YOURFIELD)'">utcyear</b>(<i>datetime</i>)
                            Returns the year for the given datetime value, in UTC time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='utcquarter(datum.YOURFIELD)'">utcquarter</b>(<i>datetime</i>)
                            Returns the quarter of the year (0-3) for the given datetime value, in UTC time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='utcmonth(datum.YOURFIELD)'">utcmonth</b>(<i>datetime</i>)
                            Returns the (zero-based) month for the given datetime value, in UTC time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='utchours(datum.YOURFIELD)'">utchours</b>(<i>datetime</i>)
                            Returns the hours component for the given datetime value, in UTC time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='utcminutes(datum.YOURFIELD)'">utcminutes</b>(<i>datetime</i>)
                            Returns the minutes component for the given datetime value, in UTC time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='utcseconds(datum.YOURFIELD)'">utcseconds</b>(<i>datetime</i>)
                            Returns the seconds component for the given datetime value, in UTC time.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='utcmilliseconds(datum.YOURFIELD)'">utcmilliseconds</b>(<i>datetime</i>)
                            Returns the milliseconds component for the given datetime value, in UTC time.
                            <br>
                        </div>


                        <div class="editorCalculatedHelpTitle">
                            <b>Mathematical Functions:</b>
                        </div>
                        <div class="editorCalculatedHelpBody">
                            <b class="calculateHelpText" (click)="calculatedExpression='isNaN(datum.YOURFIELD)'">isNaN</b>(<i>value</i>)
                            Returns true if value is not a number. Same as JavaScript’s <u>isNaN</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='isFinite(datum.YOURFIELD)'">isFinite</b>(<i>value</i>)
                            Returns true if value is a finite number. Same as JavaScript’s <u>isFinite</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='abs(datum.YOURFIELD)'">abs</b>(<i>value</i>)
                            Returns the absolute value of value. Same as JavaScript’s <u>Math.abs</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='acos(datum.YOURFIELD)'">acos</b>(<i>value</i>)
                            Trigonometric arccosine. Same as JavaScript’s <u>Math.acos</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='asin(datum.YOURFIELD)'">asin</b>(<i>value</i>)
                            Trigonometric arcsine. Same as JavaScript’s <u>Math.asin</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='atan(datum.YOURFIELD)'">atan</b>(<i>value</i>)
                            Trigonometric arctangent. Same as JavaScript’s <u>Math.atan</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='atan2(dy, dx)'">atan2</b>(<i>dy, dx</i>)
                            Returns the arctangent of dy / dx. Same as JavaScript’s <u>Math.atan2</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='ceil(datum.YOURFIELD)'">ceil</b>(<i>value</i>)
                            Rounds value to the nearest integer of equal or greater value. Same as JavaScript’s <u>Math.ceil</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='clamp(datum.YOURFIELD, min, max)'">clamp</b>(<i>value, min, max</i>)
                            Restricts value to be between the specified min and max.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='cos(datum.YOURFIELD)'">cos</b>(<i>value</i>)
                            Trigonometric cosine. Same as JavaScript’s <u>Math.cos</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='exp(datum.YOURFIELD)'">exp</b>(<i>exponent</i>)
                            Returns the value of e raised to the provided exponent. Same as JavaScript’s <u>Math.exp</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='floor(datum.YOURFIELD)'">floor</b>(<i>value</i>)
                            Rounds value to the nearest integer of equal or lower value. Same as JavaScript’s <u>Math.floor</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='log(datum.YOURFIELD)'">log</b>(<i>value</i>)
                            Returns the natural logarithm of value. Same as JavaScript’s <u>Math.log</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='max(datum.value1, value2, …)'">max</b>(<i>value1, value2, …</i>)
                            Returns the maximum argument value. Same as JavaScript’s <u>Math.max</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='min(value1, value2, …)'">min</b>(<i>value1, value2, …</i>)
                            Returns the minimum argument value. Same as JavaScript’s <u>Math.min</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='pow(datum.YOURFIELD, exponent)'">pow</b>(<i>value, exponent</i>)
                            Returns value raised to the given exponent. Same as JavaScript’s <u>Math.pow</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='random(datum.YOURFIELD)'">random</b>(<i></i>)
                            Returns a pseudo-random number in the range [0,1). Same as JavaScript’s <u>Math.random</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='round(datum.YOURFIELD)'">round</b>(<i>value</i>)
                            Rounds value to the nearest integer. Same as JavaScript’s <u>Math.round</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='sin(datum.YOURFIELD)'">sin</b>(<i>value</i>)
                            Trigonometric sine. Same as JavaScript’s <u>Math.sin</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='sqrt(datum.YOURFIELD)'">sqrt</b>(<i>value</i>)
                            Square root function. Same as JavaScript’s <u>Math.sqrt</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='tan(datum.YOURFIELD)'">tan</b>(<i>value</i>)
                            Trigonometric tangent. Same as JavaScript’s <u>Math.tan</u>
                            <br>

                        </div>


                        <div class="editorCalculatedHelpTitle">
                            <b>String Functions:</b>
                        </div>
                        <div class="editorCalculatedHelpBody">
                            <b class="calculateHelpText" (click)="calculatedExpression='indexof(datum.YOURFIELD, substring)'">indexof</b>(<i>string, substring</i>)
                            Returns the first index of substring in the input string.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='lastindexof(datum.YOURFIELD, substring)'">lastindexof</b>(<i>string, substring</i>)
                            Returns the last index of substring in the input string.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='length(datum.YOURFIELD)'">length</b>(<i>string</i>)
                            Returns the length of the input string.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='lower(datum.YOURFIELD)'">lower</b>(<i>string</i>)
                            Transforms string to lower-case letters.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='pad(datum.YOURFIELD, length[, character, align])'">pad</b>(<i>string, length[, character, align]</i>)
                            Pads a string value with repeated instances of a character up to a specified length. If character is not specified, a space (‘ ‘) is used. By default, padding is added to the end of a string. An optional align parameter specifies if padding should be added to the 'left' (beginning), 'center', or 'right' (end) of the input string.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='parseFloat(datum.YOURFIELD)'">parseFloat</b>(<i>string</i>)
                            Parses the input string to a floating-point value. Same as JavaScript’s <u>parseFloat</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='parseInt(datum.YOURFIELD)'">parseInt</b>(<i>string</i>)
                            Parses the input string to an integer value. Same as JavaScript’s <u>parseInt</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='replace(datum.YOURFIELD, pattern, replacement)'">replace</b>(<i>string, pattern, replacement</i>)
                            Returns a new string with some or all matches of pattern replaced by a replacement string. The pattern can be a string or a regular expression. If pattern is a string, only the first instance will be replaced. Same as JavaScript’s <u>String.replace</u>
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='slice(datum.YOURFIELD, start[, end])'">slice</b>(<i>string, start[, end]</i>)
                            Returns a section of string between the start and end indices. If the end argument is negative, it is treated as an offset from the end of the string (length(string) + end).
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='split(datum.YOURFIELD, separator[, limit])'">split</b>(<i>string, separator[, limit]</i>)
                            Returns an array of tokens created by splitting the input string according to a provided separator pattern. The result can optionally be constrained to return at most limit tokens.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='substring(datum.YOURFIELD, start[, end])'">substring</b>(<i>string, start[, end]</i>)
                            Returns a section of string between the start and end indices.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='truncate(datum.YOURFIELD, length[, align, ellipsis])'">truncate</b>(<i>string, length[, align, ellipsis]</i>)
                            Truncates an input string to a target length. The optional align argument indicates what part of the string should be truncated: 'left' (the beginning), 'center', or 'right' (the end). By default, the 'right' end of the string is truncated. The optional ellipsis argument indicates the string to use to indicate truncated content; by default the ellipsis character … (\u2026) is used.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='upper(datum.YOURFIELD)'">upper</b>(<i>string</i>)
                            Transforms string to upper-case letters.
                            <br>

                        </div>


                        <div class="editorCalculatedHelpTitle">
                            <b>Type Checking Functions:</b>
                        </div>
                        <div class="editorCalculatedHelpBody">

                            <b class="calculateHelpText" (click)="calculatedExpression='isArray(datum.YOURFIELD)'">isArray</b>(<i>value</i>)
                            Returns true if value is an array, false otherwise.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='isBoolean(datum.YOURFIELD)'">isBoolean</b>(<i>value</i>)
                            Returns true if value is a boolean (true or false), false otherwise.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='isDate(datum.YOURFIELD)'">isDate</b>(<i>value</i>)
                            Returns true if value is a Date object, false otherwise. This method will return false for timestamp numbers or date-formatted strings; it recognizes Date objects only.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='isNumber(datum.YOURFIELD)'">isNumber</b>(<i>value</i>)
                            Returns true if value is a number, false otherwise. NaN and Infinity are considered numbers.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='isObject(datum.YOURFIELD)'">isObject</b>(<i>value</i>)
                            Returns true if value is an object, false otherwise. Following JavaScript typeof convention, null values are considered objects.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='isRegExp(datum.YOURFIELD)'">isRegExp</b>(<i>value</i>)
                            Returns true if value is a RegExp (regular expression) object, false otherwise.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='isString(datum.YOURFIELD)'">isString</b>(<i>value</i>)
                            Returns true if value is a string, false otherwise.
                            <br>
                        </div>


                        <div class="editorCalculatedHelpTitle">
                            <b>Type Coercion Functions:</b>
                        </div>
                        <div class="editorCalculatedHelpBody">
                            <b class="calculateHelpText" (click)="calculatedExpression='toBoolean(datum.YOURFIELD)'">toBoolean</b>(<i>value</i>)
                            Coerces the input value to a string. Null values and empty strings are mapped to null.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='toDate(datum.YOURFIELD)'">toDate</b>(<i>value</i>)
                            Coerces the input value to a Date instance. Null values and empty strings are mapped to null. If an optional parser function is provided, it is used to perform date parsing, otherwise Date.parse is used. Be aware that Date.parse has different implementations across browsers!
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='toNumber(datum.YOURFIELD)'">toNumber</b>(<i>value</i>)
                            Coerces the input value to a number. Null values and empty strings are mapped to null.
                            <br>

                            <b class="calculateHelpText" (click)="calculatedExpression='toString(datum.YOURFIELD)'">toString</b>(<i>value</i>)
                            Coerces the input value to a string. Null values and empty strings are mapped to null.
                            <br>
                        </div>

                    </div>

                    <!-- FIELDS -->
                    <div class="editorFieldsDSname">
                        <i>
                            {{ selectedDSName }}
                        </i>
                    </div>
                    <div class="editorFieldsTitle">
                        <b>Fields</b>
                        <clr-signpost>
                            <clr-icon shape="info-circle" style="margin-top: -4px;"
                                clrSignpostTrigger>
                            </clr-icon>
                            <clr-signpost-content *clrIfOpen
                                [clrPosition]="'bottom-middle'">
                                <h5 style="margin-top: 0; color:gray;">
                                    Help
                                </h5>
                                <p style="margin-top: 0; color:gray; text-align: left;">
                                    A list of Fields from the previously selected Datasource that
                                    can be graphed.  The icon left of the field name indicates the
                                    datatype of the field (ie Number).
                                    Click the X, Y, C to add to the respective
                                    channels, or drag to the containers for these fields.
                                    New fields can be added by clicking the plus sign.
                                </p>
                            </clr-signpost-content>
                        </clr-signpost>
                    </div>
                    <div class="editorFields">
                        <nav
                            >
                            <clr-datagrid class="datagrid-compact">
                                <clr-dg-column clrDgField="name"
                                    [(clrDgSortOrder)]="sortOrder"
                                    (click)="sortOrder=sortOrder * -1"
                                    >
                                    Name
                                    <clr-icon *ngIf="!showWidgetEditorLite"
                                        style="margin-left: 6px; padding: 0;"
                                        shape="plus-circle"
                                        size="18"
                                        [style.color]="'black'"
                                        (click)="clickShowCalculatedArea()"
                                        >
                                    </clr-icon>
                                </clr-dg-column>

                                <clr-dg-row *clrDgItems="let row of dataSchema; let i = index"
                                    (dblclick)="dblClickFieldRow(row.name)"
                                    [clrDgItem]="row"
                                    >
                                    <clr-dg-cell style="margin-left: 2px; padding: 0;"
                                        id="fld"
                                        draggable="true"
                                        (dragstart)="dragstartField($event)"
                                        >
                                        <clr-icon *ngIf="row.type=='string'"
                                            shape="text"
                                            size="14"
                                            [style.background-color]="'rgb(241, 239, 239)'"
                                            [style.color]="'black'"
                                            >
                                        </clr-icon>
                                        <clr-icon *ngIf="row.type=='number'"
                                            shape="italic"
                                            size="14"
                                            [style.background-color]="'rgb(188, 241, 188)'"
                                            [style.color]="'black'"
                                            >
                                        </clr-icon>
                                        <clr-icon *ngIf="row.type=='date'"
                                            shape="calendar"
                                            size="14"
                                            [style.border]="'white'"
                                            [style.background-color]="'white'"
                                            [style.color]="'black'"
                                            >
                                        </clr-icon>
                                        <clr-icon *ngIf="row.type=='boolean'"
                                            shape="minus"
                                            size="14"
                                            [style.border]="'white'"
                                            [style.background-color]="'rgb(206, 199, 245)'"
                                            [style.color]="'black'"
                                            >
                                        </clr-icon>

                                        {{ row.name }}

                                        <span
                                            style="float:right;font-size: 0.5rem; margin-right: 3px;"
                                            >
                                            <clr-icon *ngIf="row.isCalculated"
                                                style="cursor: pointer"
                                                shape="calculator"
                                                size="14"
                                                (click)="dblClickFieldRow(row.name)"
                                                >
                                            </clr-icon>
                                            <!-- NB: this has to be in sync with TS code -->
                                            <b>
                                                <span style="cursor: pointer"
                                                    [style.color]="row.name==xField?  'red'  :  'gray'"
                                                    (click)="clickFillXfield(row.name)"
                                                    >
                                                    X
                                                </span>
                                                <span style="cursor: pointer"
                                                    [style.color]="row.name==yField?  'red'  :  'gray'"
                                                    (click)="clickFillYfield(row.name)"
                                                    >
                                                    Y
                                                </span>
                                                <span style="cursor: pointer"
                                                    [style.color]="row.name==colorField?  'red'  :  'gray'"
                                                    (click)="clickFillColorField(row.name)"
                                                    >
                                                    C
                                                </span>
                                            </b>
                                        </span>
                                    </clr-dg-cell>
                                </clr-dg-row>

                            </clr-datagrid>
                        </nav>
                    </div>



                    <!-- PROPERTIES -->
                    <div class="editorPropertiesTitle">
                        <b>
                            Properties
                        </b>
                        <clr-signpost>
                            <clr-icon shape="info-circle" style="margin-top: -4px;"
                                clrSignpostTrigger>
                            </clr-icon>
                            <clr-signpost-content *clrIfOpen
                                [clrPosition]="'bottom-middle'">
                                <h5 style="margin-top: 0; color:gray;">
                                    Help
                                </h5>
                                <p style="margin-top: 0; color:gray; text-align: left;">
                                    A list of properties per Field.  Click the headers below to
                                    reveal more detail.  Some are only available once the field
                                    has been selected: for example, select the X field.  Then
                                    the X Properties area will be visible.  Click the Field
                                    header inside to reveal properties that can be changed for
                                    this field like Aggregation.  Click the Axis header to change
                                    the properties of the axis like the colour.
                                </p>
                            </clr-signpost-content>
                        </clr-signpost>
                    </div>
                    <div class="editorProperties">

                        <!-- TOP 3 - 1. X field -->
                        <div class="editorLineContainer">
                            <div class="editorXFieldTitle"
                                >
                                X axis:
                                <clr-icon shape="switch right" style="cursor: pointer"
                                    size="10"
                                    title="Click to switch X and Y fields"
                                    (click)="switchXandY()"
                                    >
                                </clr-icon>
                            </div>
                            <div class="editorXField"
                                id="target"
                                (drop)="dropXField($event);"
                                (dragover)="dragoverXField($event);"
                                (dragenter)="dragenterXField($event);"
                                (dragleave)="dragleaveXField($event);"
                                [style.background-color]="isDragoverXField? 'lightgray' : 'transparent'"
                                [style.font-style]="xField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="Field on X axis"
                                (click)="clickXfield()"
                                >
                                <clr-icon shape="times" *ngIf="showXDeleteIcon"
                                    style="cursor: pointer"
                                    title="Click to remove this field from the Graph"
                                    (click)="clickClearXField()">
                                </clr-icon>
                                <span draggable="true"
                                    (dragstart)="dragstartXField($event)"
                                    >
                                    {{ xField }}
                                </span>
                            </div>
                        </div>

                        <!-- TOP 3 - 2. Y field -->
                        <div class="editorLineContainer">
                            <div class="editorYAxisFieldTitle">
                                Y axis:
                                <clr-icon shape="switch right" style="cursor: pointer"
                                    size="10"
                                    title="Click to switch X and Y fields"
                                    (click)="switchXandY()"
                                    >
                                </clr-icon>
                            </div>
                            <div class="editorYAxisField"
                                id="target"
                                (drop)="dropYField($event);"
                                (dragenter)="dragenterYField($event);"
                                (dragleave)="dragleaveYField($event);"
                                (dragover)="dragoverYField($event);"
                                [style.background-color]="isDragoverYField? 'lightgray' : 'transparent'"
                                [style.font-style]="yField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="Field on the Y axis"
                                (click)="clickYfield()"
                                >
                                <clr-icon shape="times" *ngIf="showYDeleteIcon"
                                    style="cursor: pointer"
                                    title="Click to remove this field from the Graph"
                                    (click)="clickClearYField()">
                                </clr-icon>
                                <span draggable="true"
                                    (dragstart)="dragstartYField($event)"
                                    >
                                    {{ yField }}
                                </span>
                            </div>
                        </div>

                        <!-- TOP 3 - 3. Color field -->
                        <div class="editorLineContainer">
                            <div class="editorColourFieldTitle">
                                Colour:
                            </div>
                            <div class="editorColourField"
                                id="target"
                                (drop)="dropColour($event);"
                                (dragenter)="dragenterColour($event);"
                                (dragleave)="dragleaveColour($event);"
                                (dragover)="dragoverColour($event);"
                                [style.background-color]="dragoverColours? 'lightgray' : 'transparent'"
                                [style.font-style]="colorField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="Color of the graph elements"
                                (click)="clickColorfield()"
                                >
                                <clr-icon shape="times" *ngIf="showColourDeleteIcon"
                                    style="cursor: pointer"
                                    title="Click to remove this field from the Graph"
                                    (click)="clickClearColourField()"
                                    >
                                </clr-icon>
                                <span draggable="true"
                                    (dragstart)="dragstartColorField($event)"
                                    >
                                    {{ colorField }}
                                </span>
                            </div>
                        </div>


                        <!-- HELP for Widget Editor Lite -->
                        <div class="editorWidgetEditorLite" *ngIf="showWidgetEditorLite">

                            <div class="editorWidgetEditorLiteHeader">
                                <b>Create a new graph in just a few clicks!</b>
                            </div>

                            <div class="editorWidgetEditorLiteStep1">
                                <b>Step 1:</b>
                                Select the fields to graph.  Click the X Y C buttons
                                at the end of the fields on the <i>left</i>.  Once selected,
                                the button will show in red:
                                <img
                                    [style.border]="'1px solid gray'"
                                    [style.width.%]="100"
                                    [style.height.px]="22"
                                    (click)="clickHelpMessage()"
                                    src="../images/Widget-Editor-Lite-Field.png"
                                >

                            </div>

                            <div class="editorWidgetEditorLiteStep2">
                                <b>Step 2:</b>
                                Then click the type of graph on the <i>right</i>:
                                <img
                                    [style.width.px]="85"
                                    [style.height.px]="65"
                                    (click)="clickHelpMessage()"
                                    src="../images/Widget-Editor-Lite-Graph.png"
                                >
                            </div>

                            <div class="editorWidgetEditorLiteCheckbox">
                                I know what I am doing, show the full Editor:
                                <input [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXbin"
                                    type="checkbox"
                                    name="graphXbin"
                                    (click)="clickShowFullEditor()"
                                    title="Show the full Editor (T/F)"
                                    >

                            </div>
                        </div>

                        <!-- TITLE -->
                        <!-- Title Header -->
                        <div class="editorTitleTitle"
                            title="Click to amend properties of the Graph Title"
                            (click)="clickShowTitleProperties()"
                            >
                            <b>
                                Title
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldTitleProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldTitleProperties"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Title Text -->
                        <div class="editorLineContainer">
                            <div class="editorTitleTextTitle" *ngIf="showFieldTitleProperties">
                                Text:
                            </div>
                            <div class="editorTitleText" *ngIf="showFieldTitleProperties">
                                <input type="text"
                                    placeholder="Text of title"
                                    [(ngModel)]="localWidget.graphTitleText"
                                    name="graphTitleText"
                                    style="border-radius: 5px; width: 100%;"
                                    title="Text of the Graph Title"
                                    >
                            </div>
                        </div>

                        <!-- Title Anchor -->
                        <div class="editorLineContainer">
                            <div class="editorTitleAnchorTitle" *ngIf="showFieldTitleProperties">
                                Anchor:
                            </div>
                            <div class="select editorTitleAnchor" *ngIf="showFieldTitleProperties"
                                title="Title Orientation"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphTitleAnchor"
                                    >
                                    <option>Start</option>
                                    <option>Middle</option>
                                    <option>End</option>
                                </select>
                            </div>
                        </div>

                        <!-- Title Angle in degrees -->
                        <div class="editorLineContainer">
                            <div class="editorTitleAngleTitle" *ngIf="showFieldTitleProperties">
                                Angle:
                            </div>
                            <div class="editorTitleAngle" *ngIf="showFieldTitleProperties">
                                <input type="number"
                                    placeholder="Angle of title"
                                    [(ngModel)]="localWidget.graphTitleAngle"
                                    min="0"
                                    max="360"
                                    name="titleAngle"
                                    title="Angle of the title in degrees 0-360"
                                    >
                            </div>
                        </div>

                        <!-- Title Background color for GRAPH  -->
                        <div class="editorLineContainer">
                            <div class="editorTitleBackgroundTitle" *ngIf="showFieldTitleProperties">
                                Bg Color:
                            </div>
                            <div class="select editorTitleBackground" *ngIf="showFieldTitleProperties">
                                <select [(ngModel)]="localWidget.graphBackgroundColorName"
                                    name="graphBackgroundColorName"
                                    (change)="clickSelectBackgroundColor($event)"
                                    title="Color of the Graph Background"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Title Vertical text baseline for title text. -->
                        <div class="editorLineContainer">
                            <div class="editorTitleBaselineTitle" *ngIf="showFieldTitleProperties">
                            Baseline:
                            </div>
                            <div class="select editorTitleBaseline" *ngIf="showFieldTitleProperties"
                                title="Baseline of title"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphTitleBaseline"
                                    >
                                    <option>Top</option>
                                    <option>Middle</option>
                                    <option>Bottom</option>
                                </select>
                            </div>
                        </div>

                        <!-- Title Text color for title text.  -->
                        <div class="editorLineContainer">
                            <div class="editorTitleColourTitle" *ngIf="showFieldTitleProperties">
                            Color:
                            </div>
                            <div class="select editorTitleColour" *ngIf="showFieldTitleProperties">
                                <select [(ngModel)]="localWidget.graphTitleColorName"
                                    name="graphTitleColorName"
                                    (change)="clickSelectTitleColor($event)"
                                    title="Color of title text"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Title Font name for title text. -->
                        <div class="editorLineContainer">
                            <div class="editorTitleFontTitle" *ngIf="showFieldTitleProperties">
                            Font:
                            </div>
                            <div class="editorTitleFont" *ngIf="showFieldTitleProperties">
                                <input type="text"
                                    placeholder="Font name"
                                    [(ngModel)]="localWidget.graphTitleFont"
                                    name="graphTitleFont"
                                    title="Name of the font, ie Arial"
                                    >
                            </div>
                        </div>

                        <!-- Title Font size in pixels for title text. Default value: 10. -->
                        <div class="editorLineContainer">
                            <div class="editorTitleFontSizeTitle" *ngIf="showFieldTitleProperties">
                            Font Size:
                            </div>
                            <div class="editorTitleFontSize" *ngIf="showFieldTitleProperties">
                                <input type="number"
                                    placeholder="Font Size"
                                    [(ngModel)]="localWidget.graphTitleFontSize"
                                    min="0"
                                    max="300"
                                    name="graphTitleFontSize"
                                    title="Size of font in px, ie 12 for small font size"
                                    >
                            </div>
                        </div>

                        <!-- Title Font Weight in pixels for title text. Default value: 10. -->
                        <div class="editorLineContainer">
                            <div class="editorTitleFontWeightTitle" *ngIf="showFieldTitleProperties">
                            Font Weight:
                            </div>
                            <div class="editorTitleFontWeight" *ngIf="showFieldTitleProperties">
                                <input type="number"
                                    placeholder="Font Weight (100, 200..900)"
                                    [(ngModel)]="localWidget.graphTitleFontWeight"
                                    min="0"
                                    max="900"
                                    name="graphTitleFontWeight"
                                    title="Font weight, 400 normal and 700 bold"
                                    >
                            </div>
                        </div>

                        <!-- Title limit: The maximum allowed length in pixels of the labels.-->
                        <div class="editorLineContainer">
                            <div class="editorTitleLengthTitle" *ngIf="showFieldTitleProperties">
                            Length:
                            </div>
                            <div class="editorTitleLength" *ngIf="showFieldTitleProperties">
                                <input type="number"
                                    placeholder="Max length in px"
                                    [(ngModel)]="localWidget.graphTitleLength"
                                    name="graphTitleLength"
                                    min="0"
                                    max="500"
                                    title="Length of the title in px"
                                    >
                            </div>
                        </div>

                        <!-- Title orient: Default title orientation ("top", "bottom", "left", or "right") -->
                        <div class="editorLineContainer">
                            <div class="editorTitleOrientationTitle" *ngIf="showFieldTitleProperties">
                            Orientation:
                            </div>
                            <div class="select editorTitleOrientation" *ngIf="showFieldTitleProperties"
                                title="Position where the title must be place on Graph"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphTitleOrientation"
                                    >
                                    <option>Top</option>
                                    <option>Bottom</option>
                                    <option>Left</option>
                                    <option>Right</option>
                                </select>
                            </div>
                        </div>


                        <!-- X Properties Title Bar -->
                        <div class="editorXPropertiesTitle" *ngIf="showFieldXPropertiesTitle"
                            title="Click to amend properties of the X field and axis"
                            (click)="clickShowXProperties()"
                            >
                            <b>
                                X Properties
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldXProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldXProperties"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- X Axis sub Header -->
                        <div class="editorXPropertiesTitleField" *ngIf="showFieldXProperties"
                            title="Click to amend properties of the X field"
                            (click)="clickShowXPropertiesField()"
                            >
                            <b>
                                Field
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldXPropertiesField"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldXPropertiesField"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- X Properties Aggregate -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXaggregateTitle" *ngIf="showFieldXPropertiesField">
                                Aggregate:
                            </div>
                            <div class="select editorGraphXaggregate" *ngIf="showFieldXPropertiesField"
                                title="How the X values must be aggregated, ie Count"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXaggregateName"
                                    name="graphXaggregateName"
                                    >
                                    <option *ngFor="let row of aggregations; let i = index">
                                        {{ row.displayName }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- X Properties bin -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXbinTitle" *ngIf="showFieldXPropertiesField">
                                Bin:
                            </div>
                            <div class="editorGraphXbin" *ngIf="showFieldXPropertiesField">
                                <input [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXbin"
                                    type="checkbox"
                                    name="graphXbin"
                                    (click)="clickXBin()"
                                    title="Bin the X field (T/F)"
                                    >
                            </div>
                            <div class="editorGraphXbinMaxTitle" *ngIf="showFieldXPropertiesField">
                                Est bins:
                            </div>

                            <div class="editorGraphXbinMax" *ngIf="showFieldXPropertiesField">
                                <input type="number"
                                    name="graphXMaxBins"
                                    placeholder="Est. nr of bins"
                                    min="1"
                                    max="10"
                                    size="5"
                                    style="width: 25px;"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXMaxBins"
                                    title="Estimated number of bins"
                                    >
                            </div>
                        </div>

                        <!-- X Properties Format -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXformatTitle" *ngIf="showFieldXPropertiesField">
                            Format:
                            </div>
                            <div class="editorGraphXformat" *ngIf="showFieldXPropertiesField">
                                <input type="text"
                                    placeholder="Only for Text"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXformat"
                                    name="graphXformat"
                                    title="Format of text values"
                                    >
                            </div>
                        </div>

                        <!-- X Properties Impute -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXimputeTitle" *ngIf="showFieldXPropertiesField">
                                Impute:
                            </div>
                            <div class="select editorGraphXimpute" *ngIf="showFieldXPropertiesField"
                                title="Fill in missing value, ie with the average of a column"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXimpute"
                                    name="graphXimpute"
                                    >
                                    <option></option>
                                    <option>Max</option>
                                    <option>Mean</option>
                                    <option>Medium</option>
                                    <option>Min</option>
                                    <option>Value</option>
                                </select>
                            </div>
                            <div class="editorGraphXimputeValue"
                                *ngIf="showFieldXPropertiesField"
                                size="5"
                                >
                                <input type="number"
                                    placeholder="Value"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXimputeValue"
                                    name="graphXimputeValue"
                                    [disabled]="!(localWidget.graphLayers[currentGraphLayer - 1].graphXimpute=='Value')"
                                    size="5"
                                    title="Fixed value into missing values"
                                    >
                            </div>
                        </div>

                        <!-- X Properties stack -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXstackTitle" *ngIf="showFieldXPropertiesField">
                                Stack:
                            </div>
                            <div class="select editorGraphXstack" *ngIf="showFieldXPropertiesField"
                                title="Specify how the X values must be stacked"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXstack"
                                    name="graphXstack"
                                    >
                                    <option>Zero</option>
                                    <option>Normalize</option>
                                    <option>Center</option>
                                    <option>Null</option>
                                </select>
                            </div>
                        </div>

                        <!-- X Properties Sort -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXsortTitle" *ngIf="showFieldXPropertiesField">
                                Sort:
                            </div>
                            <div class="select editorGraphXsort" *ngIf="showFieldXPropertiesField"
                                title="Specify how the X values must be sorted"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXsort"
                                    name="graphXsort"
                                    >
                                    <option>None</option>
                                    <option>Ascending</option>
                                    <option>Descending</option>
                                </select>
                            </div>
                        </div>

                        <!-- X Properties type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXtypeTitle" *ngIf="showFieldXPropertiesField">
                                Type:
                            </div>
                            <div class="select editorGraphXtype" *ngIf="showFieldXPropertiesField"
                                title="Type of the X field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXtypeName"
                                    (change)="changeXType($event)"
                                    name="graphXtypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>

                        <!-- X Properties timeUnit -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXtimeUnitTitle" *ngIf="showFieldXPropertiesField">
                                TimeUnit:
                            </div>
                            <div class="select editorGraphXtimeUnit"
                                *ngIf="showFieldXPropertiesField"
                                title="Time unit for Temporate (date) fields"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXtimeUnit"
                                    [disabled]="localWidget.graphLayers[currentGraphLayer - 1].graphXtypeName!='Temporal'
                                             && localWidget.graphLayers[currentGraphLayer - 1].graphXtypeName!='Ordinal'"
                                    >
                                    <option *ngFor="let row of timeUnits; let i = index">
                                        {{ row }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- X Axis Sub Header -->
                        <div class="editorXPropertiesTitleAxis" *ngIf="showFieldXProperties"
                            title="Click to amend properties of the X axis"
                            (click)="clickShowXPropertiesAxis()"
                            >
                            <b>
                                Axis
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldXPropertiesAxis"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldXPropertiesAxis"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- X-Axis Scale Type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXaxisScaleTypeTitle" *ngIf="showFieldXPropertiesAxis">
                                Type:
                            </div>
                            <div class="select editorGraphXaxisScaleType"
                                *ngIf="showFieldXPropertiesAxis"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXaxisScaleType"
                                    >
                                    <option>Default</option>
                                    <option>Linear</option>
                                    <option>Log</option>
                                    <option>Quantile</option>
                                </select>
                            </div>
                        </div>

                        <!-- X-Axis Title -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXaxisTitleTitle" *ngIf="showFieldXPropertiesAxis">
                                Title:
                            </div>
                            <div class="editorGraphXaxisTitleCheckbox" *ngIf="showFieldXPropertiesAxis">
                                <input [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXaxisTitleCheckbox"
                                    type="checkbox"
                                    name="graphXaxisTitleCheckbox"
                                    title="Show the Axis Title (T/F)"
                                    >
                            </div>
                            <div class="editorGraphXaxisTitle" *ngIf="showFieldXPropertiesAxis"
                                >
                                <input type="text"
                                    placeholder="Blank = field name"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXaxisTitle"
                                    name="graphXaxisTitle"
                                    >
                            </div>
                        </div>

                        <!-- X Axis LabelAngle -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXaxisLabelAngleTitle" *ngIf="showFieldXPropertiesAxis">
                            Angle:
                            </div>
                            <div class="editorGraphXaxisLabelAngle" *ngIf="showFieldXPropertiesAxis">
                                <input type="number"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXaxisLabelAngle"
                                    name="graphXaxisLabelAngle"
                                    placeholder="Label Angle"
                                    >
                            </div>
                        </div>

                        <!-- X Axis Format -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXaxisFormatTitle" *ngIf="showFieldXPropertiesAxis">
                            Format:
                            </div>
                            <div class="editorGraphXaxisFormat" *ngIf="showFieldXPropertiesAxis">
                                <input type="text"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXaxisFormat"
                                    name="graphXaxisFormat"
                                    placeholder="ie .2s +$,.2f"
                                    >
                            </div>
                        </div>

                        <!-- X-Axis Grid -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXaxisGridTitle" *ngIf="showFieldXPropertiesAxis">
                                Grid:
                            </div>
                            <div class="editorGraphXaxisGrid" *ngIf="showFieldXPropertiesAxis">
                                <input type="checkbox"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXaxisGrid"
                                    name="graphXaxisGrid"
                                    title="Show Grid lines (T/F)"
                                    >
                            </div>
                            <div class="select editorGraphXaxisGridColor" *ngIf="showFieldXPropertiesAxis">
                                <select [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXaxisGridColorName"
                                    name="graphXaxisGridColorName"
                                    (change)="clickSelectXGridColor($event)"
                                    title="Color of the X gridlines"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>

                        </div>

                        <!-- X Axis Labels -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXaxisLabelsTitle" *ngIf="showFieldXPropertiesAxis">
                            Labels:
                            </div>
                            <div class="editorGraphXaxisLabels" *ngIf="showFieldXPropertiesAxis">
                                <input type="checkbox"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXaxisLabels"
                                    name="graphXaxisLabels"
                                    title="Show labels (T/F)"
                                    >
                            </div>
                            <div class="select editorGraphXaxisLabelsColor" *ngIf="showFieldXPropertiesAxis">
                                <select [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphXaxisLabelColorName"
                                    name="graphXaxisLabelColorName"
                                    (change)="clickSelectXLabelColor($event)"
                                    title="Color of the X labels"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- X Axis: The maximum allowed length in pixels of the labels.-->
                        <div class="editorLineContainer">
                            <div class="editorGraphXaxisLabelLengthTitle" *ngIf="showFieldXPropertiesAxis">
                            Length:
                            </div>
                            <div class="editorGraphXaxisLabelLength" *ngIf="showFieldXPropertiesAxis">
                                <input type="number"
                                    placeholder="Max length in px"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphDimensionBottom"
                                    name="graphDimensionBottom"
                                    min="0"
                                    max="500"
                                    title="Length of the X axis Labels in px"
                                    >
                            </div>
                        </div>



                        <!-- Y Properties Title Bar -->
                        <div class="editorYPropertiesTitle" *ngIf="showFieldYPropertiesTitle"
                            title="Click to amend properties of the Y field and axis"
                            (click)="clickShowYProperties()"
                            >
                            <b>
                                Y Properties
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldYProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldYProperties"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Y Field sub Header -->
                        <div class="editorYPropertiesTitleField" *ngIf="showFieldYProperties"
                            title="Click to amend properties of the Y field"
                            (click)="clickShowYPropertiesField()"
                            >
                            <b>
                                Field
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldYPropertiesField"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldYPropertiesField"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Y Properties aggregate -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYaggregateTitle" *ngIf="showFieldYPropertiesField">
                                Aggregate:
                            </div>
                            <div class="select editorGraphYaggregate" *ngIf="showFieldYPropertiesField">
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYaggregateName"
                                    name="graphYaggregateName"
                                    title="How Y values must be aggregated, ie Count"
                                    >
                                    <option *ngFor="let row of aggregations; let i = index">
                                        {{ row.displayName }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Properties bin -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYbinTitle" *ngIf="showFieldYPropertiesField">
                                Bin:
                            </div>
                            <div class="editorGraphYbin" *ngIf="showFieldYPropertiesField">
                                <input [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYbin"
                                    type="checkbox"
                                    name="graphXbin"
                                    (click)="clickYBin()"
                                    title="Bin the Y field (T/F)"
                                    >
                            </div>
                            <div class="editorGraphYbinMaxTitle" *ngIf="showFieldYPropertiesField">
                                Est bins:
                            </div>

                            <div class="editorGraphYbinMax" *ngIf="showFieldYPropertiesField">
                                <input type="number"
                                    placeholder="Est. nr of bins"
                                    size="5"
                                    style="width: 25px;"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYMaxBins"
                                    name="graphYMaxBins"
                                    title="Estimated number of bins"
                                    >
                            </div>
                        </div>

                        <!-- Y Properties Format -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYformatTitle" *ngIf="showFieldYPropertiesField">
                                Format:
                            </div>
                            <div class="editorGraphYformat" *ngIf="showFieldYPropertiesField">
                                <input type="text"
                                    placeholder="Only for Text"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYformat"
                                    name="graphYformat"
                                    title="Format of text values"
                                    >
                            </div>
                        </div>

                        <!-- Y Properties Impute -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYimputeTitle" *ngIf="showFieldYPropertiesField">
                                Impute:
                            </div>
                            <div class="select editorGraphYimpute" *ngIf="showFieldYPropertiesField"
                                title="Fill in missing value, ie with the average of a column"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYimpute"
                                    name="graphYimpute"
                                    >
                                    <option></option>
                                    <option>Max</option>
                                    <option>Mean</option>
                                    <option>Medium</option>
                                    <option>Min</option>
                                    <option>Value</option>
                                </select>
                            </div>
                            <div class="editorGraphYimputeValue"
                                *ngIf="showFieldYPropertiesField"
                                size="5"
                                >
                                <input type="number"
                                    placeholder="Value"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYimputeValue"
                                    name="graphYimputeValue"
                                    [disabled]="!(localWidget.graphLayers[currentGraphLayer - 1].graphYimpute=='Value')"
                                    size="5"
                                    title="Fixed value into missing values"
                                    >
                            </div>
                        </div>

                        <!-- Y Properties stack -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYstackTitle" *ngIf="showFieldYPropertiesField">
                                Stack:
                            </div>
                            <div class="select editorGraphYstack" *ngIf="showFieldYPropertiesField"
                                title="How Y values must be stacked"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYstack"
                                    name="graphYstack"
                                    >
                                    <option>Zero</option>
                                    <option>Normalize</option>
                                    <option>Center</option>
                                    <option>Null</option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Properties Sort -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYsortTitle" *ngIf="showFieldYPropertiesField">
                                Sort:
                            </div>
                            <div class="select editorGraphYsort" *ngIf="showFieldYPropertiesField"
                                title="How Y values must be sorted"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYsort"
                                    name="graphYsort"
                                    >
                                    <option>None</option>
                                    <option>Ascending</option>
                                    <option>Descending</option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Properties type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYtypeTitle" *ngIf="showFieldYPropertiesField">
                                Type:
                            </div>
                            <div class="select editorGraphYtype" *ngIf="showFieldYPropertiesField"
                                title="Type of the X field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYtypeName"
                                    (change)="changeYType($event)"
                                    name="graphYtypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Properties timeUnit -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYtimeUnitTitle" *ngIf="showFieldYPropertiesField">
                                TimeUnit:
                            </div>
                            <div class="select editorGraphYtimeUnit"
                                *ngIf="showFieldYPropertiesField"
                                title="Time unit for Temporate (date) fields"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYtimeUnit"
                                    [disabled]="localWidget.graphLayers[currentGraphLayer - 1].graphYtypeName!='Temporal'
                                             && localWidget.graphLayers[currentGraphLayer - 1].graphYtypeName!='Ordinal'"
                                    >
                                    <option *ngFor="let row of timeUnits; let i = index">
                                        {{ row }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Axis Subheader -->
                        <div class="editorYPropertiesTitleAxis" *ngIf="showFieldYProperties"
                            title="Click to amend properties of the Y axis"
                            (click)="clickShowYPropertiesAxis()"
                            >
                            <b>
                                Axis
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldYPropertiesAxis"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldYPropertiesAxis"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Y-Axis Scale Type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYaxisScaleTypeTitle" *ngIf="showFieldYPropertiesAxis">
                                Type:
                            </div>
                            <div class="select editorGraphYaxisScaleType"
                                *ngIf="showFieldYPropertiesAxis"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYaxisScaleType"
                                    >
                                    <option>Default</option>
                                    <option>Linear</option>
                                    <option>Log</option>
                                    <option>Quantile</option>
                                </select>
                            </div>
                        </div>

                        <!-- Y-Axis Title -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYaxisTitleTitle" *ngIf="showFieldYPropertiesAxis">
                                Title:
                            </div>
                            <div class="editorGraphYaxisTitleCheckbox" *ngIf="showFieldYPropertiesAxis">
                                <input [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYaxisTitleCheckbox"
                                    type="checkbox"
                                    name="graphYaxisTitleCheckbox"
                                    title="Show the Axis Title (T/F)"
                                    >
                            </div>
                            <div class="editorGraphYaxisTitle" *ngIf="showFieldYPropertiesAxis"
                                >
                                <input type="text"
                                    placeholder="Blank = field name"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYaxisTitle"
                                    name="graphYaxisTitle"
                                    >
                            </div>
                        </div>

                        <!-- Y Axis LabelAngle -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYaxisLabelAngleTitle" *ngIf="showFieldYPropertiesAxis">
                            Angle:
                            </div>
                            <div class="editorGraphYaxisLabelAngle" *ngIf="showFieldYPropertiesAxis">
                                <input type="number"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYaxisLabelAngle"
                                    name="graphYaxisLabelAngle"
                                    placeholder="Label Angle"
                                    >
                            </div>
                        </div>

                        <!-- Y Axis Format -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYaxisFormatTitle" *ngIf="showFieldYPropertiesAxis">
                            Format:
                            </div>
                            <div class="editorGraphYaxisFormat" *ngIf="showFieldYPropertiesAxis">
                                <input type="text"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYaxisFormat"
                                    name="graphYaxisFormat"
                                    placeholder="ie .2s +$,.2f"
                                    >
                            </div>
                        </div>

                        <!-- Y-Axis Grid -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYaxisGridTitle" *ngIf="showFieldYPropertiesAxis">
                                Grid:
                            </div>
                            <div class="editorGraphYaxisGrid" *ngIf="showFieldYPropertiesAxis">
                                <input type="checkbox"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYaxisGrid"
                                    name="graphYaxisGrid"
                                    title="Show Grid lines (T/F)"
                                    >
                            </div>
                            <div class="select editorGraphYaxisGridColor" *ngIf="showFieldYPropertiesAxis">
                                <select [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYaxisGridColorName"
                                    name="graphYaxisGridColorName"
                                    (change)="clickSelectYGridColor($event)"
                                    title="Color of the Y gridlines"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Axis Labels -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYaxisLabelsTitle" *ngIf="showFieldYPropertiesAxis">
                            Labels:
                            </div>
                            <div class="editorGraphYaxisLabels" *ngIf="showFieldYPropertiesAxis">
                                <input type="checkbox"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYaxisLabels"
                                    name="graphYaxisLabels"
                                    title="Show labels (T/F)"
                                    >
                            </div>
                            <div class="select editorGraphYaxisLabelsColor" *ngIf="showFieldYPropertiesAxis">
                                <select [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphYaxisLabelColorName"
                                    name="graphYaxisLabelColorName"
                                    (change)="clickSelectYLabelColor($event)"
                                    title="Color of the Y labels"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Axis: The maximum allowed length in pixels of the labels.-->
                        <div class="editorLineContainer">
                            <div class="editorGraphYaxisLabelLengthTitle" *ngIf="showFieldYPropertiesAxis">
                            Length:
                            </div>
                            <div class="editorGraphYaxisLabelLength" *ngIf="showFieldYPropertiesAxis">
                                <input type="number"
                                    placeholder="Max length in px"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphDimensionLeft"
                                    name="graphDimensionLeft"
                                    min="0"
                                    max="500"
                                    title="Length of the Y axis Labels in px"
                                    >
                            </div>
                        </div>


                        <!-- Color Properties Title Bar -->
                        <div class="editorColorPropertiesTitle" *ngIf="showFieldColorPropertiesTitle"
                            title="Click to amend properties of the Colour field and legend"
                            (click)="clickShowColorProperties()"
                            >
                            <b>
                                Color Properties
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldColorProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldColorProperties"
                                size="12"
                                >
                            </clr-icon>
                        </div>



                        <!-- Color Field sub Header -->
                        <div class="editorColorPropertiesTitleField" *ngIf="showFieldColorProperties"
                            title="Click to amend properties of the Colour field"
                            (click)="clickShowColorPropertiesField()"
                            >
                            <b>
                                Field
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldColorPropertiesField"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldColorPropertiesField"
                                size="12"
                                >
                            </clr-icon>
                        </div>


                        <!-- Color Properties Aggregate -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorAggregateTitle" *ngIf="showFieldColorPropertiesField">
                                Aggregate:
                            </div>
                            <div class="select editorGraphColorAggregate" *ngIf="showFieldColorPropertiesField"
                                title="How the Color values must be aggregated, ie Count"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphColorAggregateName"
                                    name="graphColorAggregateName"
                                    >
                                    <option *ngFor="let row of aggregations; let i = index">
                                        {{ row.displayName }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Color Properties bin -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorBinTitle" *ngIf="showFieldColorPropertiesField">
                                Bin:
                            </div>
                            <div class="editorGraphColorBin" *ngIf="showFieldColorPropertiesField">
                                <input [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphColorBin"
                                    type="checkbox"
                                    name="graphXbin"
                                    (click)="clickColorBin()"
                                    title="Bin the Color field (T/F)"
                                    >
                            </div>
                            <div class="editorGraphColorbinMaxTitle" *ngIf="showFieldColorPropertiesField">
                                Est bins:
                            </div>

                            <div class="editorGraphColorbinMax" *ngIf="showFieldColorPropertiesField">
                                <input type="number"
                                    placeholder="Est. nr of bins"
                                    size="5"
                                    style="width: 25px;"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphColorMaxBins"
                                    name="graphColorMaxBins"
                                    title="Estimated number of bins"
                                    >
                            </div>
                        </div>

                        <!-- Color Properties Format -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorFormatTitle" *ngIf="showFieldColorPropertiesField">
                                Format:
                            </div>
                            <div class="editorGraphColorFormat" *ngIf="showFieldColorPropertiesField">
                                <input type="text"
                                    placeholder="ie .2s +$,.2f"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphColorFormat"
                                    name="graphColorFormat"
                                    >
                            </div>
                        </div>

                        <!-- Color Properties Impute -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorImputeTitle" *ngIf="showFieldColorPropertiesField"
                                title="Fill in missing value, ie with the average of a column"
                                >
                                Impute:
                            </div>
                            <div class="select editorGraphColorImpute" *ngIf="showFieldColorPropertiesField">
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphColorImpute"
                                    name="graphColorImpute"
                                    >
                                    <option></option>
                                    <option>Max</option>
                                    <option>Mean</option>
                                    <option>Medium</option>
                                    <option>Min</option>
                                    <option>Value</option>
                                </select>
                            </div>
                            <div class="editorGraphColorImputeValue"
                                *ngIf="showFieldColorPropertiesField"
                                size="5"
                                >
                                <input type="number"
                                    placeholder="Value"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphColorImputeValue"
                                    name="graphColorImputeValue"
                                    [disabled]="!(localWidget.graphLayers[currentGraphLayer - 1].graphColorImpute=='Value')"
                                    size="5"
                                    title="Fixed value into missing values"
                                    >
                            </div>
                        </div>

                        <!-- Color Properties Scheme -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorSchemeTitle" *ngIf="showFieldColorPropertiesField">
                                Scheme:
                            </div>
                            <div class="select editorGraphColorScheme" *ngIf="showFieldColorPropertiesField">
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphColorScheme"
                                    name="graphColorScheme"
                                    >
                                    <option *ngFor="let row of vegaColorSchemes; let i = index">
                                        {{ row }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Color Properties Sort -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorSortTitle" *ngIf="showFieldColorPropertiesField">
                                Sort:
                            </div>
                            <div class="select editorGraphColorSort" *ngIf="showFieldColorPropertiesField">
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphColorSort"
                                    name="graphColorSort"
                                    >
                                    <option>None</option>
                                    <option>Ascending</option>
                                    <option>Descending</option>
                                </select>
                            </div>
                        </div>

                        <!-- Color Properties stack -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorStackTitle" *ngIf="showFieldColorPropertiesField">
                                Stack:
                            </div>
                            <div class="select editorGraphColorStack" *ngIf="showFieldColorPropertiesField">
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphColorStack"
                                    name="graphColorStack"
                                    >
                                    <option>Zero</option>
                                    <option>Normalize</option>
                                    <option>Center</option>
                                    <option>Null</option>
                                </select>
                            </div>
                        </div>

                        <!-- Color Properties type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorTypeTitle" *ngIf="showFieldColorPropertiesField">
                                Type:
                            </div>
                            <div class="select editorGraphColorType" *ngIf="showFieldColorPropertiesField"
                                title="Type of the Color field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphColorTypeName"
                                    (change)="changeColorType($event)"
                                    name="graphColorTypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>

                        <!-- Color Properties timeUnit -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorTimeUnitTitle" *ngIf="showFieldColorPropertiesField">
                                TimeUnit:
                            </div>
                            <div class="select editorGraphColorTimeUnit"
                                *ngIf="showFieldColorPropertiesField"
                                title="Time unit for Temporate (date) fields"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphColorTimeUnit"
                                    [disabled]="localWidget.graphLayers[currentGraphLayer - 1].graphColorTypeName!='Temporal'
                                             && localWidget.graphLayers[currentGraphLayer - 1].graphColorTypeName!='Ordinal'"
                                    >
                                    <option *ngFor="let row of timeUnits; let i = index">
                                        {{ row }}
                                    </option>
                                </select>
                            </div>
                        </div>


                        <!-- Color Legend Subheader -->
                        <div class="editorColorPropertiesTitleAxis" *ngIf="showFieldColorProperties"
                        title="Click to amend properties of the legend"
                        (click)="clickShowColorPropertiesLegend()"
                            >
                            <b>
                                Legend
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldColorPropertiesLegend"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldColorPropertiesLegend"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Legand-Axis Scale Type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphLegendAxisScaleTypeTitle" *ngIf="showFieldColorPropertiesLegend">
                                Type:
                            </div>
                            <div class="select editorGraphLegendAxisScaleType" *ngIf="showFieldColorPropertiesLegend"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphLegendAxisScaleType"
                                    >
                                    <option>Default</option>
                                    <option>Linear</option>
                                    <option>Log</option>
                                    <option>Quantile</option>
                                </select>
                            </div>
                        </div>

                        <!-- Legend-Axis: Hide -->
                        <div class="editorLineContainer">
                            <div class="editorGraphLegendHideTitle" *ngIf="showFieldColorPropertiesLegend">
                                Hide:
                            </div>
                            <div class="editorGraphLegendHide" *ngIf="showFieldColorPropertiesLegend">
                                <input [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphLegendHide"
                                    type="checkbox"
                                    name="graphLegendHide"
                                    title="Hide the whole Legend (T/F)"
                                    >
                            </div>
                        </div>

                        <!-- Legend-Axis: Title -->
                        <div class="editorLineContainer">
                            <div class="editorGraphLegendTitleTitle" *ngIf="showFieldColorPropertiesLegend">
                                Title:
                            </div>
                            <div class="editorGraphLegendTitleCheckbox" *ngIf="showFieldColorPropertiesLegend">
                                <input [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphLegendTitleCheckbox"
                                    type="checkbox"
                                    name="graphLegendTitleCheckbox"
                                    title="Show the Axis Title (T/F)"
                                    >
                            </div>
                            <div class="editorGraphLegendTitle" *ngIf="showFieldColorPropertiesLegend"
                                >
                                <input type="text"
                                    placeholder="Blank = field name"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphLegendTitle"
                                    name="graphLegendTitle"
                                    title="Text of the Legend Title"
                                    >
                            </div>
                        </div>

                        <!-- Legend-Axis: Format -->
                        <div class="editorLineContainer">
                            <div class="editorGraphLegendFormatTitle" *ngIf="showFieldColorPropertiesLegend">
                            Format:
                            </div>
                            <div class="editorGraphLegendFormat" *ngIf="showFieldColorPropertiesLegend">
                                <input type="text"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphLegendFormat"
                                    name="graphLegendFormat"
                                    placeholder="ie .2s +$,.2f"
                                    title="Format (D3) of the legend, ie .1f for one decimal"
                                    >
                            </div>
                        </div>

                        <!-- Legend-Axis: Labels -->
                        <div class="editorLineContainer">
                            <div class="editorGraphLegendLabelsTitle" *ngIf="showFieldColorPropertiesLegend">
                            Labels:
                            </div>
                            <div class="editorGraphLegendLabels" *ngIf="showFieldColorPropertiesLegend">
                                <input type="checkbox"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphLegendLabels"
                                    name="graphLegendLabels"
                                    title="Show labels (T/F)"
                                    >
                            </div>
                            <div class="select editorGraphLegendLabelsColor" *ngIf="showFieldColorPropertiesLegend">
                                <select [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphLegendLabelColorName"
                                    name="graphLegendLabelColorName"
                                    (change)="clickSelectLegendLabelColor($event)"
                                    title="Color of the X labels"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Legend-Axis:: The maximum allowed length in pixels of legend labels.-->
                        <div class="editorLineContainer">
                            <div class="editorGraphLegendLabelLengthTitle" *ngIf="showFieldColorPropertiesLegend">
                            Length:
                            </div>
                            <div class="editorGraphLegendLabelLength" *ngIf="showFieldColorPropertiesLegend">
                                <input type="number"
                                    placeholder="Max length in px"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphDimensionRight"
                                    name="graphDimensionRight"
                                    min="0"
                                    max="500"
                                    title="Length of the Legend Labels in px"
                                    >
                            </div>
                        </div>



                        <!-- Mark Title Bar -->
                        <div class="editorMarkTitle"
                            title="Click to amend properties of the Mark / Type of graph"
                            (click)="clickShowMarkProperties()"
                            >
                            <b>
                                Mark
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldMarkProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldMarkProperties"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Mark Properties Color -->
                        <div class="editorLineContainer">
                            <div class="editorGraphMarkColourTitle" *ngIf="showFieldMarkProperties">
                            Color:
                            </div>
                            <div class="select editorGraphMarkColour" *ngIf="showFieldMarkProperties"
                                title="Color of the mark, ie red for a line Graph"
                                >
                                <select [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphMarkColourName"
                                    name="graphMarkColourName"
                                    (change)="clickSelectMarkColour($event)"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Mark Properties Corner Radius -->
                        <div class="editorLineContainer">
                            <div class="editorGraphMarkCornerRadiusTitle" *ngIf="showFieldMarkProperties">
                            Corner:
                            </div>
                            <div class="editorGraphMarkCornerRadius" *ngIf="showFieldMarkProperties">
                                <input type="number"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphMarkCornerRadius"
                                    name="graphMarkCornerRadius"
                                    placeholder="Mark corner radius"
                                    title="Radius of bar corners, in px"
                                    >
                            </div>
                        </div>

                        <!-- Mark Properties Extent -->
                        <div class="editorLineContainer">
                            <div class="editorGraphMarkExtentTitle" *ngIf="showFieldMarkProperties">
                                Extent:
                            </div>
                            <div class="select editorGraphMarkExtent" *ngIf="showFieldMarkProperties">
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphMarkExtent"
                                    name="graphMarkExtent"
                                    title="Extent of the Extent Band / Bar"
                                    >
                                    <option>Confidence Interval</option>
                                    <option>Std Error</option>
                                    <option>Std Deviation</option>
                                    <option>Q1 and Q3</option>
                                </select>
                            </div>
                        </div>

                        <!-- Mark Properties interpolate -->
                        <div class="editorLineContainer">
                            <div class="editorGraphMarkInterpolateTitle" *ngIf="showFieldMarkProperties">
                                Interpolate:
                            </div>
                            <div class="select editorGraphMarkInterpolate" *ngIf="showFieldMarkProperties"
                                title="Specify how the values must be interpolated"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphMarkInterpolate"
                                    name="graphMarkInterpolate"
                                    [disabled]="localWidget.graphLayers[currentGraphLayer - 1].graphMark!='line'
                                                && localWidget.graphLayers[currentGraphLayer - 1].graphMark!='area'"
                                    >
                                    <option></option>
                                    <option>Step</option>
                                </select>
                            </div>
                        </div>

                        <!-- Mark Properties Line -->
                        <div class="editorLineContainer">
                            <div class="editorGraphMarkLineTitle" *ngIf="showFieldMarkProperties">
                                Line:
                            </div>
                            <div class="editorGraphMarkLine" *ngIf="showFieldMarkProperties">
                                <input [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphMarkLine"
                                    type="checkbox"
                                    name="graphMarkLine"
                                    title="Add line to graph (T/F)"
                                    >
                            </div>
                        </div>

                        <!-- Mark Properties Opacity -->
                        <div class="editorLineContainer">
                            <div class="editorGraphMarkOpacityTitle" *ngIf="showFieldMarkProperties">
                                    Opacity:
                            </div>
                            <div class="editorGraphMarkOpacity" *ngIf="showFieldMarkProperties">
                                <input type="number"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphMarkOpacity"
                                    name="graphMarkOpacity"
                                    min="0"
                                    max="1"
                                    step=".1"
                                    placeholder="Mark corner radius"
                                    title="Opacity, 0 = invisible, 1 = opaque"
                                    >
                            </div>
                        </div>

                        <!-- Mark Properties Orient -->
                        <div class="editorLineContainer">
                            <div class="editorGraphMarkOrientTitle" *ngIf="showFieldMarkProperties">
                                Orient:
                            </div>
                            <div class="select editorGraphMarkOrient" *ngIf="showFieldMarkProperties">
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphMarkOrient"
                                    name="graphMarkOrient"
                                    title="Orientation, useful when both are Quantitative fields"
                                    >
                                    <option>Horizontal</option>
                                    <option>Verticle</option>
                                </select>
                            </div>
                        </div>

                        <!-- Mark Properties Point -->
                        <div class="editorLineContainer">
                            <div class="editorGraphMarkPointTitle" *ngIf="showFieldMarkProperties">
                                Point:
                            </div>
                            <div class="editorGraphMarkPoint" *ngIf="showFieldMarkProperties">
                                <input [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphMarkPoint"
                                    type="checkbox"
                                    name="graphMarkPoint"
                                    title="Add Points to graph (T/F)"
                                    >
                            </div>
                            <div class="select editorGraphMarkPointColour" *ngIf="showFieldMarkProperties"
                                title="Color of the point on the line or area Graph"
                                >
                                <select [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphMarkPointColorName"
                                    name="graphMarkPointColorName"
                                    (change)="clickSelectMarkPointColour($event)"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Mark Properties Bin Spacing -->
                        <div class="editorLineContainer">
                            <div class="editorGraphMarkBinSpacingTitle" *ngIf="showFieldMarkProperties">
                                Space:
                            </div>
                            <div class="editorGraphMarkBinSpacing" *ngIf="showFieldMarkProperties">
                                <input type="number"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphMarkBinSpacing"
                                    name="graphMarkBinSpacing"
                                    placeholder="Space between bars"
                                    title="Spacing between bars"
                                    >
                            </div>
                        </div>

                        <!-- Mark Properties Size -->
                        <div class="editorLineContainer">
                            <div class="editorGraphMarkSizeTitle" *ngIf="showFieldMarkProperties">
                                Size:
                            </div>
                            <div class="editorGraphMarkSize" *ngIf="showFieldMarkProperties">
                                <input type="number"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphMarkSize"
                                    name="graphMarkSize"
                                    placeholder="Size"
                                    title="Relative Size of mark"
                                    >
                            </div>
                        </div>



                        <!-- Size: Channel Title Bar -->
                        <div class="editorSizeContainerTitle"
                            title="Click to amend properties of the Size field"
                            (click)="clickShowSizeProperties()"
                            >
                            <b>
                                Size
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldSizeProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldSizeProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="circle" *ngIf="sizeField!='Drag a field here ...'"
                                class="is-solid"
                                size="12"
                                style="float: right;"
                                >
                            </clr-icon>
                        </div>

                        <!-- Size: Field -->
                        <div class="editorLineContainer">
                            <div class="editorSizeFieldTitle" *ngIf="showFieldSizeProperties">
                                Field:
                            </div>
                            <div class="editorSizeField" *ngIf="showFieldSizeProperties"
                                id="target"
                                (drop)="dropSize($event);"
                                (dragenter)="dragenterSize($event);"
                                (dragleave)="dragleaveSize($event);"
                                (dragover)="dragoverSize($event);"
                                [style.background-color]="isDragoverSizes? 'lightgray' : 'transparent'"
                                [style.font-style]="sizeField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="The Size field show the size of elements in the Graph"
                                >

                                <clr-icon shape="times" *ngIf="showSizeDeleteIcon"
                                    (click)="clickClearSizeField()"
                                    >
                                </clr-icon>
                                {{ sizeField }}
                            </div>
                        </div>

                        <!-- Size: type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphSizeTypeTitle" *ngIf="showFieldSizeProperties">
                                Type:
                            </div>
                            <div class="select editorGraphSizeType" *ngIf="showFieldSizeProperties"
                                title="Type of the Size field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphSizeTypeName"
                                    name="graphSizeTypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>

                        <!-- Size: aggregate -->
                        <div class="editorLineContainer">
                            <div class="editorGraphSizeAggregateTitle" *ngIf="showFieldSizeProperties">
                                Aggregate:
                            </div>
                            <div class="select editorGraphSizeAggregate" *ngIf="showFieldSizeProperties"
                                title="How the Size values must be aggregated, ie Count"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphSizeAggregateName"
                                    name="graphSizeAggregateName"
                                    >
                                    <option *ngFor="let row of aggregations; let i = index">
                                        {{ row.displayName }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Size: bin -->
                        <div class="editorLineContainer">
                            <div class="editorGraphSizeBinTitle" *ngIf="showFieldSizeProperties">
                                Bin:
                            </div>
                            <div class="editorGraphSizeBin" *ngIf="showFieldSizeProperties">
                                <input [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphSizeBin"
                                    type="checkbox"
                                    name="graphSizeBin"
                                    (click)="clickSizeBin()"
                                    title="Bin the Size field (T/F)"
                                    >
                            </div>
                            <div class="editorGraphSizeBinMaxTitle" *ngIf="showFieldSizeProperties">
                                Est. bins:
                            </div>
                            <div class="editorGraphSizeBinMax" *ngIf="showFieldSizeProperties">
                                <input type="number"
                                    placeholder="Est. nr of bins"
                                    size="5"
                                    style="width: 25px;"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphSizeMaxBins"
                                    name="graphSizeMaxBins"
                                    title="Estimated number of bins"
                                    >
                            </div>
                        </div>


                        <!-- Legend-Axis: Title Bar -->
                        <!-- <div class="editorLegendContainerTitle" *ngIf="showFieldColorPropertiesTitle"
                            (click)="clickShowLegendProperties()"
                            >
                            <b>
                                Legend
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldLegend"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldLegend"
                                size="12"
                                >
                            </clr-icon>
                        </div> -->


                        <!-- Row: Channel Title Bar -->
                        <div class="editorRowContainerTitle"
                            title="Click to amend properties of the Row field (to create multiple graphs)"
                            (click)="clickShowRowProperties()"
                            >
                            <b>
                                Row
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldRowProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldRowProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="circle" *ngIf="rowField!='Drag a field here ...'"
                                class="is-solid"
                                size="12"
                                style="float: right;"
                                >
                            </clr-icon>
                        </div>

                        <!-- Row: Field -->
                        <div class="editorLineContainer">
                            <div class="editorRowFieldTitle" *ngIf="showFieldRowProperties">
                                Field:
                            </div>
                            <div class="editorRowField" *ngIf="showFieldRowProperties"
                                id="target"
                                (drop)="dropRow($event);"
                                (dragenter)="dragenterRow($event);"
                                (dragleave)="dragleaveRow($event);"
                                (dragover)="dragoverRow($event);"
                                [style.background-color]="isDragoverRow? 'lightgray' : 'transparent'"
                                [style.font-style]="rowField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="Field used for rows (create multiple Graphs)"
                                >

                                <clr-icon shape="times" *ngIf="showRowDeleteIcon"
                                    title="Click to remove this field from the Graph"
                                    (click)="clickClearRowField()"
                                    >
                                </clr-icon>
                                {{ rowField }}
                            </div>
                        </div>

                        <!-- Row: type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphRowTypeTitle" *ngIf="showFieldRowProperties">
                                Type:
                            </div>
                            <div class="select editorGraphRowType" *ngIf="showFieldRowProperties"
                                title="Type of the Row field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphRowTypeName"
                                    name="graphRowTypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>

                        <!-- Row Title -->
                        <div class="editorLineContainer">
                            <div class="editorGraphRowTitleTitle" *ngIf="showFieldRowProperties">
                                Title:
                            </div>
                            <div class="editorGraphRowTitleCheckbox" *ngIf="showFieldRowProperties">
                                <input [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphRowTitleCheckbox"
                                    type="checkbox"
                                    name="graphRowTitleCheckbox"
                                    title="Show the Axis Title (T/F)"
                                    >
                            </div>
                            <div class="editorGraphRowTitle" *ngIf="showFieldRowProperties"
                                >
                                <input type="text"
                                    placeholder="Blank = field name"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphRowTitle"
                                    name="graphRowTitle"
                                    >
                            </div>
                        </div>


                        <!-- Column: Channel Title Bar -->
                        <div class="editorColumnContainerTitle"
                            title="Click to amend properties of the Column field (to create multiple graphs)"
                            (click)="clickShowColumnProperties()"
                            >
                            <b>
                                Column
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldColumnProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldColumnProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="circle" *ngIf="columnField!='Drag a field here ...'"
                                class="is-solid"
                                size="12"
                                style="float: right;"
                                >
                            </clr-icon>
                        </div>

                        <!-- Column: Field -->
                        <div class="editorLineContainer">
                            <div class="editorColumnFieldTitle" *ngIf="showFieldColumnProperties">
                                Field:
                            </div>
                            <div class="editorColumnField" *ngIf="showFieldColumnProperties"
                                id="target"
                                (drop)="dropColumn($event);"
                                (dragenter)="dragenterColumn($event);"
                                (dragleave)="dragleaveColumn($event);"
                                (dragover)="dragoverColumn($event);"
                                [style.background-color]="isDragoverColumn? 'lightgray' : 'transparent'"
                                [style.font-style]="columnField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="Produce multiple Graphs based on this field"
                                >

                                <clr-icon shape="times" *ngIf="showColumnDeleteIcon"
                                    title="Click to remove the Column field from the Graph"
                                    (click)="clickClearColumnField()"
                                    >
                                </clr-icon>
                                {{ columnField }}
                            </div>
                        </div>

                        <!-- Column: type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColumnTypeTitle" *ngIf="showFieldColumnProperties">
                                Type:
                            </div>
                            <div class="select editorGraphColumnType" *ngIf="showFieldColumnProperties"
                                title="Type of the Column field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphColumnTypeName"
                                    name="graphColumnTypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>

                        <!-- Column Title -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColumnTitleTitle" *ngIf="showFieldColumnProperties">
                                Title:
                            </div>
                            <div class="editorGraphColumnTitleCheckbox" *ngIf="showFieldColumnProperties">
                                <input [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphColumnTitleCheckbox"
                                    type="checkbox"
                                    name="graphColumnTitleCheckbox"
                                    title="Show the Axis Title (T/F)"
                                    >
                            </div>
                            <div class="editorGraphColumnTitle" *ngIf="showFieldColumnProperties"
                                >
                                <input type="text"
                                    placeholder="Blank = field name"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphColumnTitle"
                                    name="graphColumnTitle"
                                    >
                            </div>
                        </div>


                        <!-- Detail: Channel Title Bar -->
                        <div class="editorDetailContainerTitle"
                            title="Click to amend properties of the Detail field (to create groupBy)"
                            (click)="clickShowDetailProperties()"
                            >
                            <b>
                                Detail
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldDetailProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldDetailProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="circle" *ngIf="detailField!='Drag a field here ...'"
                                class="is-solid"
                                size="12"
                                style="float: right;"
                                >
                            </clr-icon>
                        </div>

                        <!-- Detail: Field -->
                        <div class="editorLineContainer">
                            <div class="editorDetailFieldTitle" *ngIf="showFieldDetailProperties">
                                Field:
                            </div>
                            <div class="editorDetailField" *ngIf="showFieldDetailProperties"
                                id="target"
                                (drop)="dropDetail($event);"
                                (dragenter)="dragenterDetail($event);"
                                (dragleave)="dragleaveDetail($event);"
                                (dragover)="dragoverDetail($event);"
                                [style.background-color]="isDragoverDetail? 'lightgray' : 'transparent'"
                                [style.font-style]="detailField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="Detail field, used to group by values (no legend is shown)"
                                >

                                <clr-icon shape="times" *ngIf="showDetailDeleteIcon"
                                    title="Click to remove the Detail field from the Graph"
                                    (click)="clickClearDetailField()"
                                    >
                                </clr-icon>
                                {{ detailField }}
                            </div>
                        </div>

                        <!-- Detail: type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphDetailTypeTitle" *ngIf="showFieldDetailProperties">
                                Type:
                            </div>
                            <div class="select editorGraphDetailType" *ngIf="showFieldDetailProperties"
                                title="Type of the Detail field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphDetailTypeName"
                                    name="graphDetailTypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>


                        <!-- X2: Channel Title Bar -->
                        <div class="editorX2ContainerTitle"
                            title="Click to amend properties of the X2 field"
                            (click)="clickShowX2Properties()"
                            >
                            <b>
                                X2
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldX2Properties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldX2Properties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="circle" *ngIf="x2Field!='Drag a field here ...'"
                                class="is-solid"
                                size="12"
                                style="float: right;"
                                >
                            </clr-icon>
                        </div>

                        <!-- X2: Field -->
                        <div class="editorLineContainer">
                            <div class="editorX2FieldTitle" *ngIf="showFieldX2Properties">
                                Field:
                            </div>
                            <div class="editorX2Field" *ngIf="showFieldX2Properties"
                                id="target"
                                (drop)="dropX2($event);"
                                (dragenter)="dragenterX2($event);"
                                (dragleave)="dragleaveX2($event);"
                                (dragover)="dragoverX2($event);"
                                [style.background-color]="isDragoverX2? 'lightgray' : 'transparent'"
                                [style.font-style]="x2Field=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="Field to place on the second X axis"
                                >

                                <clr-icon shape="times" *ngIf="showX2DeleteIcon"
                                    title="Click to remove the X2 field from the Graph"
                                    (click)="clickClearX2Field()"
                                    >
                                </clr-icon>
                                {{ x2Field }}
                            </div>
                        </div>

                        <!-- X2 Properties Aggregate -->
                        <div class="editorLineContainer">
                            <div class="editorGraphX2aggregateTitle" *ngIf="showFieldX2Properties">
                                Aggregate:
                            </div>
                            <div class="select editorGraphX2aggregate" *ngIf="showFieldX2Properties"
                                title="How the X2 values must be aggregated, ie Count"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphX2AggregateName"
                                    name="graphXaggregateName"
                                    >
                                    <option *ngFor="let row of aggregations; let i = index">
                                        {{ row.displayName }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- X2: type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphX2TypeTitle" *ngIf="showFieldX2Properties">
                                Type:
                            </div>
                            <div class="select editorGraphX2Type" *ngIf="showFieldX2Properties"
                                title="Type of the X2 field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphX2TypeName"
                                    name="graphX2TypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>


                        <!-- Y2: Channel Title Bar -->
                        <div class="editorY2ContainerTitle"
                            title="Click to amend properties of the Y2 field"
                            (click)="clickShowY2Properties()"
                            >
                            <b>
                                Y2
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldY2Properties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldY2Properties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="circle" *ngIf="y2Field!='Drag a field here ...'"
                                class="is-solid"
                                size="12"
                                style="float: right;"
                                >
                            </clr-icon>
                        </div>

                        <!-- Y2: Field -->
                        <div class="editorLineContainer">
                            <div class="editorY2FieldTitle" *ngIf="showFieldY2Properties">
                                Field:
                            </div>
                            <div class="editorY2Field" *ngIf="showFieldY2Properties"
                                id="target"
                                (drop)="dropY2($event);"
                                (dragenter)="dragenterY2($event);"
                                (dragleave)="dragleaveY2($event);"
                                (dragover)="dragoverY2($event);"
                                [style.background-color]="isDragoverY2? 'lightgray' : 'transparent'"
                                [style.font-style]="y2Field=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="Field to place on the second Y axis"
                                >

                                <clr-icon shape="times" *ngIf="showY2DeleteIcon"
                                    title="Click remove the Y2 field"
                                    (click)="clickClearY2Field()"
                                    >
                                </clr-icon>
                                {{ y2Field }}
                            </div>
                        </div>

                        <!-- Y2 Properties Aggregate -->
                        <div class="editorLineContainer">
                            <div class="editorGraphY2aggregateTitle" *ngIf="showFieldY2Properties">
                                Aggregate:
                            </div>
                            <div class="select editorGraphY2aggregate" *ngIf="showFieldY2Properties"
                                title="How the Y2 values must be aggregated, ie Count"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphY2AggregateName"
                                    name="graphXaggregateName"
                                    >
                                    <option *ngFor="let row of aggregations; let i = index">
                                        {{ row.displayName }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Y2: type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphY2TypeTitle" *ngIf="showFieldY2Properties">
                                Type:
                            </div>
                            <div class="select editorGraphY2Type" *ngIf="showFieldY2Properties"
                                title="Type of the Y2 field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphY2TypeName"
                                    name="graphY2TypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>



                        <!-- Projection: Channel Title Bar -->
                        <div class="editorProjectionContainerTitle"
                            title="Click to amend properties of the Projection field"
                            (click)="clickShowProjectionProperties()"
                            >
                            <b>
                                Projection
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldProjectionProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldProjectionProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="circle" *ngIf="projectionFieldLatitude!='Drag a field here ...'
                                ||  projectionFieldLongitude!='Drag a field here ...'"
                                class="is-solid"
                                size="12"
                                style="float: right;"
                                >
                            </clr-icon>
                        </div>

                        <!-- Projection: type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphProjectionTypeTitle" *ngIf="showFieldProjectionProperties">
                                Projection:
                            </div>
                            <div class="select editorGraphProjectionType" *ngIf="showFieldProjectionProperties"
                                title="Type of the type of geo Projection for the Graph"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphLayers[currentGraphLayer - 1].graphProjectionType"
                                    name="graphProjectionType"
                                    >
                                    <option></option>
                                    <option>albers</option>
                                    <option>albersUsa</option>
                                    <option>azimuthalEqualArea</option>
                                    <option>azimuthalEquidistanct</option>
                                    <option>conicConformal</option>
                                    <option>conicEqualArea</option>
                                    <option>conicEquidistant</option>
                                    <option>equirectangular</option>
                                    <option>gnomonic</option>
                                    <option>mercator</option>
                                    <option>orthographic</option>
                                    <option>stereographic</option>
                                    <option>transverseMercator</option>
                                </select>
                            </div>
                        </div>

                        <!-- Projection: Latitude Field -->
                        <div class="editorLineContainer">
                            <div class="editorGraphLatitudeTitle" *ngIf="showFieldProjectionProperties">
                                Latitude:
                            </div>
                            <div class="editorGraphLatitude" *ngIf="showFieldProjectionProperties"
                                id="target"
                                (drop)="dropProjectionLatitude($event);"
                                (dragenter)="dragenterProjectionLatitude($event);"
                                (dragleave)="dragleaveProjectionLatitude($event);"
                                (dragover)="dragoverProjectionLatitude($event);"
                                [style.background-color]="isDragoverProjectionLatitude? 'lightgray' : 'transparent'"
                                [style.font-style]="projectionFieldLatitude=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="The Latitude of points in the Graph"
                                >

                                <clr-icon shape="times" *ngIf="showProjectionLatitudeDeleteIcon"
                                    (click)="clickClearProjectionFieldLatitude()"
                                    >
                                </clr-icon>
                                {{ projectionFieldLatitude }}
                            </div>
                        </div>

                        <!-- Projection: Longitude Field -->
                        <div class="editorLineContainer">
                            <div class="editorGraphLongitudeTitle" *ngIf="showFieldProjectionProperties">
                                Longitude:
                            </div>
                            <div class="editorGraphLongitude" *ngIf="showFieldProjectionProperties"
                                id="target"
                                (drop)="dropProjectionLongitude($event);"
                                (dragenter)="dragenterProjectionLongitude($event);"
                                (dragleave)="dragleaveProjectionLongitude($event);"
                                (dragover)="dragoverProjectionLongitude($event);"
                                [style.background-color]="isDragoverProjectionLongitude? 'lightgray' : 'transparent'"
                                [style.font-style]="projectionFieldLongitude=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="The Longitude of points in the Graph"
                                >

                                <clr-icon shape="times" *ngIf="showProjectionLongitudeDeleteIcon"
                                    (click)="clickClearProjectionFieldLongitude()"
                                    >
                                </clr-icon>
                                {{ projectionFieldLongitude }}
                            </div>
                        </div>

                    </div>



                    <!-- GRAPH TYPES -->
                    <div class="editorTypesTitle">
                        <b>
                            Types
                        </b>
                        <clr-signpost>
                            <clr-icon shape="info-circle" style="margin-top: -4px;"
                                clrSignpostTrigger>
                            </clr-icon>
                            <clr-signpost-content *clrIfOpen
                                [clrPosition]="'bottom-middle'">
                                <h5 style="margin-top: 0; color:gray;">
                                    Help
                                </h5>
                                <p style="margin-top: 0; color:gray; text-align: left;">
                                    Once the fields have been selected (for example the X and
                                    Y fields), click the graph icon below to draw the graph on
                                    the far right hand side.
                                </p>
                                <p>
                                    <b>Note:</b> the graph is only refreshed when a graph icon
                                    is clicked.  Also, when it is refreshed, it is added to the
                                    temporary history shown above the graph.
                                </p>
                            </clr-signpost-content>
                        </clr-signpost>
                    </div>
                    <div class="editorTypes">
                        <div class="editorTypeImages" *ngFor="let row of widgetGraphs"
                            [style.border]="currentGraphID==row.id?  '2px solid red'  :  '1px solid gray'"
                            >
                            <span
                                (click)="showGraph(row.id)"
                                >
                                <i>
                                    <!-- {{ row.shortName }}: -->
                                </i>
                            </span>
                            <img
                                [style.width.px]="85"
                                [style.height.px]="65"
                                [src]="row.imageUrl"
                                [title]="row.shortName"
                                (click)="showGraph(row.id)"
                            >
                        </div>
                    </div>



                    <!-- GRAPH Area -->
                    <div class="editorAreaTitle">
                        <clr-icon class="editorLeftIcon" *ngIf="showGraphAreaTitle  &&  !showSpecification"
                            (click)="clickBrowsePreviousGraph()"
                            shape="angle left"
                            size="16"
                            >
                        </clr-icon>

                        <b *ngIf="!showGraphAreaTitle  &&  !showSpecification">
                            Graph
                            <span *ngIf="localWidget.graphLayers[currentGraphLayer - 1].graphLayers">
                                {{ localWidget.graphLayers[currentGraphLayer - 1].graphLayers[currentGraphLayer - 1].graphMark }}

                            </span>
                        </b>

                        <b *ngIf="showGraphAreaTitle  &&  !showSpecification">
                            {{ graphHeader }}
                        </b>

                        <clr-icon class="editorRightIcon"  *ngIf="showGraphAreaTitle  &&  !showSpecification"
                             (click)="clickBrowseNextGraph()"
                            shape="angle right"
                            size="16"
                            >
                        </clr-icon>
                        <clr-signpost>
                            <clr-icon shape="info-circle" style="margin-top: -4px;"
                                clrSignpostTrigger>
                            </clr-icon>
                            <clr-signpost-content *clrIfOpen
                                [clrPosition]="'bottom-left'">
                                <h5 style="margin-top: 0; color:gray;">
                                    Help
                                </h5>
                                <p style="margin-top: 0; color:gray; text-align: left;">
                                    First select the fields (for example the X and Y fields), and
                                    then click the graph icon (under Types) to draw the graph
                                    below.  Each time you refresh, the complete graph is stored
                                    in the temporary history.  Use the left and right arrows to
                                    navigate the history.
                                </p>
                            </clr-signpost-content>
                        </clr-signpost>

                    </div>
                    <div class="editorArea" [hidden]="showSpecification"
                        #dragWidget
                        [style.border]="!showGraphAreaTitle?  '1px solid gray'  : 'none'"
                        >
                    </div>



                    <!-- SPECIFICATION AREA -->
                    <div class="editorSpecification" [hidden]="!showSpecification">
                        {{ specificationJSON }}
                    </div>



                    <!-- FILTER -->
                    <div class="editorFilterButton" *ngIf="!showWidgetEditorLite">
                        <button
                            style="border: 1px solid transparent; color: gray;"
                            class="btn btn-sm btn-secondary"
                            (click)="clickShowFilterArea()"
                            >
                            <clr-icon (click)="clickShowFilterArea()"
                                shape="angle up"
                                size="12"
                                >
                            </clr-icon>
                            Filter

                            <span *ngIf="filterNrActive > 0"
                                class="badge badge-5">{{ filterNrActive }}
                            </span>

                        </button>
                    </div>

                    <div class="editorFilterArea" *ngIf="showFilterAreaProperties">
                        <div class="editorFilterHeader">
                            <b>Filters</b>
                        </div>
                        <div style="padding: 8px;">
                            <i>
                                Filters are applied to the data before calculations, and before the
                                graph is constructed.  Select the field to filter on, then the operator
                                and type a Value(s).  Note: the values are case-sensitive, ie, Origin
                                Equal "Europe".  Click <b>Add</b> to append the filter.  Filters can be
                                de-activated (definition remains here, but the data is not filtered
                                with it).  Click a filter to edit it.  Double click the Delete icon
                                to delete a filter.
                            </i>
                        </div>

                        <div>
                            <div class="editorFilterFieldTitle">
                                Field:
                            </div>
                            <div class="select editorFilterField"
                                title="Select the field to filter on"
                                >
                                <select id="selects_3" *ngIf="dataSchema"
                                    [(ngModel)]="filterFieldName"
                                    (change)="filterFieldSelected($event)"
                                    name="filterFieldName"
                                    >
                                    <option *ngFor="let row of dataSchema; let i = index">
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>

                            <div class="editorFilterTimeUnitTitle">
                                TimeUnit:
                            </div>
                            <div class="select editorFilterTimeUnit"
                                title="Select the operator for the filter"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="filterTimeUnit"
                                    (change)="filterTimeUnitSelected($event)"
                                    name="filterTimeUnit"
                                    >
                                    <option>Year</option>
                                    <option>Month</option>
                                    <option>Day</option>
                                </select>
                            </div>

                            <div class="editorFilterOperatorTitle">
                                Operator:
                            </div>
                            <div class="select editorFilterOperator"
                                title="Select the operator for the filter"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="filterOperator"
                                    (change)="filterOperatorSelected($event)"
                                    name="filterOperator"
                                    >
                                    <option>Less Than</option>
                                    <option>Less Than Equal</option>
                                    <option>Equal</option>
                                    <option>Not Equal</option>
                                    <option>Greater Than</option>
                                    <option>Greater Than Equal</option>
                                    <option>Range</option>
                                    <option>One Of</option>
                                    <option>Valid</option>
                                    <option>Selection</option>
                                </select>
                            </div>
                        </div>

                        <div class="editorFilterValueTitle" *ngIf="filterOperator!='Range'">
                            Value:
                        </div>

                        <div class="editorFilterValue" *ngIf="filterOperator!='Range'">
                            <input type="text"
                                [(ngModel)]="filterValue"
                                name="filterValue"
                                placeholder="12 Japan  1,5  a,b,c  true feb"
                                title="Enter a value for the filter.  Ranges use x,y for from,to"
                                >
                        </div>

                        <div *ngIf="filterOperator=='Range'">
                            <div class="editorFilterValueFromTitle">
                                From:
                            </div>
                            <div class="editorFilterValueFrom">
                                <input type="text"
                                    [(ngModel)]="filterValueFrom"
                                    name="filterValueFrom"
                                    placeholder="12 Japan  1,5  a,b,c  true"
                                    title="Enter a From value for the filter for the Range"
                                    >
                            </div>
                            <div class="editorFilterValueToTitle">
                                To:
                            </div>
                            <div class="editorFilterValueTo">
                                <input type="text"
                                    [(ngModel)]="filterValueTo"
                                    name="filterValueTo"
                                    placeholder="12 Japan  1,5  a,b,c  true"
                                    title="Enter a To value for the filter for the Range"
                                    >
                            </div>
                        </div>

                        <div>
                            <div class="btn-group btn-link">
                                <button class="btn" (click)="clickFilterClear()">
                                    Clear
                                </button>
                                <button class="btn" (click)="clickFilterAdd()">
                                    <span *ngIf="filterID==-1">
                                        Add
                                    </span>
                                    <span *ngIf="filterID!=-1">
                                        Save
                                    </span>
                                </button>
                            </div>

                            <button class="btn btn-secondary editorFilterCloseButton"
                                (click)="clickFilterClose()">
                                Close
                            </button>
                            <span class="editorFilterErrorMessage">
                                {{ filterErrorMessage }}
                            </span>
                        </div>

                        <div class="editorFilterGrid">
                            <clr-datagrid class="datagrid-compact"
                                style="height: 160px !important;"
                                >
                                <clr-dg-column>FieldName</clr-dg-column>
                                <clr-dg-column>TimeUnit</clr-dg-column>
                                <clr-dg-column>Operator</clr-dg-column>
                                <clr-dg-column>Value</clr-dg-column>
                                <clr-dg-column>From</clr-dg-column>
                                <clr-dg-column>To</clr-dg-column>
                                <clr-dg-column>Active?</clr-dg-column>
                                <clr-dg-column>Delete?</clr-dg-column>

                                <clr-dg-row *clrDgItems="let row of localWidget.graphFilters; let i = index"
                                    [style.background-color]="(i == selectedGraphFilterRowIndex)? '#123456' : 'white'"
                                    [style.color]="(i == selectedGraphFilterRowIndex)? 'white' : 'gray'"
                                    (click)="clickGraphFilterRowSelect(i, row.id)"
                                    >
                                    <clr-dg-cell>{{ row.filterFieldName }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.filterTimeUnit }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.filterOperator }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.filterValue }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.filterValueFrom }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.filterValueTo }}</clr-dg-cell>
                                    <clr-dg-cell style="text-align: center !important;">
                                        <span>
                                            <clr-icon *ngIf="row.isActive"
                                                shape="check"
                                                size="12"
                                                (dblclick)="dblClickFilterMakeInActive()"
                                                >
                                            </clr-icon>
                                            <clr-icon *ngIf="!row.isActive"
                                                shape="times"
                                                size="12"
                                                (dblclick)="dblClickFilterMakeActive(row.id)"
                                                >
                                            </clr-icon>
                                        </span>
                                    </clr-dg-cell>
                                    <clr-dg-cell style="text-align: center !important;">
                                        <span>
                                            <clr-icon
                                                shape="trash"
                                                size="12"
                                                (dblclick)="dblClickFilterDelete(row.id)"
                                                >
                                            </clr-icon>
                                        </span>
                                    </clr-dg-cell>
                                </clr-dg-row>

                            </clr-datagrid>
                        </div>

                    </div>

                    <!-- CONDITION -->
                    <div class="editorConditionButton" *ngIf="!showWidgetEditorLite">
                        <button
                            style="border: 1px solid transparent; color: gray;"
                            class="btn btn-sm btn-secondary"
                            (click)="clickShowConditionArea()"
                            >
                            <clr-icon (click)="clickShowConditionArea()"
                                shape="angle up"
                                size="12"
                                >
                            </clr-icon>
                            Condition

                            <span *ngIf="localWidget.graphLayers[this.currentGraphLayer - 1].conditionFieldName"
                                class="badge badge-5">{{ 1 }}
                            </span>

                        </button>
                    </div>

                    <div class="editorConditionArea" *ngIf="showConditionAreaProperties">
                        <div class="editorConditionHeader">
                            <b>Conditions</b>
                        </div>
                        <div style="padding: 8px;">
                            <i>
                                Conditions are used to colour one or more values a specific colour.
                                For example, lets say we have a bar graph with Country on the X axis
                                and the Mark colour is gray (showing all bars in gray).  Then a 
                                condition can be added to specify that Denmark must shown in red.
                            </i>
                        </div>

                        <div>

                            <div class="editorConditionColourTitle">
                                Color:
                            </div>
                            <div class="select editorConditionColour"
                                title="Color of the element that satisfies the Condition"
                                >
                                <select [(ngModel)]="conditionColourName"
                                    name="conditionColourName"
                                    (change)="clickSelectConditionColour($event)"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <div class="editorConditionFieldTitle">
                                Field:
                            </div>
                            <div class="select editorConditionField"
                                title="Select the field for conditional colour"
                                >
                                <select id="selects_3" *ngIf="dataSchema"
                                    [(ngModel)]="conditionFieldName"
                                    (change)="changeConditionFieldSelected($event)"
                                    name="conditionFieldName"
                                    >
                                    <option *ngFor="let row of dataSchema; let i = index">
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <div class="editorConditionOperatorTitle">
                                Operator:
                            </div>
                            <div class="select editorConditionOperator"
                                title="Select the operator for the test"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="conditionOperator"
                                    (change)="changeConditionOperatorSelected($event)"
                                    name="conditionOperator"
                                    >
                                    <option>Less Than</option>
                                    <option>Less Than Equal</option>
                                    <option>Equal</option>
                                    <option>Greater Than</option>
                                    <option>Greater Than Equal</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <div class="editorConditionValueTitle" *ngIf="conditionOperator!='Range'">
                                Value:
                            </div>
                            <div class="editorConditionValue" *ngIf="conditionOperator!='Range'">
                                <input type="text"
                                    [(ngModel)]="conditionValue"
                                    name="conditionValue"
                                    placeholder="12 Japan  1,5  a,b,c  true feb"
                                    title="Enter a value for the condition.  Ranges use x,y for from,to"
                                    >
                            </div>
                        </div>

                        <div>
                            <div class="btn-group btn-link">
                                <button class="btn" (click)="clickConditionDelete()">
                                    Delete
                                </button>
                                <button class="btn" (click)="clickConditionSave()">
                                    <span *ngIf="conditionFieldName==''">
                                        Add
                                    </span>
                                    <span *ngIf="conditionFieldName!=''">
                                        Save
                                    </span>
                                </button>
                            </div>

                            <button class="btn btn-secondary editorConditionCloseButton"
                                (click)="clickConditionClose()">
                                Close
                            </button>
                            <span class="editorConditionErrorMessage">
                                {{ conditionErrorMessage }}
                            </span>
                        </div>
                    </div>


                    <!-- SPEC -->
                    <div class="editorShowGraphOrSpecification" *ngIf="!showWidgetEditorLite">
                        <button
                            style="border: 1px solid transparent; color: gray;"
                            class="btn btn-sm btn-secondary"
                            (click)="clickShowSpecificationArea()"
                            >
                            <span *ngIf="!showSpecification">
                                Show Spec
                            </span>
                            <span *ngIf="showSpecification">
                                Show Graph
                            </span>
                        </button>
                    </div>

                    <div class="errorMessageEditor">
                        {{ errorMessageEditor }}
                    </div>


                    <!-- GRAPH DIMENSIONS -->
                    <div class="editorGraphTop" *ngIf="!showWidgetEditorLite">
                        Pan/Zoom:
                        <input type="checkbox"
                            placeholder=""
                            [(ngModel)]="localWidget.graphPanAndZoom"
                            name="graphPanAndZoom"
                            title="Add Pan/Zoom to single layered Graphs"
                            >
                    </div>
                    <div class="editorGraphWidth" *ngIf="!showWidgetEditorLite">
                        Width:
                        <input type="number"
                            placeholder=""
                            [(ngModel)]="localWidget.graphWidth"
                            min="0"
                            max="1000"
                            name="graphWidth"
                            title="Width of Graph in px"
                            >
                    </div>
                    <div class="editorGraphHeight" *ngIf="!showWidgetEditorLite">
                        Height:
                        <input type="number"
                            placeholder=""
                            [(ngModel)]="localWidget.graphHeight"
                            min="0"
                            max="1000"
                            name="graphHeight"
                            title="Height of Graph in px"
                            >
                    </div>


                    <!-- BUTTONS -->
                    <div class="editorButtonShowData">
                        <button
                            class="btn btn-sm btn-secondary"
                            (click)="clickShowDatasources()"
                            >
                            Show Data
                            <clr-icon (click)="clickShowDatasources()"
                                shape="angle left"
                                size="18"
                                >
                            </clr-icon>
                        </button>
                    </div>
                    <div class="editorButtonCancel">
                        <button *ngIf="showPreview"
                            class="btn btn-sm btn-secondary"
                            (click)="clickClose()"
                            >
                            Cancel
                        </button>
                    </div>
                    <div class="editorButtonSave">
                        <button *ngIf="showPreview"
                            class="btn btn-sm btn-primary"
                            (click)="clickSave()"
                            >
                            Save
                        </button>
                    </div>

                </div>

            </div>

        </div>
    </div>
</div>

