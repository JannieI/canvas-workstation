<div class="modal modalBox">
	<div class="modal-dialog modal-xl" role="dialog" aria-hidden="true">
		<div class="modal-content modalContent">


            <div class="gridOverall">
                <button type="button" class="closeButton" (click)="clickClose()">
                    <b>X</b>
                </button>

                <div class="gridTitle">
                    <b>Widget Editor</b>
                    <clr-signpost>
                        <clr-icon shape="info-circle"
                            clrSignpostTrigger>
                        </clr-icon>
                        <clr-signpost-content *clrIfOpen
                            [clrPosition]="'bottom-middle'">
                            <h5 style="margin-top: 0; color:gray;">
                                Help
                            </h5>
                            <p style="margin-top: 0; color:gray;">
                                <b>For new Widgets:</b> select a datasource, and click Continue 
                                to the Widget Editor.
                                <b>Widget Editor:</b> drag a Field onto the X and Y coloured blocks.
                                Select a graph type.  Properties can be changed by clicking the dropdown
                                icons.  Click Save to show the Widget on the Dashboard, or click Cancel
                                to return to the Dashboard.
                                Click the X or press Escape to close this form.
                            </p>
                        </clr-signpost-content>
                    </clr-signpost>
                </div>

                <!-- SHOWS the DS info to select one -->
                <div class="datasourceMain" *ngIf="showDatasourceMain">

                    <div class="datasourceMainHelp">
                        Select a <b>Datasources</b> on which a Widget must be created.  Details
                        about the datasource is shown on the right:
                    </div>  

                    <div class="datasourceMainDescriptionTitle">
                        <b>Description:</b>
                    </div>                        
                    <div class="datasourceMainDescription">
                        {{ selectedDescription }}
                    </div>

                    <div class="datasourceMainError">
                        {{ errorMessage }}
                    </div>

                    <div class="datasourceMainListTitle">
                        <b>Datasources:</b>
                    </div>
                    <div class="datasourceMainList">
                        <nav
                            >
                            <div>
                                <clr-datagrid class="datagrid-compact">
                                    <clr-dg-column clrDgField="name"  
                                        [(clrDgSortOrder)]="sortOrder"
                                        (click)="sortOrder=sortOrder * -1"
                                        >
                                        Name
                                    </clr-dg-column>
                                    
                                    <clr-dg-row *clrDgItems="let row of localDatasources; let i = index"
                                        [clrDgItem]="row"
                                        [style.background-color]="(i == selectedRowIndex)? '#123456' : 'white'"
                                        [style.color]="(i == selectedRowIndex)? 'white' : 'gray'"
                                        (click)="clickDSrow(i, row.id)"
                                        >
                                        <clr-dg-cell>
                                            {{ row.name }}
                                            <span *ngIf="row.nrWidgets > 0"
                                                class="badge badge-5">{{row.nrWidgets}}
                                            </span>
                                        </clr-dg-cell>
                                    </clr-dg-row>

                                </clr-datagrid>
                            </div>
                        </nav>
                    </div>

                    <div class="datasourceMainPreviewTitle">
                        <b>Preview:</b>
                    </div>
                    <div class="datasourceMainPreview">
                        <clr-datagrid class="datagrid-compact">

                            <clr-dg-placeholder>Select a datasource to preview here</clr-dg-placeholder>

                            <clr-dg-column *ngFor="let row of dataFieldNames; let i = index;">
                                {{row}}
                            </clr-dg-column>
                            <clr-dg-row *ngFor="let row of currentData">

                                <clr-dg-cell *ngFor="let col of dataFieldNames; 
                                    let i = index"
                                    >
                                    {{ row[col] }}
                                </clr-dg-cell>
                            </clr-dg-row>

                        </clr-datagrid>
                    </div>

                    <div class="datasourceMainButton">
                        <button *ngIf="showPreview"
                            class="btn btn-sm btn-secondary datasourceButton"
                            (click)="clickContinue()">
                            Continue
                        </button>
                    </div>
                </div>

                <!-- Widget Editor -->
                <div class="editorMain" *ngIf="!showDatasourceMain">

                     <!-- TODO - TRY this code !!! https://next.plnkr.co/edit/Hhms3CxLmzKHark5HVsd?p=preview&preview
                        <clr-dg-column *ngFor="let column of myColumns" [clrDgField]="column.name" [clrDgSorted]="column.name === 'first_name'">
                            <ng-container *ngIf="column.isMandatory; else hideableBlock">
                                {{column.displayName}}
                            </ng-container>
                            <ng-template #hideableBlock>
                                <ng-container *clrDgHideableColumn="{hidden: (column.name !== 'email') && !column.isscore}">
                                {{column.displayName}}
                                </ng-container>
                            </ng-template>
                            
                            <clr-dg-string-filter *ngIf="column.name === 'email'" id="emailFilter" [clrDgStringFilter]="emailFilter"  [clrFilterValue]="(column.email)"></clr-dg-string-filter>
                        </clr-dg-column> -->

                    <div class="editorFieldsTitle">
                        <b>Fields</b>
                    </div>
                    <div class="editorFields">
                        <nav
                            >
                            <clr-datagrid class="datagrid-compact">
                                <clr-dg-column clrDgField="name"  
                                    [(clrDgSortOrder)]="sortOrder"
                                    (click)="sortOrder=sortOrder * -1"
                                    >
                                    Name
                                </clr-dg-column>
                                
                                <clr-dg-row *clrDgItems="let row of dataSchema; let i = index"
                                    [clrDgItem]="row"
                                    >
                                    <clr-dg-cell style="margin-left: 2px; padding: 0;"
                                        id="fld"
                                        draggable="true"
                                        (dragstart)="dragstartField($event)"
                                        >
                                        <clr-icon *ngIf="row.type=='string'"
                                            shape="circle"
                                            size="14"
                                            [style.background-color]="'darkgray'"
                                            [style.color]="'darkgray'"
                                            >
                                        </clr-icon>
                                        <clr-icon *ngIf="row.type=='number'"
                                            shape="circle"
                                            size="14"
                                            [style.background-color]="'lightgreen'"
                                            [style.color]="'lightgreen'"
                                            >
                                        </clr-icon>
                                        <clr-icon *ngIf="row.type=='boolean'"
                                            shape="circle"
                                            size="14"
                                            [style.border]="'lightgray'"
                                            [style.background-color]="'white'"
                                            [style.color]="'white'"
                                            >
                                        </clr-icon>
                
                                        {{ row.name }}
                                        <!-- <span class="badge badge-light-gray">
                                            {{row.length}}
                                        </span> -->
                                    </clr-dg-cell>
                                </clr-dg-row>

                            </clr-datagrid>
                        </nav>
                    </div>
        
                    <div class="editorPropertiesTitle">
                        <b>
                            Properties
                        </b>
                    </div>
                    <div class="editorProperties">

                        <div class="editorColFieldTitle">
                            X axis:
                        </div>    
                        <div class="editorColField"
                            id="target"
                            (drop)="dropColumn($event);"
                            (dragover)="dragoverColumn($event);"
                            (dragenter)="dragenterColumn($event);"
                            (dragleave)="dragleaveColumn($event);"
                            [style.background-color]="dragoverCol? 'lightgray' : 'transparent'"
                            [style.font-style]="colField=='Drag a field here ...' ?  'italic'  :  'normal'"
                            >
                            <clr-icon shape="times" *ngIf="showColumnDeleteIcon"
                                (click)="clickClearColumnField()">
                            </clr-icon>
                            {{ colField }}
                        </div>

                        <div class="editorRowFieldTitle">
                            Y axis:
                        </div>    
                        <div class="editorRowField"
                            id="target"
                            (drop)="dropRow($event);"
                            (dragenter)="dragenterRow($event);"
                            (dragleave)="dragoleaveRow($event);"
                            (dragover)="dragoverRows($event);"
                            [style.background-color]="dragoverRow? 'lightgray' : 'transparent'"
                            [style.font-style]="rowField=='Drag a field here ...' ?  'italic'  :  'normal'"
                            >
                            <clr-icon shape="times" *ngIf="showRowDeleteIcon"
                                (click)="clickClearRowField()">
                            </clr-icon>
                            {{ rowField }}
                        </div>
        
                        <div class="editorColourFieldTitle">
                            Colour:
                        </div>    
                        <div class="editorColourField"
                            id="target"
                            (drop)="dropColour($event);"
                            (dragenter)="dragenterColour($event);"
                            (dragleave)="dragleaveColour($event);"
                            (dragover)="dragoverColour($event);"
                            [style.background-color]="dragoverColours? 'lightgray' : 'transparent'"
                            [style.font-style]="graphColorField=='Drag a field here ...' ?  'italic'  :  'normal'"
                            >
                            <clr-icon shape="times" *ngIf="showColourDeleteIcon"
                                (click)="clickClearColourField()"
                                >
                            </clr-icon>
                            {{ graphColorField }}
                        </div>


                        <div class="editorXPropertiesTitle"
                            (click)="clickShowXProperties()"
                            >
                            <b>
                                X Properties
                            </b>
                            <clr-icon shape="angle down" *ngIf="!ShowFieldXProperties"
                                (click)="clickShowXProperties()"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="ShowFieldXProperties"
                                size="12"
                                >
                            </clr-icon>
                        </div>
                        <div class="editorXPropertiesAggregateTitle" *ngIf="ShowFieldXProperties">
                            Aggregate:
                        </div>    
                        <div class="select editorXPropertiesAggregate" *ngIf="ShowFieldXProperties">
                            <select id="selects_3"
                                [(ngModel)]="xPropertiesAggregate"
                                >
                                <option>Average</option>
                                <option>ci0</option>
                                <option>ci1</option>
                                <option>Count</option>
                                <option>Distinct</option>
                                <option>Max</option>
                                <option>Mean</option>
                                <option>Median</option>
                                <option>Min</option>
                                <option>Missing</option>
                                <option>q1</option>
                                <option>q3</option>
                                <option>Std Deviation</option>
                                <option>Std Error</option>
                                <option>Sum</option>
                                <option>Variance</option>
                            </select>                        
                        </div>






                    </div>

                    <div class="editorTypesTitle">
                        <b>
                            Types
                        </b>
                    </div>
                    <div class="editorTypes">
                        <div class="editorTypeImages" *ngFor="let row of widgetGraphs">
                            <span 
                                (click)="showGraph(row.id)"
                                >
                                <i>
                                    {{ row.shortName }}:
                                </i>
                            </span>
                            <img
                                [style.height.px]="85"
                                [src]="row.imageUrl"
                                (click)="showGraph(row.id)"
                            >
                        </div>
                    </div>

                    <div class="editorAreaTitle">
                        <b>Graph</b>
                    </div>
                    <div class="editorArea" #dragWidget>
                    </div>

                    <div class="editorButtonShowData">
                        <button
                            class="btn btn-sm btn-secondary"
                            (click)="clickShowDatasources()"
                            >
                            <clr-icon (click)="clickShowDatasources()"
                                shape="angle left"
                                size="18"
                                >
                            </clr-icon>
                            Show Datas
                        </button>
                    </div>
    
                    <div class="editorButtonCancel">
                        <button *ngIf="showPreview"
                            class="btn btn-sm btn-secondary"
                            (click)="clickClose()"
                            >
                            Cancel
                        </button>
                    </div>
                    <div class="editorButtonSave">
                        <button *ngIf="showPreview"
                            class="btn btn-sm btn-primary"
                            (click)="clickSave()"
                            >
                            Save
                        </button>
                    </div>
        
                </div>

            </div>

        </div>
    </div>
</div>