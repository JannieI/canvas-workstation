<div class="modal modalBox">
	<div class="modal-dialog modal-xl" role="dialog" aria-hidden="true">
		<div class="modal-content modalContent">

            <div class="gridOverall">
                <button type="button" class="closeButton" (click)="clickClose()">
                    <b>X</b>
                </button>



                <!-- TOP FORM TITLE -->
                <div class="gridTitle">
                    <b>Widget Editor</b>
                    <clr-signpost>
                        <clr-icon shape="info-circle"
                            clrSignpostTrigger>
                        </clr-icon>
                        <clr-signpost-content *clrIfOpen
                            [clrPosition]="'bottom-middle'">
                            <h5 style="margin-top: 0; color:gray;">
                                Help
                            </h5>
                            <p style="margin-top: 0; color:gray;">
                                <b>For new Widgets:</b> select a datasource, and click Continue
                                to the Widget Editor.
                                <b>Widget Editor:</b> drag a Field onto the X and Y coloured blocks.
                                Select a graph type.  Properties can be changed by clicking the dropdown
                                icons.  Click Save to show the Widget on the Dashboard, or click Cancel
                                to return to the Dashboard.
                                Click the X or press Escape to close this form.
                            </p>
                        </clr-signpost-content>
                    </clr-signpost>
                </div>



                <!-- DATASOURCES -->
                <div class="datasourceMain" *ngIf="showDatasourceMain">

                    <div class="datasourceMainHelp">
                        Select a <b>Datasources</b> on which a Widget must be created.  Details
                        about the datasource is shown on the right:
                    </div>

                    <div class="datasourceMainDescriptionTitle">
                        <b>Description:</b>
                    </div>
                    <div class="datasourceMainDescription">
                        {{ selectedDescription }}
                    </div>

                    <div class="datasourceMainError">
                        {{ errorMessage }}
                    </div>

                    <div class="datasourceMainListTitle">
                        <b>Datasources:</b>
                    </div>
                    <div class="datasourceMainList">
                        <clr-datagrid class="datagrid-compact" id="my-datagrid">
                            <clr-dg-column clrDgField="name"
                                [(clrDgSortOrder)]="sortOrder"
                                (click)="sortOrder=sortOrder * -1"
                                [style.color]="'orange'"
                                [style.width.px]="40"
                                >
                                Name
                            </clr-dg-column>

                            <clr-dg-row *clrDgItems="let row of localDatasources; let i = index"
                                [clrDgItem]="row"
                                [style.font-size.px]="12"
                                [style.color]="'red'"


                                [style.background-color]="(i == selectedRowIndex)? '#123456' : 'white'"
                                [style.color]="(i == selectedRowIndex)? 'white' : 'gray'"
                                (click)="clickDSrow(i, row.id)"
                                >
                                <clr-dg-cell>
                                    {{ row.name }}
                                    <span *ngIf="row.nrWidgets > 0"
                                        class="badge badge-5">{{row.nrWidgets}}
                                    </span>
                                </clr-dg-cell>
                            </clr-dg-row>

                        </clr-datagrid>
                    </div>

                    <div class="datasourceMainPreviewTitle">
                        <b>Preview:</b>
                    </div>
                    <div class="datasourceMainPreview">
                        <clr-datagrid class="datagrid-compact">

                            <clr-dg-placeholder>Select a datasource to preview here</clr-dg-placeholder>

                            <clr-dg-column *ngFor="let row of dataFieldNames; let i = index;">
                                {{row}}
                            <clr-icon shape="times" *ngIf="i==1"
                                (click)="clickClearRowField(i)">
                            </clr-icon>
                            </clr-dg-column>
                            <clr-dg-row *ngFor="let row of currentData">

                                <clr-dg-cell *ngFor="let col of dataFieldNames;
                                    let i = index"
                                    >
                                    {{ row[col] }}
                                </clr-dg-cell>
                            </clr-dg-row>

                        </clr-datagrid>
                    </div>

                    <div class="datasourceMainButton">
                        <button *ngIf="showPreview"
                            class="btn btn-sm btn-secondary datasourceButton"
                            (click)="clickContinue()">
                            Continue
                        </button>
                    </div>
                </div>




                <!-- Widget Editor -->
                <div class="editorMain" *ngIf="!showDatasourceMain">

                     <!-- TODO - TRY this code !!! https://next.plnkr.co/edit/Hhms3CxLmzKHark5HVsd?p=preview&preview
                        <clr-dg-column *ngFor="let column of myColumns" [clrDgField]="column.name" [clrDgSorted]="column.name === 'first_name'">
                            <ng-container *ngIf="column.isMandatory; else hideableBlock">
                                {{column.displayName}}
                            </ng-container>
                            <ng-template #hideableBlock>
                                <ng-container *clrDgHideableColumn="{hidden: (column.name !== 'email') && !column.isscore}">
                                {{column.displayName}}
                                </ng-container>
                            </ng-template>

                            <clr-dg-string-filter *ngIf="column.name === 'email'" id="emailFilter" [clrDgStringFilter]="emailFilter"  [clrFilterValue]="(column.email)"></clr-dg-string-filter>
                        </clr-dg-column> -->


                    <!-- COMPOSITION -->
                    <div class="editorComposition">
                        <div class="editorCompositionTypeTitle">
                            <b>
                                Composition:
                            </b>
                        </div>
                        <div class="select editorCompositionType">
                            <select id="selects_3"
                                [(ngModel)]="currentGraphComposition"
                                (change)="changeComposition()"
                                >
                                <option>Single</option>
                                <option>Layered</option>
                                <option>Vconcat</option>
                                <option>Hconcat</option>
                                <option>Repeat</option>
                            </select>
                        </div>
                        <div class="editorCompositionLayerTitle">
                            <b>
                                Layer:
                            </b>
                        </div>
                        <div class="select editorCompositionLayer">
                            <select id="currentGraphLayer"
                                [(ngModel)]="currentGraphLayer"
                                >
                                <option *ngFor="let row of graphLayers; let i = index">
                                    {{ row }}
                                </option>
                            </select>
                        </div>
                    </div>


                    <!-- FIELDS -->
                    <div class="editorFieldsTitle">
                        <b>Fields</b>
                    </div>
                    <div class="editorFields">
                        <nav
                            >
                            <clr-datagrid class="datagrid-compact">
                                <clr-dg-column clrDgField="name"
                                    [(clrDgSortOrder)]="sortOrder"
                                    (click)="sortOrder=sortOrder * -1"
                                    >
                                    Name
                                </clr-dg-column>

                                <clr-dg-row *clrDgItems="let row of dataSchema; let i = index"
                                    [clrDgItem]="row"
                                    >
                                    <clr-dg-cell style="margin-left: 2px; padding: 0;"
                                        id="fld"
                                        draggable="true"
                                        (dragstart)="dragstartField($event)"
                                        >
                                        <clr-icon *ngIf="row.type=='string'"
                                            shape="text"
                                            size="14"
                                            [style.background-color]="'rgb(241, 239, 239)'"
                                            [style.color]="'black'"
                                            >
                                        </clr-icon>
                                        <clr-icon *ngIf="row.type=='number'"
                                            shape="italic"
                                            size="14"
                                            [style.background-color]="'rgb(188, 241, 188)'"
                                            [style.color]="'black'"
                                            >
                                        </clr-icon>
                                        <clr-icon *ngIf="row.type=='date'"
                                            shape="calendar"
                                            size="14"
                                            [style.border]="'white'"
                                            [style.background-color]="'white'"
                                            [style.color]="'black'"
                                            >
                                        </clr-icon>
                                        <clr-icon *ngIf="row.type=='boolean'"
                                            shape="minus"
                                            size="14"
                                            [style.border]="'white'"
                                            [style.background-color]="'rgb(206, 199, 245)'"
                                            [style.color]="'black'"
                                            >
                                        </clr-icon>

                                        {{ row.name }}
                                        <!-- <span class="badge badge-light-gray">
                                            {{row.length}}
                                        </span> -->
                                    </clr-dg-cell>
                                </clr-dg-row>

                            </clr-datagrid>
                        </nav>
                    </div>


                    <!-- PROPERTIES -->
                    <div class="editorPropertiesTitle">
                        <b>
                            Properties
                        </b>
                    </div>
                    <div class="editorProperties">

                        <!-- TOP 3 - 1. X field -->
                        <div class="editorColFieldTitle">
                            X axis:
                        </div>
                        <div class="editorColField"
                            id="target"
                            (drop)="dropColumn($event);"
                            (dragover)="dragoverColumn($event);"
                            (dragenter)="dragenterColumn($event);"
                            (dragleave)="dragleaveColumn($event);"
                            [style.background-color]="dragoverCol? 'lightgray' : 'transparent'"
                            [style.font-style]="colField=='Drag a field here ...' ?  'italic'  :  'normal'"
                            >
                            <clr-icon shape="times" *ngIf="showColumnDeleteIcon"
                                (click)="clickClearColumnField()">
                            </clr-icon>
                            {{ colField }}
                        </div>

                        <!-- TOP 3 - 2. Y field -->
                        <div class="editorRowFieldTitle">
                            Y axis:
                        </div>
                        <div class="editorRowField"
                            id="target"
                            (drop)="dropRow($event);"
                            (dragenter)="dragenterRow($event);"
                            (dragleave)="dragoleaveRow($event);"
                            (dragover)="dragoverRows($event);"
                            [style.background-color]="dragoverRow? 'lightgray' : 'transparent'"
                            [style.font-style]="rowField=='Drag a field here ...' ?  'italic'  :  'normal'"
                            >
                            <clr-icon shape="times" *ngIf="showRowDeleteIcon"
                                (click)="clickClearRowField()">
                            </clr-icon>
                            {{ rowField }}
                        </div>

                        <!-- TOP 3 - 3. Color field -->
                        <div class="editorColourFieldTitle">
                            Colour:
                        </div>
                        <div class="editorColourField"
                            id="target"
                            (drop)="dropColour($event);"
                            (dragenter)="dragenterColour($event);"
                            (dragleave)="dragleaveColour($event);"
                            (dragover)="dragoverColour($event);"
                            [style.background-color]="dragoverColours? 'lightgray' : 'transparent'"
                            [style.font-style]="graphColorField=='Drag a field here ...' ?  'italic'  :  'normal'"
                            >
                            <clr-icon shape="times" *ngIf="showColourDeleteIcon"
                                (click)="clickClearColourField()"
                                >
                            </clr-icon>
                            {{ graphColorField }}
                        </div>


                        <!-- TITLE -->
                        <!-- Title Header -->
                        <div class="editorTitleTitle"
                            (click)="clickShowTitleProperties()"
                            >
                            <b>
                                Title
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldTitleProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldTitleProperties"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Title Text -->
                        <div class="editorTitleTextTitle" *ngIf="showFieldTitleProperties">
                            Text:
                        </div>
                        <div class="editorTitleText" *ngIf="showFieldTitleProperties">
                            <input type="text"
                                placeholder="Text of title"
                                [(ngModel)]="titleText"
                                name="titleText"
                                style="border-radius: 5px; width: 100%;"
                                >
                        </div>

                        <!-- Title Anchor -->
                        <div class="editorTitleAnchorTitle" *ngIf="showFieldTitleProperties">
                            Anchor:
                        </div>
                        <div class="select editorTitleAnchor" *ngIf="showFieldTitleProperties">
                            <select id="selects_3"
                                [(ngModel)]="titleAnchor"
                                >
                                <option>Start</option>
                                <option>Middle</option>
                                <option>End</option>
                            </select>
                        </div>

                        <!-- Title Angle in degrees -->
                        <div class="editorTitleAngleTitle" *ngIf="showFieldTitleProperties">
                            Angle:
                        </div>
                        <div class="editorTitleAngle" *ngIf="showFieldTitleProperties">
                            <input type="number"
                                placeholder="Angle of title"
                                [(ngModel)]="titleAngle"
                                name="titleText"
                                >
                        </div>

                        <!-- Vertical text baseline for title text. -->
                        <div class="editorTitleBaselineTitle" *ngIf="showFieldTitleProperties">
                            Baseline:
                        </div>
                        <div class="select editorTitleBaseline" *ngIf="showFieldTitleProperties">
                            <select id="selects_3"
                                [(ngModel)]="titleBaseline"
                                >
                                <option>Top</option>
                                <option>Middle</option>
                                <option>Bottom</option>
                            </select>
                        </div>

                        <!-- Text color for title text.  -->
                        <div class="editorTitleColourTitle" *ngIf="showFieldTitleProperties">
                            Color:
                        </div>
                        <div class="select editorTitleColour" *ngIf="showFieldTitleProperties">
                            <select [(ngModel)]="titleColorName"
                                name="titleColorName"
                                (change)="clickSelectTitleColor($event)"
                                >
                                <option *ngFor="let row of backgroundcolors"
                                    [style.background-color]="row.cssCode"
                                    >
                                    {{ row.name }}
                                </option>
                            </select>
                        </div>

                        <!-- Font name for title text. -->
                        <div class="editorTitleFontTitle" *ngIf="showFieldTitleProperties">
                            Font:
                        </div>
                        <div class="editorTitleFont" *ngIf="showFieldTitleProperties">
                            <input type="text"
                                placeholder="Font name"
                                [(ngModel)]="titleFont"
                                name="titleFont"
                                >
                        </div>

                        <!-- Font size in pixels for title text. Default value: 10. -->
                        <div class="editorTitleFontSizeTitle" *ngIf="showFieldTitleProperties">
                            Font Size:
                        </div>
                        <div class="editorTitleFontSize" *ngIf="showFieldTitleProperties">
                            <input type="number"
                                placeholder="Font Size"
                                [(ngModel)]="titleFontSize"
                                name="titleFontSize"
                                >
                        </div>

                        <!-- Font Weight in pixels for title text. Default value: 10. -->
                        <div class="editorTitleFontWeightTitle" *ngIf="showFieldTitleProperties">
                            Font Weight:
                        </div>
                        <div class="editorTitleFontWeight" *ngIf="showFieldTitleProperties">
                            <input type="number"
                                placeholder="Font Weight (100, 200..900)"
                                [(ngModel)]="titleFontWeight"
                                name="titleFontWeight"
                                >
                        </div>

                        <!-- limit: The maximum allowed length in pixels of legend labels.-->
                        <div class="editorTitleLengthTitle" *ngIf="showFieldTitleProperties">
                            Length:
                        </div>
                        <div class="editorTitleLength" *ngIf="showFieldTitleProperties">
                            <input type="number"
                                placeholder="Max length in px"
                                [(ngModel)]="titleLength"
                                name="titleLength"
                                >
                        </div>

                        <!-- orient: Default title orientation ("top", "bottom", "left", or "right") -->
                        <div class="editorTitleOrientationTitle" *ngIf="showFieldTitleProperties">
                            Orientation:
                        </div>
                        <div class="select editorTitleOrientation" *ngIf="showFieldTitleProperties">
                            <select id="selects_3"
                                [(ngModel)]="titleOrientation"
                                >
                                <option>Top</option>
                                <option>Bottom</option>
                                <option>Left</option>
                                <option>Right</option>
                            </select>
                        </div>


                        <!-- X Properties -->
                        <div class="editorXPropertiesTitle" *ngIf="showFieldXPropertiesTitle"
                            (click)="clickShowXProperties()"
                            >
                            <b>
                                X Properties
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldXProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldXProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="info-circle" *ngIf="showFieldXPropertiesInfo"
                                style="color: rgb(101, 101, 196);
                                    float: right;
                                    margin-top: 4px;"
                                >
                            </clr-icon>
                        </div>
                        <div class="editorXPropertiesAggregateTitle" *ngIf="showFieldXProperties">
                            Aggregate:
                        </div>
                        <div class="select editorXPropertiesAggregate" *ngIf="showFieldXProperties">
                            <select id="selects_3"
                                [(ngModel)]="xPropertiesAggregate"
                                (change)="changeXProperty()"
                                >
                                <option *ngFor="let row of aggregations; let i = index">
                                    {{ row.displayName }}
                                </option>
                            </select>
                        </div>


                        <!-- Y Properties -->
                        <div class="editorYPropertiesTitle" *ngIf="showFieldYPropertiesTitle"
                            (click)="clickShowYProperties()"
                            >
                            <b>
                                Y Properties
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldYProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldYProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="info-circle"
                                style="color: rgb(101, 101, 196);
                                    float: right;
                                    margin-top: 4px;"
                                >
                            </clr-icon>
                        </div>
                        <div class="editorYPropertiesAggregateTitle" *ngIf="showFieldYProperties">
                            Aggregate:
                        </div>
                        <div class="select editorYPropertiesAggregate" *ngIf="showFieldYProperties">
                            <select id="selects_3"
                                [(ngModel)]="yPropertiesAggregate"
                                >
                                <option *ngFor="let row of aggregations; let i = index">
                                    {{ row.displayName }}
                                </option>
                            </select>
                        </div>


                        <!-- Filter -->
                        <div class="editorFilterTitle"
                            (click)="clickShowFilter()"
                            >
                            <b>
                                Filter
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldFilter"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldFilter"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="info-circle"
                                style="color: rgb(101, 101, 196);
                                    float: right;
                                    margin-top: 4px;"
                                >
                            </clr-icon>
                        </div>


                        <!-- Selection -->
                        <div class="editorSelectionTitle"
                            (click)="clickShowSelection()"
                            >
                            <b>
                                Selection
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldSelection"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldSelection"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="info-circle"
                                style="color: rgb(101, 101, 196);
                                    float: right;
                                    margin-top: 4px;"
                                >
                            </clr-icon>
                        </div>




                    </div>


                    <!-- GRAPH TYPES -->
                    <div class="editorTypesTitle">
                        <b>
                            Types
                        </b>
                    </div>
                    <div class="editorTypes">
                        <div class="editorTypeImages" *ngFor="let row of widgetGraphs">
                            <span
                                (click)="showGraph(row.id)"
                                >
                                <i>
                                    {{ row.shortName }}:
                                </i>
                            </span>
                            <img
                                [style.height.px]="85"
                                [src]="row.imageUrl"
                                (click)="showGraph(row.id)"
                            >
                        </div>
                    </div>



                    <!-- GRAPH Area -->
                    <div class="editorAreaTitle">
                        <b>Graph</b>
                    </div>
                    <div class="editorArea" #dragWidget>
                    </div>


                    <!-- BUTTONS -->
                    <div class="editorButtonShowData">
                        <button
                            class="btn btn-sm btn-secondary"
                            (click)="clickShowDatasources()"
                            >
                            <clr-icon (click)="clickShowDatasources()"
                                shape="angle left"
                                size="18"
                                >
                            </clr-icon>
                            Show Data
                        </button>
                    </div>
                    <div class="editorButtonCancel">
                        <button *ngIf="showPreview"
                            class="btn btn-sm btn-secondary"
                            (click)="clickClose()"
                            >
                            Cancel
                        </button>
                    </div>
                    <div class="editorButtonSave">
                        <button *ngIf="showPreview"
                            class="btn btn-sm btn-primary"
                            (click)="clickSave()"
                            >
                            Save
                        </button>
                    </div>

                </div>

            </div>

        </div>
    </div>
</div>