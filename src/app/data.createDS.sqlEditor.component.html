<div class="modal modalBox">
    <div class="modal-dialog modal-xl" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <form #f="ngForm" role="form" novalidate>

                <div class="gridOverall">
                    <button type="button" class="closeButton" (click)="clickClose()">
                        <b>X</b>
                    </button>
                    <div class="gridTitle">
                        <b>SQL Editor</b>
                        <clr-signpost>
                            <clr-icon shape="info-circle"
                                clrSignpostTrigger>
                            </clr-icon>
                                <clr-signpost-content *clrIfOpen
                                [clrPosition]="'bottom-middle'">
                                <h5 style="margin-top: 0; color:gray;">
                                    Help
                                </h5>
                                <p style="margin-top: 0; color:gray;">
                                    Add / Edit a Datasource from a SQL Database: identify
                                    the Connection, type the SQL string, and see the results
                                    with GO.
                                    Click the X or press Escape to close this form.
                                </p>
                            </clr-signpost-content>
                        </clr-signpost>
                    </div>


                    <!-- WHERE IS DATA: define location, and credentials -->
                    <div class="gridWhereContainer" *ngIf="step=='Where'">

                        <div class="whereHelp">
                            <i>
                                Enter the details to a new SQL source, or selected from a
                                previously defined connection.
                            </i>
                        </div>

                        <div class="whereNameTitle">
                            <b>Name:</b>
                        </div>
                        <div class="whereName">
                            <input [(ngModel)]="selectedDatasource.name"
                                type="text"
                                name="name"
                                title="Name of the Datasource"
                                >
                        </div>

                        <div class="whereDescriptionTitle">
                            <b>Description:</b>
                        </div>
                        <div class="whereDescription">
                                <input [(ngModel)]="selectedDatasource.description"
                                type="text"
                                name="description"
                                title="Description of the Datasource"
                                >
                        </div>

                        <div class="whereServerTypeTitle">
                            <b>Type:</b>
                        </div>
                        <div class="select whereServerType">
                            <select
                                [(ngModel)]="selectedDatasource.serverType"
                                name="serverType"
                                (change)="clickTemplateDashboard($event)"
                                placeholder="Select a Type of server, ie MySQL"
                                >
                                <option *ngFor="let row of serverTypes">
                                    {{ row.serverType }}
                                </option>
                            </select>
                        </div>

                        <div class="whereServerNameTitle">
                            <b>Server:</b>
                        </div>
                        <div class="whereServerName">
                            <input [(ngModel)]="selectedDatasource.serverName"
                                type="text"
                                name="serverName"
                                title="Name of the Server / Host"
                                >
                        </div>

                        <div class="whereServerPortTitle">
                            <b>Port:</b>
                        </div>
                        <div class="whereServerPort">
                                <input [(ngModel)]="selectedDatasource.port"
                                type="text"
                                name="port"
                                title="Name of the port on the DB Server"
                                >
                        </div>

                        <div class="whereDatabaseTitle">
                            <b>Database:</b>
                        </div>
                        <div class="whereDatabase">
                                <input [(ngModel)]="selectedDatasource.databaseName"
                                type="text"
                                name="databaseName"
                                title="Name of the Database or Host"
                                >
                        </div>

                        <div class="whereUsernameTitle">
                            <b>Username:</b>
                        </div>
                        <div class="whereUsername">
                            <input [(ngModel)]="selectedDatasource.username"
                                type="text"
                                name="username"
                                title="Name of the connection"
                                >
                        </div>

                        <div class="wherePasswordTitle">
                            <b>Password:</b>
                        </div>
                        <div class="wherePassword">
                            <input [(ngModel)]="selectedDatasource.password"
                                type="password"
                                name="password"
                                title="User Password"
                                >
                        </div>

                        <div class="whereDatasourceIsCachedTitle">
                            <b>Cache?:</b>
                        </div>
                        <div class="whereDatasourceIsCached">
                            <input [(ngModel)]="selectedDatasource.cacheResults"
                            type="checkbox"
                            name="dashboardQArequired"
                            title="Cached results for this Datasource (T/F)"
                            >
                        </div>

                        <div *ngIf="whereErrorMessage!=''" class="whereErrorMessage">
                            {{ whereErrorMessage }}
                        </div>

                        <div class="whereConnectionsTable">
                            <clr-datagrid class="datagrid-compact">
                                <clr-dg-placeholder>
                                    No records ...
                                </clr-dg-placeholder>
                                <clr-dg-column>Delete</clr-dg-column>
                                <clr-dg-column>Name</clr-dg-column>
                                <clr-dg-column>Type</clr-dg-column>
                                <clr-dg-column>Server</clr-dg-column>
                                <clr-dg-column>Auth</clr-dg-column>
                                <clr-dg-column>Description</clr-dg-column>
                                <clr-dg-row
                                    *ngFor="let row of dataConnections; let i = index"
                                    [style.background-color]="(i == selectedConnectionRowIndex)? '#123456' : 'white'"
                                    [style.color]="(i == selectedConnectionRowIndex)? 'white' : 'gray'"
                                    (click)="clickRow(i, row.id)"
                                    >
                                    <clr-dg-cell>
                                        <clr-icon shape="trash"
                                            class="selectIcon1"
                                            size="18"
                                            (dblclick)="clickDelete(i, row.id)"
                                            >
                                        </clr-icon>
                                    </clr-dg-cell>
                                    <clr-dg-cell>{{ row.connectionName }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.serverType }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.serverName }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.authentication }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.description }}</clr-dg-cell>
                                </clr-dg-row>
                            </clr-datagrid>
                        </div>

                        <div class="whereButtonCancel">
                            <button
                                type="button"
                                class="btn btn-secondary"
                                (click)="clickClose('Close')"
                                >
                                Cancel
                            </button>
                        </div>
                        <div class="whereButtonContinue">
                            <button
                                type="button"
                                class="btn btn-primary"
                                (click)="clickContinue()"
                                >
                                Continue
                            </button>
                        </div>
                    </div>


                    <!-- WHAT DATA to extract: Define SQL statement to  -->
                    <div class="gridWhatContainer" *ngIf="step=='What'">
                        <div class="whatHelp">
                            <i>
                                Enter the SQL statement with quotes around the fields.  
                                Click GO to see the results.  Once done, click ADD to 
                                create a new Datasource.
                            </i>
                        </div>

                        <div class="whatTablesTitle">
                            <b>Tables</b>
                        </div>
                        <div class="select whatTables">
                            <select
                                [(ngModel)]="selectedTable"
                                name="serverType"
                                (change)="clickSelectTable($event)"
                                placeholder="Tables in the DB"
                                >
                                <option *ngFor="let row of dataSchemas">
                                    {{ row.tableName }}
                                </option>
                            </select>
                        </div>

                        <div class="whatFieldsTitle">
                            <b>Fields</b>
                        </div>
                        <div class="select whatFields">
                            <select
                                [(ngModel)]="selectedField"
                                name="serverType"
                                placeholder="Fields in the selected Table"
                                >
                                <option *ngFor="let row of fieldsInTable">
                                    {{ row }}
                                </option>
                            </select>
                        </div>

                        <div class="whatSQLTextTitle">
                            <b>SQL Statement</b>
                        </div>
                        <div class="whatButtonExport">
                                <button
                                type="button"
                                class="btn btn-link"
                                (click)="clickExport()"
                                >
                                Export SQL
                            </button>
                        </div>

                        <textarea class="whatSQLText" [(ngModel)]="selectedDatasource.dataSQLStatement"
                            name="textArea"
                            >SELECT "InvoiceDate", "BillingCity" FROM invoices
                        </textarea>

                        <div *ngIf="whatErrorMessage!=''" class="whatErrorMessage">
                            {{ whatErrorMessage }}
                        </div>

                        <div class="whatGoButton">
                            <button
                                type="button"
                                class="btn btn-link"
                                (click)="clickGo()"
                                >
                                Go
                                <clr-icon shape="arrow right" size="12"></clr-icon>
                            </button>
                        </div>

                        <span class="spinner spinner-inline whatSpinner" *ngIf="spinner">
                            Loading...
                        </span>

                        <div class="whatDataTitle">
                            <b>
                                Preview of data
                            </b>
                        </div>
                        <div class="whatData" *ngIf="showPreview">
                            <clr-datagrid class="datagrid-compact">

                                <clr-dg-column *ngFor="let row of selectedDatasource.dataFields">
                                    {{ row }}
                                </clr-dg-column>

                                <clr-dg-row *clrDgItems="let row of fileData">
                                    <clr-dg-cell *ngFor="let col of selectedDatasource.dataFields; let i = index">
                                            {{ row[col] }}
                                    </clr-dg-cell>
                                </clr-dg-row>

                                <!-- <clr-dg-footer>
                                    {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}}
                                    of {{pagination.totalItems}} rows
                                    <clr-dg-pagination #pagination [clrDgPageSize]="8"></clr-dg-pagination>
                                </clr-dg-footer> -->

                            </clr-datagrid>
                        </div>

                        <div *ngIf="savedMessage!=''" class="whatSavedMessage">
                            {{ savedMessage }}
                        </div>

                        <div class="whatButtonCancel">
                            <button
                                type="button"
                                class="btn btn-secondary"
                                (click)="clickClose('Close')"
                                >
                                Cancel
                            </button>
                        </div>

                        <div class="whatButtonSave" *ngIf="showPreview">
                            <button
                                type="button"
                                class="btn btn-primary"
                                (click)="clickAdd('Saved')"
                                >
                                <span *ngIf="!editingDS">
                                    Add
                                </span>
                                <span *ngIf="editingDS">
                                    Save
                                </span>

                            </button>
                        </div>
                        <div class="whatButtonAddUpdate" *ngIf="showPreview">
                            <button
                                type="button"
                                class="btn btn-primary"
                                (click)="clickAddUpdate('Saved')"
                                >
                                <span *ngIf="!editingDS">
                                    Add ...
                                </span>
                                <span *ngIf="editingDS">
                                    Update ...
                                </span>

                            </button>
                        </div>
    
                        <div class="whatButtonTransformation" *ngIf="showPreview">
                            <button
                                type="button"
                                class="btn btn-link"
                                (click)="clickAdd('Transformation')"
                                >
                                <span *ngIf="!editingDS">
                                    Add
                                </span>
                                <span *ngIf="editingDS">
                                    Save
                                </span>
                                and open Transformations
                            </button>
                        </div>
                    </div>
                </div>





            </form>
        </div>
    </div>
</div>
