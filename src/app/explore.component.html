<div class="presentationButton dropdown" *ngIf="presentation">
    <clr-dropdown>
        <button type="button" clrDropdownTrigger>
            <clr-icon shape="bars"></clr-icon>
        </button>
        
        <clr-dropdown-menu clrPosition="bottom-left" *clrIfOpen>
            <button
                type="button"
                class="btn btn-link btn-sm"
                clrDropdownItem
                title="Show the first Dashboard in the presentation"
                >
                <clr-icon shape="step-forward down" size="20"></clr-icon>
                First Dashboard
            </button>
            <button
                type="button"
                class="btn btn-secondary btn-sm"
                clrDropdownItem
                title="Jump to the Next Dashboard"
                >
                <clr-icon shape="fast-forward" size="20"></clr-icon>
                Next Dashboard
            </button>
            <button
                type="button"
                class="btn btn-secondary btn-sm"
                clrDropdownItem
                title="Return to the Previous Dashboard"
                >
                <clr-icon shape="rewind" size="20"></clr-icon>
                Previous Dashboard
            </button>
            <button
                type="button"
                class="btn btn-secondary btn-sm"
                clrDropdownItem
                title="Show the Last Dashboard in the presentation"
                >
                <clr-icon shape="step-forward" size="20"></clr-icon>
                Last Dashboard
            </button>
            <button
                type="button"
                class="btn btn-secondary btn-sm"
                clrDropdownItem
                title="Start recording the navigation"
                >
                <clr-icon shape="camera" size="20"></clr-icon>
                Record
            </button>
            <button
                type="button"
                class="btn btn-secondary btn-sm"
                clrDropdownItem
                title="Stop recording the navigation"
                >
                <clr-icon shape="stop" size="20"></clr-icon>
                Stop Record
            </button>
            <button
                type="button"
                class="btn btn-secondary btn-sm"
                clrDropdownItem
                title="Play the pre-recorded navigation"
                >
                <clr-icon shape="video-camera" size="20"></clr-icon>
                Play
            </button>
            <button
                type="button"
                class="btn btn-secondary btn-sm"
                clrDropdownItem
                title="Print all the Dashboards in presentation format"
                >
                <clr-icon shape="printer" size="20"></clr-icon>
                Print ...
            </button>
            <button
                type="button"
                class="btn btn-secondary btn-sm"
                clrDropdownItem
                (click)="clickClosePresentation()"
                title="Exit the presentation, and return to the Dashboard page"
                >
                <clr-icon shape="times" size="20"></clr-icon>
                Exit
            </button>
        </clr-dropdown-menu>
    </clr-dropdown>
</div>

<div class="helpMessagePresentation" *ngIf="presentationMsg  &&  presentation">

    <b>HELP</b> message: the presentation mode is the same as View-only Mode since no 
    changes are allowed.  It however provides the following benefits:
    <div>1. More screen area as the menus and status bar are hidden</div>
    <div>2. Improved storytelling by linking to other Dashboards.  Usindiv the <clr-icon shape="bars"></clr-icon> 
    menu in the top left corner, one can jump to other Dashboards that were linked
    during the creation of the Dashboard.  The link button is also available by hovering
    over the top of the Widget or Shape that is linked.  Multiple Widgets can be linked,
    but each one can only link to one Dashboard.  Linking is optional.</div>
    <div>3. Widget checkpoints are different layouts/graphs of a Widget in the same container, 
    similar to bookmarks.
    This is ideal to save space and show the detail behind a graph, and is created during the creation of the Dashboard.
    The buttons to travers the checkpoints become visible when hovering over the top of the 
    Widget.  Not all Widgets will have checkpoints since it are options.</div>
    <div>4. The navigation actions can be recorded and played back.  This is useful for 
    predefined presentations.
    </div>
    <br>
    <b>Got it</b> <input type="checkbox" (click)="clickGotItPresentation()" [checked]="!presentationMsg">
</div>

<div class="helpMessage" *ngIf="isFirstTimeDashboard">
    <b>HELP</b> message: this is your Dashboard on which data can be visualised.  It can have more than
    one tab (like a spreadsheet), as shown at the bottom of the page.  Some actions:
    <div class="helpMessageDiv">
        1. Add a datasource (click <i>Data</i> in the top menu, and select the type of source
         like <i>From File</i>).  Once done, return to this Dashboard.
    </div>
    <div class="helpMessageDiv">
        2. Insert a Widget to visualise the added datasource (click <i>Create -> Widget</i> in the top
            menu).
    </div>
    <div class="helpMessageDiv">
        3. Format and arrange Widgets as necessary.
    </div>
    <div class="helpMessageDiv">
        4. Save your new Dashboard with a name using <i>File -> SaveAs</i>.
    </div>
    <div class="helpMessageDiv">
    5. Existing Dashboards can be opened with <i>File -> Open</i>.
    </div>
    <div class="helpMessageDiv">
        6. Collaboration (discussions with colleagues) happens via messages and tasks (click
            the <i>Share <clr-icon shape="share"></clr-icon> icon</i> in the top right menu).
    </div>
    <div class="helpMessageDiv">
        7. Click <i>File -> Edit</i> to Edit a Dashboard.  An indicator will be shown in the
        right hand bottom corner.
    </div>
    <br><br>
        <b>Got it</b> 
        <input type="checkbox" (click)="clickGotIt()" [checked]="!isFirstTimeDashboard">
        (You can make this message re-appear with the <i>Preferences</i> option under your
        User icon <clr-icon shape="user"></clr-icon> in the top right menu.  The Dashboard
        will function normally while this message is displayed.)
</div>

<span
    class="graphy"
    [style.color] = "showContainerHeader ? 'black' : 'transparent'"
    (click)="clickWidget($event)"
    (dragstart)="dragStartWidget($event)"
    (dragend)="dragEndWidget($event)"
    draggable="true"
    #dragWidget

    >
    <span class="widgetHandle"
    [style.color] = "showContainerHeader ? 'black' : 'transparent'"
    >Drag Edit</span>
    <div
        [style.border] = "showContainerHeader ? '1px black dotted' : 'none'"
        >
        <span #visReal>
        </span>
    </div>
</span>

<div>
    <div *ngFor="let ds of localDashboards" class="widgetContainer"
        #widgetContainter>
        <div class="widgetButtonBar">
            <clr-icon shape="plus" size="20" class="buttonBarIcon" (click)="clickWidgetEdit()"></clr-icon>
            <clr-icon shape="filter-grid" size="20" class="buttonBarIcon"></clr-icon>
            <clr-icon shape="cursor-hand" size="20" class="buttonBarIcon"></clr-icon>
            <clr-icon shape="pop-out" size="20" class="buttonBarIcon"></clr-icon>
            <clr-icon shape="pencil" size="20" class="buttonBarIcon"></clr-icon>
            <clr-icon shape="pin" size="20" class="buttonBarIcon"></clr-icon>
            <clr-icon shape="copy" size="20" class="buttonBarIcon"></clr-icon>
        </div>
        <div class="widget">
            <div #widget>
                Here: {{ ds.mark }}
            </div>
        </div>
    </div>
</div>


<div *ngIf="showShapes">
    <div *ngFor="let row of localShapes" class="shapeContainer"
        #shapeContainter>
        <div class="widgetButtonBar">
            <clr-icon shape="plus" size="20" class="buttonBarIcon" (click)="clickWidgetEdit()"></clr-icon>
            <clr-icon shape="filter-grid" size="20" class="buttonBarIcon"></clr-icon>
            <clr-icon shape="cursor-hand" size="20" class="buttonBarIcon"></clr-icon>
            <clr-icon shape="pop-out" size="20" class="buttonBarIcon"></clr-icon>
            <clr-icon shape="pencil" size="20" class="buttonBarIcon"></clr-icon>
            <clr-icon shape="pin" size="20" class="buttonBarIcon"></clr-icon>
            <clr-icon shape="copy" size="20" class="buttonBarIcon"></clr-icon>
        </div>
        <div class="shape">
            <div #shape>
                {{ row.type }}
                <div
                    #dragCircle
                    class="aCircle"
                    (dragstart)="dragStartCircle($event)"
                    (dragend)="dragEndCircle($event)"
                    draggable="true"
                    >
                    <svg height="100" width="100" >
                        <circle #circle [attr.cx]="50" 
                        [attr.cy]="50" [attr.r]="circleRadius" [attr.stroke]="blue" 
                        [attr.stroke-width]="2" [style.fill]="none" />
                    </svg>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="statusBar" *ngIf="showMainMenu">
    <span class="statusBarText" title="Current Dashboard">
        Analysis of Value Traded 2017 ...
    </span>
    <span class="statusBarText">
        Tabs :
    </span>
    <span class="statusBarText statusBarTextBorder" title="Tab: Summary of Sales"
        (click)="clickAddTab()">
        <b>Summary</b>
    </span>
    <span class="statusBarText statusBarTextBorder" title="Tab: Detail costing YTD"
        *ngIf="secondTab" (click)="clickAddTab()">
        Detail Costs
    </span>

    <span class="statusBarText statusBarTextBorder" title="Click to Add a new Tab">
        <clr-icon shape="plus" size="12"
            (click)="clickAddTab()"></clr-icon>
    </span>
    <span class="statusBarText" title="How long ago the Dashboard layout was updated">
        Updated: 1d
    </span>
    <span class="statusBarText" title="When last all the data in the Dashboard was refresh">
        Refreshed: 08:31
    </span>
    <span [ngSwitch]="editMode" class="statusBarText">
        <b    *ngSwitchCase="true" title="Changes can be done in Edit Mode">Edit Mode </b>
        <span *ngSwitchDefault title="View only mode means no changes can be made">View-Only     </span> 
    </span>
    <span class="statusBarText" title="Indicate long-running queries in the background">
        {{ statusBarRunning }}
    </span>
    <span class="statusBarText statusBarTextBorder" title="Click to cancel a running query">
        {{ statusBarCancelRefresh }}
    </span>
    <span class="statusBarText" title="Short message.  If more than one, it will indicate the last one">
      {{ statusBarMessages }}
    </span>
    <span class="statusBarText" title="Working standalone (local) or logged into a server">
      Local/Srv
    </span>
    <span class="statusBarText" title="All changes have been saved, or are being saved...">
      Saving.../Saved
    </span>
    <span class="statusBarText" title="Canvas version">
      V 1.02
    </span>
    <span class="statusBarText" title="Indicates if a Template is being used (which is readonly)">
      Template Used
    </span>
</div>


<!-- <div class="bgGrid" *ngIf="showGrid">
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
    <div>
        <h1>.</h1>
    </div>
</div> -->

<div class="bgGrid" *ngIf="showGrid">
    <svg width="100%" height="100%">
    
        <!-- Create mask that we'll use to define a slight gradient -->
        <mask maskUnits="userSpaceOnUse" id="fade">
        <!-- Here's that slight gradient -->
        <linearGradient id="gradient" x1="0" y1="0" x2="0" y2="100%">
            <stop offset ="0" style="stop-color: #FFFFFF" />
            <stop offset ="1" style="stop-color: #000000" />
        </linearGradient>
        <!-- The canvas for our mask -->
        <rect fill="url(#gradient)" width="100%" height="100%" />
        </mask>
        
        <!-- Let's define the pattern -->
        <!-- The width and height should be double the circle radius we plan to use -->
        <pattern id="pattern-circles" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse">
        <!-- Now let's draw the circle -->
        <!-- We're going to define the `fill` in the CSS for flexible use -->
        <circle mask="url(#fade)" cx="1" cy="1" r="1" />
        </pattern>
        <!-- The canvas with our applied pattern -->
        <rect x="0" y="0" width="100%" height="100%" fill="url(#pattern-circles)" />
        
    </svg>
</div>

<!-- Modal: New Tab -->
<dashboard-tab
    class="formPopupDashboard"
    *ngIf="showNewTab"
    (formDashboardTabClosed)="handleCloseDashboardTab($event)">Load Dashboard Tab ...
</dashboard-tab>





<!-- Testing new Widget stuffies -->
<div *ngFor="let row of localWidgets" class="widgetContainer2"
    #widgetContainter2
    [style.left.px]="row.container_left"
    [style.top.px]="row.container_top"

    [style.background-color]="row.container_background_color"
    [style.border]="row.container_border"
    [style.height]="row.container_height"
    [style.width]="row.container_width"
    [style.zindex]="row.container_zindex"
    [style.box_shadow]="row.container_box_shadow"
    >
    <div class="widgetButtonBar2">
        <clr-icon shape="plus" size="20" class="buttonBarIcon" (click)="clickWidgetEdit()"></clr-icon>
        <clr-icon shape="filter-grid" size="20" class="buttonBarIcon"></clr-icon>
        <clr-icon shape="pop-out" size="20" class="buttonBarIcon"></clr-icon>
        <clr-icon shape="pencil" size="20" class="buttonBarIcon"></clr-icon>
        <clr-icon shape="pin" size="20" class="buttonBarIcon"></clr-icon>
        <clr-icon shape="copy" size="20" class="buttonBarIcon"></clr-icon>
        <clr-icon shape="cursor-arrow" size="20" class="buttonBarIcon" (click)="clickSelect()"></clr-icon>
    </div>
    <div class="widgetSelected" *ngIf="selectW"
        (mousedown)="clickDragMouseDown($event,  row.id)"
        (mouseup)="clickDragMouseUp($event, row.id)"
        (dragstart)="clickDragStart($event, row.id)"
        (dragend)="clickDragEnd($event, row.id)"
        (keydown)="clickDragKeydown($event, row.id)"
        >
        <clr-icon 
            shape="cursor-hand" 
            size="20" 
            class="buttonBarIcon2" 
            title="Drag handle to move Widget around"
            draggable="true"
            >
        </clr-icon>
    </div>
    <div class="widget">
        <div #widget2>
            Here: {{ row.name }}
        </div>
    </div>
</div>
