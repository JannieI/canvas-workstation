<div class="modal modalBox">
    <div class="modal-dialog modal-xl" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div modalContent>
                <button type="button" class="closeButton" (click)="clickClose()">
                    X
                </button>
                <div class="gridOverall">
                    <div class="gridTitle">
                        Manage Datasources
                    </div>
                    <div class="gridSubTitle">
                        <i>
                            Add Datasources to the current Dashboard by checking them, or Remove
                            by unchecking.  Removal is only possible if no Widget is linked 
                            to it.
                        </i>
                    </div>
            
                    <div class="gridDatasources">
                        <clr-datagrid> 
                            <clr-dg-placeholder>
                                No records ...
                            </clr-dg-placeholder>

                            <clr-dg-row
                                *ngFor="let row of datasources; let i = index"
                                [style.background-color]="(i == selectedRowIndex)? '#123456' : 'white'"
                                [style.color]="(i == selectedRowIndex)? 'white' : 'gray'"
                                (click)="clickSelectedDatasource(i, row.id)"
                                >
                                <clr-dg-cell>
                                    <input type="checkbox" class="dsCheckbox"
                                        [checked]="row.isSelected"
                                        (click)="clickDSCheckbox(row.id, i, $event)"
                                        >
                                    <div class="dsName">
                                        {{ row.fieldValue }}                                        {{row.name}}
                                    </div>

                                </clr-dg-cell>
                            </clr-dg-row>
                        </clr-datagrid>
                    </div>

                    <div *ngIf="errorMessage!=''" class="gridErrorMessage">
                        {{ errorMessage }}
                    </div>

                    <div class="gridButtons">
                        <div class="btn-group btn-link btn-sm">
                            <button class="btn" 
                                (click)="clickDSDescription('gridViewDescription')"
                                >
                                Description
                            </button>
                            <button class="btn" 
                                (click)="clickDSPreview('gridViewPreview')"
                                >
                                Preview
                            </button>
                            <button class="btn" 
                                (click)="clickViewProperties('gridViewFieldProperties')">Field
                                 
                                Properties
                            </button>
                            <button class="btn" 
                                (click)="clickViewProfile('gridViewFieldProfile')">Field
                                 
                                Profile
                            </button>
                            <button class="btn" 
                                (click)="clickViewOverview('gridViewOverview')"
                                >
                                Overview
                            </button>
                            <button class="btn" 
                                (click)="clickViewFields('gridViewFields')"
                                >
                                Fields
                            </button>
                            <button class="btn" 
                                (click)="clickViewDataQuality('gridViewDataQuality')">Data
                                 
                                Quality
                            </button>
                        </div>                        
                    </div>

                    <div *ngIf="clickedViewDescription" class="gridDesc">
                        <div class="gridDescDescriptionTitle">
                            <b>Description:</b>
                        </div>
                        <div class="gridDescDescription">
                            {{ selectedRowDescription }}
                        </div>
                        <div class="gridDescNameTitle">
                            <b>Names:</b>
                        </div>
                        <div class="gridDescName">
                            {{ selectedRowName }}
                        </div>
                        <div class="gridDescNrWidgetsTitle">
                            <b>Nr Widgets:</b>
                        </div>
                        <div class="gridDescNrWidgets">
                            {{ selectedRowNrWidgetsInUse }}
                        </div>
    
                        <div class="gridDescFileInfo" *ngIf="typeDS==='File'">

                            <div class="fileFolderNameTitle">
                                Folder:
                            </div>
                            <div class="fileFolderName">
                                Folder:
                                {{ folderName }}
                            </div>
    
                            <div class="fileNameTitle">
                                Filename:
                            </div>
                            <div class="fileName">
                                {{ fileName }}
                            </div>
    
                            <div class="fileExcelTitle">
                                Excel Worksheet:
                            </div>
    
                            <div class="fileExcel">
                                {{ excelWorksheet }}
                            </div>
    
                            <div  class="fileStartLineTitle">
                                Start at:
                            </div>
                            <div  class="fileStartLine">
                                {{ startLineNr }}
                            </div>
    
                        </div>
        
                    </div>
    
                    <div *ngIf="clickedViewPreview" class="gridPreview">
                        <clr-datagrid class="gridPreviewData">

                            <clr-dg-column *ngFor="let row of dataFieldNames">{{row}}</clr-dg-column>
                            <clr-dg-row *clrDgItems="let row of currentData">

                                <clr-dg-cell *ngFor="let col of dataFieldNames; let i = index">
                                        {{ row[col] }}
                                </clr-dg-cell>
                            </clr-dg-row>

                            <clr-dg-footer>
                                {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}}
                                of {{pagination.totalItems}} rows
                                <clr-dg-pagination #pagination [clrDgPageSize]="8"></clr-dg-pagination>
                            </clr-dg-footer>

                        </clr-datagrid>
                    </div>

                    <div *ngIf="clickedViewFieldProperties" class="gridFieldProperties">
                        <div class="gridFieldPropSelectTitle">
                            <b>Select field:</b>
                        </div>
                        <div class="gridFieldPropSelect">
                            <div class="select">
                                <select>    
                                    <option *ngFor="let row of dataFieldNames">
                                        {{ row }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <div class="gridFieldPropDescTitle">
                            <b>Description:</b>
                        </div>
                        <div class="gridFieldPropDesc">
                            This is used for ... and contains all types of ... 
                        </div>

                        <div class="gridFieldPropLocalNameTitle">
                            <b>Local Name:</b>
                        </div>
                        <div class="gridFieldPropLocalName">
                            Full Date
                        </div>

                        <div class="gridFieldPropTypeTitle">
                            <b>Type:</b> 
                        </div>
                        <div class="gridFieldPropType">
                            Number
                        </div>

                        <div class="gridFieldPropFormatTitle">
                            <b>Format:</b>
                        </div>
                        <div class="gridFieldPropFormat">
                            YYYY/MM/DD
                        </div>

                        <div class="gridFieldPropFilterTitle">
                            <b>Filter:</b>
                        </div>
                        <div class="gridFieldPropFilter">
                            >= 0
                        </div>

                        <div class="gridFieldPropCalcTitle">
                            <b>Calculation:</b>
                        </div>
                        <div class="gridFieldPropCalc">
                            None
                        </div>

                        <div class="gridFieldPropOrderTitle">
                            <b>Order:</b>
                        </div>
                        <div class="gridFieldPropOrder">
                            None
                        </div>

                        <div class="gridFieldPropHideTitle">
                            <b>Hide:</b>
                        </div>
                        <div class="gridFieldPropHide">
                            False
                        </div>

                        <div class="gridFieldPropKeyTitle">
                            <b>Key Field:</b>
                        </div>
                        <div class="gridFieldPropKey">
                            Key Field:
                        </div>
    
                    </div>
   
                    <div *ngIf="clickedViewFieldProfile" class="gridFieldProfile">

                        <i>Your dataset has <b>241</b> records, and <b>24</b> fields,
                            Text fields: <b>8</b>,
                            Date fields: <b>4</b>,
                            Number fields: <b>9</b>,
                            Boolean fields: <b>2</b>,
                            ? fields: <b>1</b>.
                        </i>
                        <div class="gridFieldProfileSelectTitle">
                            <b>Select field:</b>
                        </div>
                        <div class="gridFieldProfileSelect">
                            <div class="select">
                                <select>    
                                    <option *ngFor="let row of dataFieldNames">
                                        {{ row }}
                                    </option>
                                </select>
                            </div>
                        </div>
                       
                        <div class="gridFieldProfileDBfield">
                            <b>"DB field":</b> (field name)
                        </div>
                        <div class="gridFieldProfileUnique">
                            <b>"Unique":</b> (# value:count pairs)
                        </div>

                        <div class="gridFieldProfileCount">
                            <b>"Count":</b> 1000,
                        </div>
                        <div class="gridFieldProfileValid">
                            <b>"Valid":</b> 1000,
                        </div>
                       
                        <div class="gridFieldProfileMissing">
                            <b>"Missing":</b> 0,
                        </div>
                        <div class="gridFieldProfileDistinct">
                            <b>"Distinct":</b> 1000,
                        </div>
                       
                        <div class="gridFieldProfileMin">
                            <b>"Min":</b> -2.7983914656538427,
                        </div>
                        <div class="gridFieldProfileMax">
                            <b>"Max":</b> 2.9931226872439436,
                        </div>
                       
                        <div class="gridFieldProfileMean">
                            <b>"Mean":</b> 0.024987537472992594,
                        </div>
                        <div class="gridFieldProfileStdev">
                            <b>"Stdev":</b> 0.965105294571081,
                        </div>
                       
                        <div class="gridFieldProfileMedian">
                            <b>"Median":</b> 0.012544328964464974,
                        </div>
                        <div class="gridFieldProfileQ1">
                            <b>"Q1":</b> -0.6686040453830552, // 25th percentile
                        </div>
                       
                        <div class="gridFieldProfileQ3">
                            <b>"Q3":</b> 0.7090708668163043   // 75th percentile
                        </div>
                        <div class="gridFieldProfileModeSkew">
                            <b>"Modeskew":</b> 0.012893109776231,
                        </div>
                    </div>
    
                    <div *ngIf="clickedViewOverview" class="gridInfoSummaryOverview">
                        <div>
                            <b>
                                <h4 class="gridViewFieldHeading" >Overview</h4>
                            </b>
                            <i>This area shows an overview of the data in 6 graphs.  It
                                includes frequency distributions of key fields, and a
                                Light data exploration, ie outliers about xth percentile.
                                <button
                                    type="button"
                                    class="btn btn-secondary"
                                    (click)="clickRefreshData()"
                                    >
                                    Refresh
                                </button>
                            </i>
                        </div>
                        <div class="gridViewRightOverviewGraph">
                            <img class="gridViewRightOverviewGraph"
                                [style.height.px]="120"
                                [style.width.px]="120"
                                src="../images/ChartCandleStick.png"
                                (click)="clickViewOptions('gridViewOverview')"
                            >

                        </div>
                        <div class="gridViewRightOverviewGraph">
                                <img class="gridViewRightOverviewGraph"
                                [style.height.px]="120"
                                [style.width.px]="120"
                                src="../images/ChartBoxPlot.png"
                                (click)="clickViewOptions('gridViewOverview')"
                            >
                        </div>
                        <div class="gridViewRightOverviewGraph">
                            <img class="gridViewRightOverviewGraph"
                                [style.height.px]="120"
                                [style.width.px]="120"
                                src="../images/ChartRangedDot.png"
                                (click)="clickViewOptions('gridViewOverview')"
                            >
                        </div>
                    </div>

                    <div *ngIf="clickedViewFields" class="gridInfoSummaryFields">
                        <b>
                            <h4>Fields</h4>
                        </b>
                        <i>List of fields after the filters, transformations and
                            optional pivot has been applied.
                        </i>
                        <br> 
                        <div>

                            <clr-datagrid>
                                <clr-dg-column>FieldName</clr-dg-column>
                                <clr-dg-column>DataType</clr-dg-column>
                                <clr-dg-column>LocalName</clr-dg-column>
                                <clr-dg-column>Filtered</clr-dg-column>
                                <clr-dg-column>Transformed</clr-dg-column>
                                <clr-dg-row *ngFor="let row of finalFields">
                                    <clr-dg-cell>{{ row.fieldName }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.dataType }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.localName }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.filtered }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.transformed }}</clr-dg-cell>
                                </clr-dg-row>
                            </clr-datagrid>

                        </div>
                    </div>

                    <div *ngIf="clickedViewDataQuality" class="gridInfoSummaryDataQuality">
                        <b>
                            <h4>Data Quality Issues</h4>
                        </b>
                        <i>This area provides a list of issues pertaining to Data
                            Quality, and whether it has been resolved.  Double click
                            a row to see all the detail values affected (if Nr Issues
                            is greater than 0).
                        </i>
                        <div>
                            <clr-datagrid>
                                <clr-dg-column>ID</clr-dg-column>
                                <clr-dg-column>Status</clr-dg-column>
                                <clr-dg-column>Name</clr-dg-column>
                                <clr-dg-column>Type</clr-dg-column>
                                <clr-dg-column>Description</clr-dg-column>
                                <clr-dg-column>NrIssues</clr-dg-column>
                                <clr-dg-column>LoggedBy</clr-dg-column>
                                <clr-dg-column>LoggedOn</clr-dg-column>
                                <clr-dg-column>SolvedBy</clr-dg-column>
                                <clr-dg-column>SolvedOn</clr-dg-column>

                                <clr-dg-row *ngFor="let row of dataQualityIssues">
                                    <clr-dg-cell>{{row.id}}</clr-dg-cell>
                                    <clr-dg-cell>{{row.status}}</clr-dg-cell>
                                    <clr-dg-cell>{{row.name}}</clr-dg-cell>
                                    <clr-dg-cell>{{row.type}}</clr-dg-cell>
                                    <clr-dg-cell>{{row.description}}</clr-dg-cell>
                                    <clr-dg-cell>{{row.nrIssues}}</clr-dg-cell>
                                    <clr-dg-cell>{{row.loggedBy}}</clr-dg-cell>
                                    <clr-dg-cell>{{row.loggedOn}}</clr-dg-cell>
                                    <clr-dg-cell>{{row.solvedBy}}</clr-dg-cell>
                                    <clr-dg-cell>{{row.solvedOn}}</clr-dg-cell>
                                </clr-dg-row>

                                <clr-dg-footer>{{dataQualityIssues.length}} issues</clr-dg-footer>
                            </clr-datagrid>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
</div>
